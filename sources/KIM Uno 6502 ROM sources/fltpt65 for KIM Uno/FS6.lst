 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014



 000001                              .print stats,xref,clip=76,csort=c,cycles
 000002                              .files h6x, inthex
 000003                      
 000004                      ;------------------------------------------------
 000005                      ;
 000006                      ;   zero page assignments
 000007                      ;
 000008      =(00192)        tmp1   .equ $c0
 000009      =(00193)        tmp2   .equ $c1
 000010      =(00194)        dadj   .equ $c2
 000011      =(00195)        ctr1   .equ $c3
 000012      =(00196)        ctr2   .equ $c4
 000013      =(00197)        ctr3   .equ $c5
 000014      =(00198)        pctr   .equ $c6
 000015      =(00199)        bctr   .equ $c7
 000016      =(00200)        tnsgn  .equ $c8
 000017      =(00201)        qdrnt  .equ $c9
 000018      =(00202)        cotflg .equ $ca
 000019      =(00203)        cosflg .equ $cb
 000020      =(00204)        sinflg .equ $cc
 000021      =(00205)        expflg .equ $cd
 000022      =(00240)        mptr   .equ $f0
 000023      =(00242)        ptr1   .equ $f2
 000024      =(00244)        ptr2   .equ $f4
 000025      =(00246)        ptr3   .equ $f6
 000026      =(00248)        pptr   .equ $f8
 000027                      ;
 000028                      ;   misc equates
 000029                      ;
 000030      =(00008)        reglen .equ 8
 000031      =(00016)        wreglen .equ 16
 000032                      
 000033                      ; test loader by oscar (junk):
 000034 0200                 	.org $0200
 000035 0200 A9 40       ~2  	lda #$40		; 4...
 000036 0202 8D 62 03    ~4  	sta $0362
 000037 0205 A9 20       ~2  	lda #$20		; 2...
 000038 0207 8D 6A 03    ~4  	sta $036A
 000039 020A A9 02       ~2  	lda #$02		; multiply
 000040 020C 20 00 50    ~6  	jsr $5000
 000041 020F 00          ~7  	brk
 000042                      ; end of test loader
 000043                      
 000044                      
 000045 0300                     .org $300
 000046 0300 =(00768)        ra  .ds 16              ; These registers are for
 000047 0310 =(00784)        rb  .ds 16
 000048 0320 =(00800)        rc  .ds 16
 000049 0330 =(00816)        rd  .ds 16
 000050 0340 =(00832)        re  .ds 16
 000051 0350 =(00848)        rf  .ds 16
 000052                      ;

                              page 1

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 000053 0360 =(00864)        w1  .ds 8               ; These registers are for
 000054 0368 =(00872)        w2  .ds 8               ; storage format. 'w1' an
 000055 0370 =(00880)        w3  .ds 8               ; loaded with the operand
 000056 0378 =(00888)        w4  .ds 8               ; F.P. routines.  'w3' is
 000057 0380 00 00 00 00     scalereg .byte 0,0,0,0,0,0,0,0          ; registe
        0384 00 00 00 00 
 000058 0388 00 00 00 00     arg  .byte 0,0,0,0,0,0,0,0              ; argumen
        038C 00 00 00 00 
 000059 0390 00 00 00 00     reg1 .byte 0,0,0,0,0,0,0,0              ; tempora
        0394 00 00 00 00 
 000060 0398 00 00 00 00     reg2 .byte 0,0,0,0,0,0,0,0
        039C 00 00 00 00 
 000061 03A0 00 00 00 00     reg3 .byte 0,0,0,0,0,0,0,0
        03A4 00 00 00 00 
 000062 03A8 00 00 00 00     reg4 .byte 0,0,0,0,0,0,0,0
        03AC 00 00 00 00 
 000063                      
 000064                      ; working storage cut out of $4000 area and place
 000065 0100                 	.org $0100
 000066 0100                     .align 256
 000067 0100 =(00256)        mtbl   .ds 16
 000068 0110 =(00272)        mtbl1  .ds 16
 000069 0120 =(00288)        mtbl2  .ds 16*8
 000070                      ; end of replocated working storage area
 000071                      
 000072                      
 000073                      
 000074                      
 000075 5000                     .org $5000
 000076 5000 A2 FF       ~2  calc ldx #$ff       ; 'calc' is the entry point.
 000077 5002 9A          ~2      txs
 000078 5003 D8          ~2      cld             ; decimal mode is set or clea
 000079                      ;
 000080                      ;   a-reg has an index into the function jsr tabl
 000081                      ;
 000082 5004 0A          ~2      asl
 000083 5005 0A          ~2      asl             ; multiply 'a-reg' by 4
 000084 5006 18          ~2      clc             ; construct target address fo
 000085 5007 69 11       ~2      adc <(jtbl-1)
 000086 5009 AA          ~2      tax
 000087 500A A9 50       ~2      lda >(jtbl-1)
 000088 500C 69 00       ~2      adc #0
 000089 500E 48          ~3      pha
 000090 500F 8A          ~2      txa
 000091 5010 48          ~3      pha
 000092 5011 60          ~6      rts             ; call function
 000093                      
 000094                      ;    .org $300
 000095                      ;
 000096                      ;   jump table for functions. each entry is on a 
 000097                      ;
 000098 5012 20 B6 50    ~6  jtbl jsr add        ; token: a_reg = 0
 000099 5015 00          ~7      brk

                              page 2

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 000100 5016 20 AE 50    ~6      jsr sub         ; 1
 000101 5019 00          ~7      brk
 000102 501A 20 78 53    ~6      jsr mul         ; 2
 000103 501D 00          ~7      brk               
 000104 501E 20 35 55    ~6      jsr div         ; 3
 000105 5021 00          ~7      brk
 000106 5022 20 E6 56    ~6      jsr sqrt        ; 4
 000107 5025 00          ~7      brk
 000108 5026 20 3E 66    ~6      jsr inv         ; 5
 000109 5029 00          ~7      brk
 000110 502A 20 E2 66    ~6      jsr int         ; 6
 000111 502D 00          ~7      brk
 000112 502E 20 2B 67    ~6      jsr frac        ; 7
 000113 5031 00          ~7      brk
 000114 5032 20 54 66    ~6      jsr abs         ; 8
 000115 5035 00          ~7      brk
 000116 5036 20 66 66    ~6      jsr chs         ; 9
 000117 5039 00          ~7      brk
 000118 503A 20 0A 59    ~6      jsr sin         ; 10
 000119 503D 00          ~7      brk
 000120 503E 20 33 59    ~6      jsr cos         ; 11
 000121 5041 00          ~7      brk
 000122 5042 20 4C 59    ~6      jsr tan         ; 12
 000123 5045 00          ~7      brk
 000124 5046 20 91 59    ~6      jsr csc         ; 13
 000125 5049 00          ~7      brk
 000126 504A 20 B5 58    ~6      jsr sec         ; 14
 000127 504D 00          ~7      brk
 000128 504E 20 8C 59    ~6      jsr cot         ; 15
 000129 5051 00          ~7      brk
 000130 5052 20 96 5B    ~6      jsr asin        ; 16
 000131 5055 00          ~7      brk
 000132 5056 20 7D 5B    ~6      jsr acos        ; 17
 000133 5059 00          ~7      brk
 000134 505A 20 2F 5C    ~6      jsr atan        ; 18
 000135 505D 00          ~7      brk
 000136 505E 20 4E 5E    ~6      jsr acsc        ; 19
 000137 5061 00          ~7      brk
 000138 5062 20 66 5E    ~6      jsr asec        ; 20
 000139 5065 00          ~7      brk
 000140 5066 20 7E 5E    ~6      jsr acot        ; 21
 000141 5069 00          ~7      brk
 000142 506A 20 96 5E    ~6      jsr loge        ; 22
 000143 506D 00          ~7      brk
 000144 506E 20 35 61    ~6      jsr exp         ; 23
 000145 5071 00          ~7      brk
 000146 5072 20 13 63    ~6      jsr sinh        ; 24
 000147 5075 00          ~7      brk
 000148 5076 20 54 63    ~6      jsr cosh        ; 25
 000149 5079 00          ~7      brk
 000150 507A 20 8D 63    ~6      jsr tanh        ; 26
 000151 507D 00          ~7      brk
 000152 507E 20 0D 64    ~6      jsr csch        ; 27

                              page 3

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 000153 5081 00          ~7      brk
 000154 5082 20 25 64    ~6      jsr sech        ; 28
 000155 5085 00          ~7      brk
 000156 5086 20 3D 64    ~6      jsr coth        ; 29
 000157 5089 00          ~7      brk
 000158 508A 20 55 64    ~6      jsr asinh       ; 30
 000159 508D 00          ~7      brk
 000160 508E 20 AE 64    ~6      jsr acosh       ; 31
 000161 5091 00          ~7      brk
 000162 5092 20 07 65    ~6      jsr atanh       ; 32
 000163 5095 00          ~7      brk
 000164 5096 20 74 65    ~6      jsr acsch       ; 33
 000165 5099 00          ~7      brk
 000166 509A 20 95 65    ~6      jsr asech       ; 34
 000167 509D 00          ~7      brk
 000168 509E 20 B6 65    ~6      jsr acoth       ; 35
 000169 50A1 00          ~7      brk
 000170 50A2 20 D7 65    ~6      jsr log2        ; 36
 000171 50A5 00          ~7      brk
 000172 50A6 20 EF 65    ~6      jsr log10       ; 37
 000173 50A9 00          ~7      brk
 000174 50AA 20 07 66    ~6      jsr pow         ; 38
 000175 50AD 00          ~7      brk
 000176                      ;
 000177                      
 000178                      ;
 000179                      ;   main floating point math package
 000180                      ;
 000181                      ;    .org $800
 000182 50AE AD 68 03    ~4  sub lda w2          ; perform subtraction by chan
 000183 50B1 49 80       ~2      eor #$80        ;  of second number and addin
 000184 50B3 8D 68 03    ~4      sta w2
 000185 50B6 F8          ~2  add sed
 000186 50B7 AD 62 03    ~4      lda w1+2        ; filter out case where one n
 000187 50BA D0 09       ~2-     bne add1
 000188 50BC A9 68       ~2      lda <w2
 000189 50BE A0 03       ~2      ldy >w2
 000190 50C0 A2 70       ~2      ldx #w3         ; this convention references 
 000191 50C2 4C 30 52    ~3      jmp copy2w      ; w1 is zero -- return with w
 000192 50C5 AD 6A 03    ~4  add1 lda w2+2
 000193 50C8 D0 09       ~2-     bne add2
 000194 50CA A9 60       ~2      lda <w1
 000195 50CC A0 03       ~2      ldy >w1
 000196 50CE A2 70       ~2      ldx #w3
 000197 50D0 4C 30 52    ~3      jmp copy2w      ; w2 is zero -- return with w
 000198                          ;
 000199                          ;   At this point, additions and subtractions
 000200                          ;   been handled. Both operands are now known
 000201                          ;
 000202 50D3 AD 60 03    ~4  add2 lda w1         ; determine if a sum or diffe
 000203 50D6 4D 68 03    ~4      eor w2
 000204 50D9 10 6C       ~2=     bpl add3        ; branch if signs are the sam
 000205                          ;

                              page 4

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 000206                          ;  On entry, we only know that the two number
 000207                          ;  signs (mantissa signs). To subtract, we wi
 000208                          ;  the larger of the two numbers (in magnitud
 000209                          ;  in 'ra'. The second number will be decimal
 000210                          ;  placed in 'rb'.
 000211                          ;
 000212                          ;  The sign of the result will carry the sign
 000213                          ;  in 'ra' (largest in magnitude).
 000214                          ;
 000215 50DB =(20699)        sub1 
 000216 50DB 2C 60 03    ~4      bit w1          ; now estimate which number i
 000217 50DE 70 07       ~2-     bvs est1        ;  on the exponents.  If expo
 000218 50E0 2C 68 03    ~4      bit w2          ;  the positive one goes with
 000219 50E3 70 0A       ~2-     bvs est2        ; 
 000220 50E5 50 42       ~2=     bvc sbpe        ; both numbers have positive 
 000221 50E7 2C 68 03    ~4  est1 bit w2
 000222 50EA 70 4E       ~2=     bvs sbne        ; both numbers have negative 
 000223 50EC 20 38 53    ~6      jsr xw12        ; 
 000224 50EF 20 A3 51    ~6  est2 jsr sumexp     ; exponents have opposite sig
 000225 50F2 A5 C0       ~3      lda tmp1  
 000226 50F4 F0 09       ~2-     beq est3
 000227 50F6 A9 60       ~2  est2a lda <w1       ; e1 >> e2
 000228 50F8 A0 03       ~2      ldy >w1         ; just copy e1 to w3...
 000229 50FA A2 70       ~2      ldx #w3
 000230 50FC 4C 30 52    ~3      jmp copy2w      ; ...and exit.
 000231 50FF A5 C1       ~3  est3 lda tmp2
 000232 5101 C9 12       ~2      cmp #$12
 000233 5103 B0 F1       ~2=     bcs est2a       ; e1 >> e2
 000234 5105 A9 00       ~2      lda #0         ; we now know that a subtracti
 000235 5107 85 C2       ~3      sta dadj        ; initialize decimal adjust.
 000236 5109 20 F0 51    ~6      jsr w12rab      ; put 'w1' and 'w2' into 'ra'
 000237 510C 20 5E 52    ~6      jsr subrarb
 000238 510F B0 0D       ~2-     bcs est4a
 000239 5111 20 38 53    ~6      jsr xw12
 000240 5114 A9 00       ~2      lda #0
 000241 5116 85 C2       ~3      sta dadj
 000242 5118 20 F0 51    ~6      jsr w12rab
 000243 511B 20 5E 52    ~6      jsr subrarb
 000244 511E =(20766)        est4a
 000245 511E AD 60 03    ~4      lda w1          ; 'tmp1' is used as a flag to
 000246 5121 49 40       ~2      eor #$40
 000247 5123 85 C0       ~3      sta tmp1
 000248 5125 20 AC 52    ~6      jsr rbtow3      ; ...of this subroutine.
 000249 5128 60          ~6      rts
 000250 5129 =(20777)        sbpe
 000251 5129 20 C2 51    ~6      jsr diffexp     ; carry e1 >= e2.
 000252 512C B0 03       ~2-     bcs sbp1
 000253 512E 20 38 53    ~6      jsr xw12
 000254 5131 A5 C0       ~3  sbp1 lda tmp1
 000255 5133 C9 00       ~2      cmp #0
 000256 5135 D0 BF       ~2=     bne est2a
 000257 5137 4C FF 50    ~3      jmp est3
 000258 513A =(20794)        sbne

                              page 5

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 000259 513A 20 C2 51    ~6      jsr diffexp     ; exponent diff: tmp1(hi),tmp
 000260 513D 90 F2       ~2-     bcc sbp1
 000261 513F 20 38 53    ~6      jsr xw12
 000262 5142 A5 C0       ~3      lda tmp1
 000263 5144 4C 31 51    ~3      jmp sbp1
 000264                          ;
 000265                          ;   We now have two numbers with the same sig
 000266                          ;   Add two positive or negative numbers.
 000267                          ;   Handle sign on exit, as it does not affec
 000268                          ;
 000269                          ;   The following algorithm places the larger
 000270                          ;   numbers in 'ra' and the other in 'rb', bu
 000271                          ;   decimal point adjustment is needed before
 000272                          ;
 000273 5147 =(20807)        add3
 000274 5147 2C 60 03    ~4      bit w1          ; now estimate which number i
 000275 514A 70 07       ~2-     bvs et1         ;  on the exponents.  If expo
 000276 514C 2C 68 03    ~4      bit w2          ;  the positive one goes with
 000277 514F 70 0A       ~2-     bvs et2         ; 
 000278 5151 50 34       ~2-     bvc adpe        ; both numbers have positive 
 000279 5153 2C 68 03    ~4  et1 bit w2
 000280 5156 70 40       ~2-     bvs adne        ; both numbers have negative 
 000281 5158 20 38 53    ~6      jsr xw12        ; swap w1 and w2 so largest m
 000282 515B 20 A3 51    ~6  et2  jsr sumexp     ; add the exponents to determ
 000283                                          ;  point adjustment to be app
 000284 515E A5 C0       ~3      lda tmp1        ; if tmp1 <> 0 the sum exceed
 000285 5160 F0 09       ~2-     beq et3
 000286 5162 A9 60       ~2  et2a lda <w1
 000287 5164 A0 03       ~2      ldy >w1         ; w1 >> w2. no need to add, j
 000288 5166 A2 70       ~2      ldx #w3
 000289 5168 4C 30 52    ~3      jmp copy2w      ; ...and exit
 000290 516B A5 C1       ~3  et3  lda tmp2
 000291 516D C9 12       ~2      cmp #$12
 000292 516F B0 F1       ~2-     bcs et2a        ; w1 >> w2. copy and exit.
 000293 5171 A9 00       ~2      lda #0          ; Summary: w1 is larger than 
 000294 5173 85 C2       ~3      sta dadj        ; initialize adjustments due 
 000295 5175 20 F0 51    ~6      jsr w12rab      ; copy w1 and w2 to working r
 000296 5178 20 44 52    ~6      jsr addrarb     ; perform the addition with o
 000297 517B 20 8C 52    ~6      jsr rndrb       ; (optional) round result reg
 000298 517E AD 60 03    ~4      lda w1          
 000299 5181 85 C0       ~3      sta tmp1        ; 'tmp1' identifies caller to
 000300 5183 20 AC 52    ~6      jsr rbtow3      ; copy result (rb) to w3.
 000301 5186 60          ~6      rts
 000302 5187 =(20871)        adpe
 000303 5187 20 C2 51    ~6      jsr diffexp     ; exponent diff: 'a'(hi), 'x'
 000304 518A B0 03       ~2-     bcs adp1
 000305 518C 20 38 53    ~6      jsr xw12
 000306 518F A5 C0       ~3  adp1 lda tmp1
 000307 5191 C9 00       ~2      cmp #0
 000308 5193 D0 CD       ~2-     bne et2a        ; e1 >> e2, just copy w1 to w
 000309 5195 4C 6B 51    ~3      jmp et3
 000310 5198 =(20888)        adne
 000311 5198 20 C2 51    ~6      jsr diffexp     ; exponent diff: tmp1(hi), tm

                              page 6

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 000312 519B 90 F2       ~2-     bcc adp1
 000313 519D 20 38 53    ~6      jsr xw12
 000314 51A0 4C 8F 51    ~3      jmp adp1
 000315                                               
 000316 51A3 AD 60 03    ~4  sumexp lda w1   ; return with sum of exponents in
 000317 51A6 29 0F       ~2      and #$0f
 000318 51A8 85 C0       ~3      sta tmp1
 000319 51AA AD 68 03    ~4      lda w2
 000320 51AD 29 0F       ~2      and #$0f
 000321 51AF 85 C1       ~3      sta tmp2
 000322 51B1 18          ~2      clc
 000323 51B2 AD 61 03    ~4      lda w1+1
 000324 51B5 6D 69 03    ~4      adc w2+1
 000325 51B8 AA          ~2      tax
 000326 51B9 A5 C0       ~3      lda tmp1
 000327 51BB 65 C1       ~3      adc tmp2
 000328 51BD 85 C0       ~3      sta tmp1
 000329 51BF 86 C1       ~3      stx tmp2
 000330 51C1 60          ~6      rts
 000331                                               
 000332 51C2 AD 60 03    ~4  diffexp lda w1      ; return absolute difference 
 000333 51C5 29 0F       ~2      and #$0f        ; value is in tmp1(hi),tmp2(l
 000334 51C7 85 C0       ~3      sta tmp1        ;  clear if e1 < e2.
 000335 51C9 AD 68 03    ~4      lda w2
 000336 51CC 29 0F       ~2      and #$0f
 000337 51CE 85 C1       ~3      sta tmp2
 000338 51D0 38          ~2      sec             ; trial difference assuming e
 000339 51D1 AD 61 03    ~4      lda w1+1        ; (It's just as easy to go ah
 000340 51D4 ED 69 03    ~4      sbc w2+1        ;  subtraction as it is to pe
 000341 51D7 AA          ~2      tax             ;  compare. If the numbers we
 000342 51D8 A5 C0       ~3      lda tmp1        ;  we are done. Otherwise, we
 000343 51DA E5 C1       ~3      sbc tmp2        ;  order, which we would have
 000344 51DC B0 0D       ~2-     bcs @F          ; OK, exit with carry set.
 000345 51DE 38          ~2      sec             ; Underflow. e1 is smaller th
 000346 51DF AD 69 03    ~4      lda w2+1        ;  exponent difference.
 000347 51E2 ED 61 03    ~4      sbc w1+1
 000348 51E5 AA          ~2      tax
 000349 51E6 A5 C1       ~3      lda tmp2
 000350 51E8 E5 C0       ~3      sbc tmp1
 000351 51EA 18          ~2      clc
 000352 51EB 85 C0       ~3  @   sta tmp1
 000353 51ED 86 C1       ~3      stx tmp2
 000354 51EF 60          ~6      rts
 000355                                               
 000356                          ;
 000357                          ;   Copy mantissas of numbers in 'w1' and 'w2
 000358                          ;   Align decimal points by shifting 'rb' to 
 000359                          ;   adjustment has been previously placed in 
 000360                          ;   
 000361 51F0 A0 1F       ~2  w12rab ldy #wreglen*2-1 ;31
 000362 51F2 A9 00       ~2      lda #0
 000363 51F4 =(20980)        clrlp           ; clear ra, rb
 000364 51F4 99 00 03    ~5      sta ra,y

                              page 7

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 000365 51F7 88          ~2      dey
 000366 51F8 10 FA       ~2-     bpl clrlp
 000367 51FA 18          ~2      clc         ; determine register alignment of
 000368 51FB A5 C1       ~3      lda tmp2
 000369 51FD 69 11       ~2      adc #$11    ; this 'magic' number is 2x5+1.
 000370 51FF A8          ~2      tay         ;
 000371 5200 B9 94 6A    ~4      lda dec2bin,y ; convert to binary...
 000372 5203 4A          ~2      lsr         ; ... then convert to bytes
 000373 5204 AA          ~2      tax         ; decimal point adjustment is now
 000374 5205 A0 05       ~2      ldy #reglen-3
 000375 5207 B9 62 03    ~4  @   lda w1+2,y  ; now copy w1 to ra and w2 to rb 
 000376 520A 99 02 03    ~5      sta ra+2,y
 000377 520D B9 6A 03    ~4      lda w2+2,y
 000378 5210 9D 12 03    ~5      sta rb+2,x
 000379 5213 CA          ~2      dex
 000380 5214 88          ~2      dey
 000381 5215 10 F0       ~2-     bpl @B
 000382 5217 A5 C1       ~3      lda tmp2
 000383 5219 4A          ~2      lsr         ; set carry if decimal adjustment
 000384 521A 90 13       ~2-     bcc cxp1
 000385 521C A2 0D       ~2      ldx #wreglen-3  ; ...and shift rb left one di
 000386 521E A9 00       ~2      lda #0
 000387 5220 BC 12 03    ~4, @   ldy rb+2,x
 000388 5223 19 54 69    ~4,     ora tlh,y
 000389 5226 9D 12 03    ~5      sta rb+2,x
 000390 5229 B9 F4 69    ~4      lda thl,y
 000391 522C CA          ~2      dex
 000392 522D 10 F1       ~2-     bpl @B
 000393 522F =(21039)        cxp1
 000394 522F 60          ~6      rts
 000395                                               
 000396                          ; copy number from (ptr1) to (ptr2)
 000397                          ; enter with src register page in 'y', src re
 000398                          ;   dest register offset in 'x' (assumed dest
 000399 5230 84 F3       ~3  copy2w sty ptr1+1
 000400 5232 85 F2       ~3      sta ptr1
 000401 5234 86 F4       ~3      stx ptr2
 000402 5236 A9 03       ~2      lda #w1/256    ; get page used for working re
 000403 5238 85 F5       ~3      sta ptr2+1
 000404 523A A0 07       ~2      ldy #7
 000405 523C B1 F2       ~5  @   lda (ptr1),y
 000406 523E 91 F4       ~6      sta (ptr2),y
 000407 5240 88          ~2      dey
 000408 5241 10 F9       ~2-     bpl @B
 000409 5243 60          ~6      rts
 000410                                               
 000411 5244 A2 06       ~2  addrarb ldx #reglen-2  ; add previously aligned '
 000412 5246 18          ~2      clc
 000413 5247 BD 01 03    ~4, @   lda ra+1,x
 000414 524A 7D 11 03    ~4,     adc rb+1,x
 000415 524D 9D 11 03    ~5      sta rb+1,x
 000416 5250 CA          ~2      dex
 000417 5251 10 F4       ~2-     bpl @B

                              page 8

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 000418 5253 AD 11 03    ~4      lda rb+1        ; check for overflow...
 000419 5256 F0 05       ~2-     beq @F
 000420 5258 20 5F 53    ~6      jsr rotrgtb     ; ...and normalize, if needed
 000421 525B E6 C2       ~5      inc dadj        ; and increment decimal adjus
 000422 525D 60          ~6  @   rts
 000423 525E A2 08       ~2  subrarb ldx #reglen
 000424 5260 38          ~2      sec
 000425 5261 BD 01 03    ~4, @   lda ra+1,x
 000426 5264 FD 11 03    ~4,     sbc rb+1,x
 000427 5267 9D 11 03    ~5      sta rb+1,x
 000428 526A CA          ~2      dex
 000429 526B 10 F4       ~2-     bpl @B
 000430 526D 90 1C       ~2-     bcc sabx        ; exit with carry clear (unde
 000431 526F A9 0C       ~2      lda #12
 000432 5271 85 C0       ~3      sta tmp1
 000433 5273 AD 12 03    ~4  sab1 lda rb+2       ; normalize
 000434 5276 29 F0       ~2      and #$f0
 000435 5278 D0 09       ~2-     bne sabxaa
 000436 527A 20 4B 53    ~6      jsr shflftb
 000437 527D E6 C2       ~5      inc dadj        ; this quantity will be subtr
 000438 527F C6 C0       ~5      dec tmp1
 000439 5281 D0 F0       ~2-     bne sab1
 000440 5283 =(21123)        sabxaa
 000441 5283 A4 C2       ~3      ldy dadj        ; convert dadj to decimal
 000442 5285 B9 34 6B    ~4      lda bin2dec,y
 000443 5288 85 C2       ~3      sta dadj
 000444 528A 38          ~2      sec           ; exit with carry set (normal c
 000445 528B 60          ~6  sabx rts
 000446                      
 000447 528C A2 07       ~2  rndrb ldx #7        ; round the result in 'rb'
 000448 528E A9 50       ~2      lda #$50
 000449 5290 18          ~2      clc
 000450 5291 7D 11 03    ~4, @   adc rb+1,x
 000451 5294 9D 11 03    ~5      sta rb+1,x
 000452 5297 A9 00       ~2      lda #0
 000453 5299 CA          ~2      dex
 000454 529A 10 F5       ~2-     bpl @B
 000455 529C AD 11 03    ~4      lda rb+1        ; check for overflow...
 000456 529F F0 0A       ~2-     beq @F
 000457 52A1 20 5F 53    ~6      jsr rotrgtb     ; ...and normalize, if needed
 000458 52A4 18          ~2      clc             
 000459 52A5 A5 C2       ~3      lda dadj        ; assume dadj < 99 but (possi
 000460 52A7 69 01       ~2      adc #1
 000461 52A9 85 C2       ~3      sta dadj        ; ... then increment decimal 
 000462 52AB 60          ~6  @   rts
 000463                                               
 000464 52AC A2 05       ~2  rbtow3 ldx #5       ; copy rb to w3.
 000465 52AE 18          ~2      clc
 000466 52AF BD 12 03    ~4, rbtw1 lda rb+2,x      ; first, copy result mantis
 000467 52B2 9D 72 03    ~5      sta w3+2,x
 000468 52B5 CA          ~2      dex
 000469 52B6 10 F7       ~2-     bpl rbtw1
 000470 52B8 AD 72 03    ~4      lda w3+2

                              page 9

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 000471 52BB D0 07       ~2-     bne rbta        ; check if zero...
 000472 52BD 8D 71 03    ~4      sta w3+1        ; ...and exit if so.
 000473 52C0 8D 70 03    ~4      sta w3
 000474 52C3 60          ~6      rts
 000475 52C4 =(21188)        rbta
 000476 52C4 AD 61 03    ~4      lda w1+1        ; now copy exponent from w1 t
 000477 52C7 8D 71 03    ~4      sta w3+1
 000478 52CA AD 60 03    ~4      lda w1
 000479 52CD 29 0F       ~2      and #$0f
 000480 52CF 8D 70 03    ~4      sta w3
 000481 52D2 24 C0       ~3      bit tmp1        ; adjust exponent, assume dad
 000482 52D4 50 2F       ~2=     bvc rbtw2       ; add adjustment to exponent
 000483 52D6 38          ~2      sec
 000484 52D7 AD 71 03    ~4      lda w3+1
 000485 52DA E5 C2       ~3      sbc dadj
 000486 52DC AA          ~2      tax
 000487 52DD AD 70 03    ~4      lda w3
 000488 52E0 E9 00       ~2      sbc #0
 000489 52E2 B0 2D       ~2=     bcs rbtxa
 000490 52E4 38          ~2      sec
 000491 52E5 A5 C2       ~3      lda dadj
 000492 52E7 ED 71 03    ~4      sbc w3+1
 000493 52EA 8D 71 03    ~4      sta w3+1
 000494 52ED A9 00       ~2      lda #0
 000495 52EF ED 70 03    ~4      sbc w3
 000496 52F2 8D 70 03    ~4      sta w3
 000497 52F5 AD 60 03    ~4      lda w1
 000498 52F8 29 C0       ~2      and #$c0
 000499 52FA 49 40       ~2      eor #$40
 000500 52FC 0D 70 03    ~4      ora w3
 000501 52FF 29 CF       ~2      and #$cf
 000502 5301 8D 70 03    ~4      sta w3
 000503 5304 60          ~6      rts
 000504                      
 000505 5305 18          ~2  rbtw2 clc
 000506 5306 AD 61 03    ~4      lda w1+1
 000507 5309 65 C2       ~3      adc dadj
 000508 530B AA          ~2      tax
 000509 530C AD 60 03    ~4      lda w1
 000510 530F 69 00       ~2      adc #0
 000511 5311 8D 70 03    ~4  rbtxa sta w3        ; save exponent
 000512 5314 8E 71 03    ~4      stx w3+1
 000513 5317 0D 71 03    ~4      ora w3+1
 000514 531A D0 0E       ~2-     bne rbtx
 000515 531C AD 60 03    ~4      lda w1          ; if exponent is zero...
 000516 531F 29 80       ~2      and #$80        ; ...preserve mantissa sign, 
 000517 5321 0D 70 03    ~4      ora w3
 000518 5324 29 CF       ~2      and #$cf
 000519 5326 8D 70 03    ~4      sta w3
 000520 5329 60          ~6      rts
 000521                      
 000522 532A AD 60 03    ~4  rbtx lda w1
 000523 532D 29 C0       ~2      and #$c0        ; now copy sign bits to w3.

                              page 10

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 000524 532F 0D 70 03    ~4      ora w3
 000525 5332 29 CF       ~2      and #$cf
 000526 5334 8D 70 03    ~4      sta w3
 000527 5337 60          ~6      rts
 000528                      
 000529 5338 A0 07       ~2  xw12 ldy #7         ; exchange contents of w1 wit
 000530 533A BE 60 03    ~4, @   ldx w1,y
 000531 533D B9 68 03    ~4      lda w2,y
 000532 5340 99 60 03    ~5      sta w1,y
 000533 5343 8A          ~2      txa
 000534 5344 99 68 03    ~5      sta w2,y
 000535 5347 88          ~2      dey
 000536 5348 10 F0       ~2-     bpl @B
 000537 534A 60          ~6      rts
 000538                                               
 000539 534B A2 07       ~2  shflftb ldx #7      ; shift mantissa in rb left o
 000540 534D A9 00       ~2      lda #0
 000541 534F BC 11 03    ~4, @   ldy rb+1,x
 000542 5352 19 54 69    ~4,     ora tlh,y
 000543 5355 9D 11 03    ~5      sta rb+1,x
 000544 5358 B9 F4 69    ~4      lda thl,y
 000545 535B CA          ~2      dex
 000546 535C 10 F1       ~2-     bpl @B
 000547 535E 60          ~6      rts                         
 000548 535F A2 07       ~2  rotrgtb ldx #7
 000549 5361 A9 00       ~2      lda #0
 000550 5363 BC 11 03    ~4, @   ldy rb+1,x
 000551 5366 19 54 69    ~4,     ora tlh,y
 000552 5369 9D 12 03    ~5      sta rb+2,x
 000553 536C B9 F4 69    ~4      lda thl,y
 000554 536F CA          ~2      dex
 000555 5370 10 F1       ~2-     bpl @B
 000556 5372 A9 00       ~2      lda #0
 000557 5374 8D 11 03    ~4      sta rb+1
 000558 5377 60          ~6      rts
 000559                      ;
 000560                      ;   multiply routines
 000561                      ;
 000562                      ;   Multiplication is performed by a novel algori
 000563                      ;   table of multiples which is pre-computed for 
 000564                      ;   Instead of repeatedly adding suitably aligned
 000565                      ;   multiplier to an accumulated sum, a table con
 000566                      ;   multiples of the multiplicand is accessed by 
 000567                      ;   current multiplier digit.
 000568                      ;
 000569                      ;   The rationale behind the method is that there
 000570                      ;   two major repetitive operations involved in m
 000571                      ;   One is the addition of one multi-digit regist
 000572                      ;   and the other is a single digit shift of a mu
 000573                      ;   register.
 000574                      ;
 000575                      ;   For 8-bit processors using multi-digit packed
 000576                      ;   (two digits per byte) a two digit shift can b

                              page 11

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 000577                      ;   simply indexing the bytes by 1 (1 byte equals
 000578                      ;
 000579                      ;   Minimizing the number of BCD adds and shifts 
 000580                      ;   force behind the choice of this algorithm.
 000581                      ;
 000582                      ;   The fixed point table for a specific case loo
 000583                      ;
 000584                      ;   Multiplicand = 23.456...
 000585                      ;
 000586                      ;       Table
 000587                      ;
 000588                      ;   0   0000000...
 000589                      ;   1   0234560...
 000590                      ;   2   0469120...
 000591                      ;   3   0703680...
 000592                      ;   4   0938240...
 000593                      ;   5   1172800...
 000594                      ;   6   1407360...
 000595                      ;   7   1641920...
 000596                      ;   8   1876480...
 000597                      ;   9   2111049...
 000598                      ;
 000599                      ;   The partial product is updated in two phases.
 000600                      ;   boundaries are processed in one pass, and the
 000601                      ;   are processed in the second. This improves th
 000602                      ;   computations by eliminating all but one multi
 000603                      ;   Note that indexing through memory a byte at a
 000604                      ;   digits at a time.
 000605                      ;
 000606                      ;   Suppose the multiplier is:
 000607                      ;
 000608                      ;               1234567890
 000609                      ;
 000610                      ;   Then the partial products are accumulated dur
 000611                      ;   the multiplier were:
 000612                      ;
 000613                      ;               0103050709
 000614                      ;
 000615                      ;   Since the non-zero digits are on byte boundar
 000616                      ;   alignment can be handled by simply incrementi
 000617                      ;   the value in an index register. It is not nec
 000618                      ;   multi-digit register during this phase.
 000619                      ;
 000620                      ;   The result register is then shifted left one 
 000621                      ;   pass accumulates partial products as if the m
 000622                      ;
 000623                      ;               0204060800
 000624                      ;
 000625                      ;
 000626                      ;   The algorithm is summarized as follows:
 000627                      ;
 000628                      ;       1. Create the table of multiples of the m
 000629                      ;       2. For each digit of the multiplier on ev

                              page 12

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 000630                      ;           A. get next digit of multiplier,
 000631                      ;           B. using digit as an index, access co
 000632                      ;           C. add table entry to partial product
 000633                      ;               byte alignment,
 000634                      ;           D. if more digits, goto A.
 000635                      ;       3. Shift multiplier one digit,
 000636                      ;       4. Repeat (2.) for remainder of digits.
 000637                      ;
 000638                      ;   To estimate the performance of this strategy,
 000639                      ;   repeated addition algorithm for multi-digit B
 000640                      ;   average, there will be 4.5 multi-byte additio
 000641                      ;   multiplier.
 000642                      ;   After each digit is processed, the partial pr
 000643                      ;   be shifted one digit. For 10 digit numbers, t
 000644                      ;   approximately 45 adds and 9 register shifts.
 000645                      ;
 000646                      ;   For the method used here, there are 8 adds re
 000647                      ;   the table, and one add per digit of the multi
 000648                      ;   one register shift required, so the total ope
 000649                      ;   18 adds and 1 register shift.
 000650                      ;
 000651 5378 F8          ~2  mul sed
 000652 5379 A2 2F       ~2      ldx #47         ; clear working registers
 000653 537B A9 00       ~2      lda #0
 000654 537D 9D 00 03    ~5  @   sta ra,x
 000655 5380 CA          ~2      dex
 000656 5381 10 FA       ~2-     bpl @B
 000657 5383 20 E2 53    ~6      jsr mulm        ; get product of mantissas
 000658 5386 AD 60 03    ~4      lda w1          ; check exponents for same or
 000659 5389 4D 68 03    ~4      eor w2
 000660 538C 29 40       ~2      and #$40
 000661 538E F0 0F       ~2-     beq ml1s
 000662 5390 20 C2 51    ~6      jsr diffexp    ; carry set: e1 >= e2
 000663 5393 B0 05       ~2-     bcs @F
 000664 5395 AD 68 03    ~4      lda w2
 000665 5398 90 0B       ~2-     bcc xsgn
 000666 539A AD 60 03    ~4  @   lda w1
 000667 539D B0 06       ~2-     bcs xsgn        ; branch always
 000668 539F 20 A3 51    ~6  ml1s jsr sumexp     ; sum of exponents is in tmp1
 000669 53A2 AD 60 03    ~4      lda w1
 000670 53A5 29 40       ~2  xsgn and #$40
 000671 53A7 8D 70 03    ~4      sta w3          ; result exponent sign is set
 000672 53AA A5 C2       ~3      lda dadj
 000673 53AC F0 11       ~2-     beq cxpn        ; branch if no exponent adjus
 000674 53AE AD 70 03    ~4      lda w3
 000675 53B1 D0 06       ~2-     bne xsgna
 000676 53B3 20 19 55    ~6      jsr incexp
 000677 53B6 4C BF 53    ~3      jmp cxpn
 000678 53B9 20 27 55    ~6  xsgna jsr decexp
 000679 53BC 4C BF 53    ~3      jmp cxpn
 000680 53BF =(21439)        cxpn
 000681 53BF A5 C1       ~3      lda tmp2
 000682 53C1 8D 71 03    ~4      sta w3+1

                              page 13

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 000683 53C4 05 C0       ~3      ora tmp1        ; if exponent is zero, clear 
 000684 53C6 D0 03       ~2-     bne cxp2
 000685 53C8 8D 70 03    ~4      sta w3
 000686 53CB =(21451)        cxp2
 000687 53CB A5 C0       ~3      lda tmp1
 000688 53CD 0D 70 03    ~4      ora w3
 000689 53D0 8D 70 03    ~4      sta w3
 000690 53D3 AD 60 03    ~4      lda w1          ; now correct mantissa sign
 000691 53D6 4D 68 03    ~4      eor w2
 000692 53D9 29 80       ~2      and #$80
 000693 53DB 0D 70 03    ~4      ora w3
 000694 53DE 8D 70 03    ~4      sta w3
 000695 53E1 60          ~6      rts
 000696                      
 000697 53E2 AD 62 03    ~4  mulm lda w1+2       ; multiply mantissas
 000698 53E5 F0 18       ~2-     beq mzro
 000699 53E7 AD 6A 03    ~4      lda w2+2
 000700 53EA F0 13       ~2-     beq mzro
 000701 53EC 20 4C 54    ~6      jsr cw12rab
 000702 53EF 20 0A 54    ~6      jsr mktbl       ; create table of multiples..
 000703 53F2 20 5E 54    ~6      jsr psumh       ; ...accumulate partial produ
 000704 53F5 20 D5 54    ~6      jsr shflft      ; ...shift...
 000705 53F8 20 9B 54    ~6      jsr psuml       ; ...now accumulate rest of p
 000706 53FB 20 E9 54    ~6      jsr rc2w3
 000707 53FE 60          ~6      rts
 000708                      
 000709 53FF A2 07       ~2  mzro ldx #7
 000710 5401 A9 00       ~2  @ lda #0
 000711 5403 9D 70 03    ~5      sta w3,x
 000712 5406 CA          ~2      dex
 000713 5407 10 F8       ~2-     bpl @B
 000714 5409 60          ~6      rts
 000715 540A A9 00       ~2  mktbl lda <mtbl     ; create table of multiples o
 000716 540C 85 F0       ~3      sta mptr
 000717 540E A9 01       ~2      lda >mtbl
 000718 5410 85 F1       ~3      sta mptr+1
 000719 5412 85 F3       ~3      sta ptr1+1
 000720 5414 85 F5       ~3      sta ptr2+1
 000721 5416 A9 10       ~2      lda #$10
 000722 5418 85 F2       ~3      sta ptr1
 000723 541A A9 20       ~2      lda #$20
 000724 541C 85 F4       ~3      sta ptr2
 000725 541E A2 07       ~2      ldx #7
 000726 5420 BD 09 03    ~4, @   lda ra+9,x     ; copy multiplier to 1st multi
 000727 5423 9D 10 01    ~5      sta mtbl+$10,x
 000728 5426 CA          ~2      dex
 000729 5427 10 F7       ~2-     bpl @B
 000730 5429 A2 08       ~2      ldx #8
 000731 542B A0 07       ~2  mkolp ldy #7        ; now compute all multiples
 000732 542D 18          ~2      clc
 000733 542E B1 F2       ~5  @   lda (ptr1),y
 000734 5430 79 10 01    ~4,     adc mtbl1,y     ; BCD add
 000735 5433 91 F4       ~6      sta (ptr2),y

                              page 14

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 000736 5435 88          ~2      dey
 000737 5436 10 F6       ~2-     bpl @B
 000738 5438 D8          ~2      cld
 000739 5439 18          ~2      clc             ; bump pointers for next entr
 000740 543A A5 F2       ~3      lda ptr1
 000741 543C 69 10       ~2      adc #$10
 000742 543E 85 F2       ~3      sta ptr1
 000743 5440 18          ~2      clc
 000744 5441 A5 F4       ~3      lda ptr2
 000745 5443 69 10       ~2      adc #$10
 000746 5445 85 F4       ~3      sta ptr2
 000747 5447 F8          ~2      sed
 000748 5448 CA          ~2      dex
 000749 5449 D0 E0       ~2-     bne mkolp
 000750 544B 60          ~6      rts
 000751                      
 000752 544C A2 05       ~2  cw12rab ldx #5
 000753 544E BD 62 03    ~4, @   lda w1+2,x
 000754 5451 9D 0A 03    ~5      sta ra+10,x
 000755 5454 BD 6A 03    ~4,     lda w2+2,x
 000756 5457 9D 1A 03    ~5      sta rb+10,x
 000757 545A CA          ~2      dex
 000758 545B 10 F1       ~2-     bpl @B
 000759 545D 60          ~6      rts
 000760                      ;
 000761                      ;   1st partial sum. add sums of products of high
 000762                      ;   each multiplier byte.
 000763                      ;
 000764 545E =(21598)        psumh
 000765                      ;    lda #4          ; set up pointers to working
 000766 545E A9 03       ~2      lda #3          ; yyyyyyyyyyyyyyyyyyyyyyyyyyy
 000767 5460 85 F3       ~3      sta ptr1+1
 000768 5462 85 F5       ~3      sta ptr2+1
 000769 5464 A9 18       ~2      lda #$18
 000770 5466 85 F2       ~3      sta ptr1
 000771 5468 A9 28       ~2      lda #$28
 000772 546A 85 F4       ~3      sta ptr2
 000773 546C A0 07       ~2      ldy #7
 000774 546E B1 F2       ~5  psh1 lda (ptr1),y   ; get next high digit
 000775 5470 29 F0       ~2      and #$f0
 000776 5472 F0 09       ~2-     beq psh2        ; if zero, no need to add
 000777 5474 85 F0       ~3      sta mptr        ; update pointer to multiple 
 000778 5476 B1 F0       ~5  psh1a lda (mptr),y  ; copy this multiple to resul
 000779 5478 91 F4       ~6      sta (ptr2),y
 000780 547A 88          ~2      dey
 000781 547B 10 F9       ~2-     bpl psh1a
 000782 547D A2 06       ~2  psh2 ldx #6         ; index for number of additio
 000783 547F C6 F2       ~5  molp dec ptr1       ; bump pointers down one byte
 000784 5481 C6 F4       ~5      dec ptr2
 000785 5483 A0 07       ~2      ldy #7          ; index for register length
 000786 5485 B1 F2       ~5      lda (ptr1),y    ; get next digit
 000787 5487 29 F0       ~2      and #$f0
 000788 5489 F0 0C       ~2-     beq noadd       ; if zero, no need to add

                              page 15

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 000789 548B 85 F0       ~3      sta mptr
 000790 548D 18          ~2      clc
 000791 548E B1 F0       ~5  @   lda (mptr),y   ; add multiple of current digi
 000792 5490 71 F4       ~5      adc (ptr2),y
 000793 5492 91 F4       ~6      sta (ptr2),y
 000794 5494 88          ~2      dey
 000795 5495 10 F7       ~2-     bpl @B
 000796 5497 CA          ~2  noadd dex
 000797 5498 10 E5       ~2-     bpl molp        ; next digit
 000798 549A 60          ~6      rts
 000799                      ;
 000800                      ;   2nd partial sum. add sums of products with lo
 000801                      ;   each multiplier byte.
 000802                      ;
 000803 549B A9 19       ~2  psuml lda #$19
 000804 549D 85 F2       ~3      sta ptr1
 000805 549F A9 29       ~2      lda #$29
 000806 54A1 85 F4       ~3      sta ptr2
 000807 54A3 A2 06       ~2      ldx #6
 000808 54A5 C6 F2       ~5  psl1 dec ptr1
 000809 54A7 C6 F4       ~5      dec ptr2
 000810 54A9 A0 07       ~2      ldy #7
 000811 54AB B1 F2       ~5      lda (ptr1),y
 000812 54AD 29 0F       ~2      and #$0f
 000813 54AF F0 20       ~2-     beq psl3        ; if zero, no need to add
 000814 54B1 0A          ~2      asl
 000815 54B2 0A          ~2      asl
 000816 54B3 0A          ~2      asl
 000817 54B4 0A          ~2      asl
 000818 54B5 85 F0       ~3      sta mptr        ; update pointer to table of 
 000819 54B7 18          ~2      clc
 000820 54B8 B1 F0       ~5  psl2 lda (mptr),y
 000821 54BA 71 F4       ~5      adc (ptr2),y
 000822 54BC 91 F4       ~6      sta (ptr2),y
 000823 54BE 88          ~2      dey
 000824 54BF 10 F7       ~2-     bpl psl2
 000825 54C1 90 0E       ~2-     bcc psl3
 000826 54C3 A4 F4       ~3      ldy ptr2
 000827 54C5 88          ~2      dey
 000828                      ;@   lda $400,y ; xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
 000829 54C6 B9 00 03    ~4  @   lda ra,y
 000830 54C9 69 00       ~2      adc #0
 000831                      ;    sta $400,y ; xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
 000832 54CB 99 00 03    ~5      sta ra,y
 000833 54CE 88          ~2      dey
 000834 54CF B0 F5       ~2-     bcs @B
 000835                          
 000836 54D1 CA          ~2  psl3 dex
 000837 54D2 10 D1       ~2-     bpl psl1
 000838 54D4 60          ~6      rts
 000839                      
 000840 54D5 A2 0F       ~2  shflft ldx #15      ; shift 'rc' left
 000841 54D7 A9 00       ~2      lda #0

                              page 16

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 000842 54D9 BC 20 03    ~4, @   ldy rc,x
 000843 54DC 19 54 69    ~4,     ora tlh,y
 000844 54DF 9D 20 03    ~5      sta rc,x
 000845 54E2 B9 F4 69    ~4      lda thl,y
 000846 54E5 CA          ~2      dex
 000847 54E6 10 F1       ~2-     bpl @B
 000848 54E8 60          ~6      rts
 000849                                          ; copy/align 'rc' to 'w3'
 000850 54E9 A9 01       ~2  rc2w3 lda #1
 000851 54EB 85 C2       ~3      sta dadj
 000852 54ED AD 23 03    ~4      lda rc+3
 000853 54F0 29 F0       ~2      and #$f0
 000854 54F2 D0 05       ~2-     bne rct1
 000855 54F4 20 05 55    ~6      jsr shflftc
 000856 54F7 C6 C2       ~5      dec dadj
 000857 54F9 A2 05       ~2  rct1 ldx #5
 000858 54FB BD 23 03    ~4, @   lda rc+3,x
 000859 54FE 9D 72 03    ~5      sta w3+2,x
 000860 5501 CA          ~2      dex
 000861 5502 10 F7       ~2=     bpl @B
 000862 5504 60          ~6      rts
 000863                      
 000864 5505 A2 06       ~2  shflftc ldx #6      ; shift mantissa in 'rc' left
 000865 5507 A9 00       ~2      lda #0
 000866 5509 BC 22 03    ~4, @   ldy rc+2,x
 000867 550C 19 54 69    ~4,     ora tlh,y
 000868 550F 9D 22 03    ~5      sta rc+2,x
 000869 5512 B9 F4 69    ~4      lda thl,y
 000870 5515 CA          ~2      dex
 000871 5516 10 F1       ~2-     bpl @B
 000872 5518 60          ~6      rts                         
 000873                      
 000874 5519 18          ~2  incexp clc      ; increment an exponent
 000875 551A A5 C1       ~3      lda tmp2
 000876 551C 69 01       ~2      adc #1
 000877 551E 85 C1       ~3      sta tmp2
 000878 5520 A5 C0       ~3      lda tmp1
 000879 5522 69 00       ~2      adc #0
 000880 5524 85 C0       ~3      sta tmp1
 000881 5526 60          ~6      rts
 000882                      
 000883 5527 38          ~2  decexp sec      ; decrement an exponent 
 000884 5528 A5 C1       ~3      lda tmp2
 000885 552A E9 01       ~2      sbc #1
 000886 552C 85 C1       ~3      sta tmp2
 000887 552E A5 C0       ~3      lda tmp1
 000888 5530 E9 00       ~2      sbc #0
 000889 5532 85 C0       ~3      sta tmp1
 000890 5534 60          ~6      rts
 000891                      ;
 000892                      ;   divide routines
 000893                      ;
 000894                      ;   The divide algorithm uses tables of multiples

                              page 17

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 000895                      ;   multiply algorithm. In this case each multipl
 000896                      ;   for subtraction from the current remainder. A
 000897                      ;   weeds out multiples which are unsuitable for 
 000898                      ;   subtraction and a recovery routine is invoked
 000899                      ;   that an underflow occurs anyway.
 000900                      ;
 000901 5535 F8          ~2  div sed
 000902                      ;   weed out zero divisor or dividend
 000903 5536 AD 6A 03    ~4      lda w2+2
 000904 5539 D0 03       ~2-     bne @F
 000905 553B 4C 47 69    ~3      jmp dvzrerr
 000906 553E AD 62 03    ~4  @   lda w1+2
 000907 5541 D0 0B       ~2-     bne d1b
 000908 5543 A9 00       ~2      lda #0
 000909 5545 A0 07       ~2      ldy #7
 000910 5547 99 70 03    ~5  d0b sta w3,y            ; dividend is zero, retur
 000911 554A 88          ~2      dey
 000912 554B 10 FA       ~2-     bpl d0b
 000913 554D 60          ~6      rts
 000914 554E A9 00       ~2  d1b lda #0
 000915 5550 A2 2F       ~2      ldx #47
 000916 5552 9D 00 03    ~5  d1  sta ra,x            ; clear out working area
 000917 5555 CA          ~2      dex
 000918 5556 10 FA       ~2-     bpl d1
 000919 5558 A2 05       ~2      ldx #5              ; copy mantissas from w1/
 000920 555A BD 6A 03    ~4, d2  lda w2+2,x          ; (ra is divisor, rb is w
 000921 555D 9D 0A 03    ~5      sta ra+10,x
 000922 5560 BD 62 03    ~4,     lda w1+2,x
 000923 5563 9D 12 03    ~5      sta rb+2,x
 000924 5566 CA          ~2      dex
 000925 5567 10 F1       ~2-     bpl d2
 000926 5569 20 0A 54    ~6      jsr mktbl           ; create table of multipl
 000927 556C 20 D2 56    ~6      jsr shftlft         ; initialize remainder fo
 000928 556F A9 0F       ~2      lda #15             ; digit counter
 000929 5571 85 C4       ~3      sta ctr2
 000930 5573 20 13 56    ~6  onedig jsr decdiv       ; divide, one digit at a 
 000931 5576 C6 C4       ~5      dec ctr2
 000932 5578 D0 F9       ~2-     bne onedig
 000933 557A A9 01       ~2      lda #1          ; copy result to w3 mantissa 
 000934 557C 85 C2       ~3      sta dadj
 000935 557E AD 18 03    ~4      lda rb+8
 000936 5581 F0 12       ~2-     beq od1
 000937 5583 20 D2 56    ~6      jsr shftlft
 000938 5586 C6 C2       ~5      dec dadj
 000939 5588 A2 05       ~2      ldx #5
 000940 558A BD 18 03    ~4, od2 lda rb+8,x
 000941 558D 9D 72 03    ~5      sta w3+2,x
 000942 5590 CA          ~2      dex
 000943 5591 10 F7       ~2-     bpl od2
 000944 5593 30 0B       ~2-     bmi od4         ; branch always
 000945 5595 A2 05       ~2  od1 ldx #5
 000946 5597 BD 19 03    ~4, od3 lda rb+9,x
 000947 559A 9D 72 03    ~5      sta w3+2,x

                              page 18

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 000948 559D CA          ~2      dex
 000949 559E 10 F7       ~2-     bpl od3
 000950                      ;
 000951                      ;   handle exponent
 000952                      ;
 000953 55A0 AD 60 03    ~4  od4 lda w1
 000954 55A3 4D 68 03    ~4      eor w2
 000955 55A6 29 40       ~2      and #$40        ; compare exponent signs
 000956 55A8 F0 09       ~2-     beq exd
 000957 55AA 20 A3 51    ~6      jsr sumexp
 000958 55AD AD 60 03    ~4      lda w1
 000959 55B0 4C BD 55    ~3      jmp dexpadj
 000960 55B3 20 C2 51    ~6  exd jsr diffexp     ; exponent signs are the same
 000961 55B6 AD 68 03    ~4      lda w2
 000962 55B9 B0 02       ~2-     bcs dexpadj     ; carry: divisor exp >= divid
 000963 55BB 49 40       ~2      eor #$40
 000964 55BD 29 40       ~2  dexpadj and #$40
 000965 55BF 8D 70 03    ~4      sta w3
 000966 55C2 2C 70 03    ~4      bit w3
 000967 55C5 70 19       ~2-     bvs od5         ; branch to negative exponent
 000968 55C7 A5 C2       ~3      lda dadj        ; positive exponent
 000969 55C9 F0 22       ~2-     beq od6
 000970 55CB A5 C1       ~3      lda tmp2
 000971 55CD 05 C0       ~3      ora tmp1
 000972 55CF D0 19       ~2-     bne od5a
 000973 55D1 A9 01       ~2      lda #1          ; unadjusted exponent is zero
 000974 55D3 85 C1       ~3      sta tmp2
 000975 55D5 A9 40       ~2      lda #$40
 000976 55D7 0D 70 03    ~4      ora w3
 000977 55DA 8D 70 03    ~4      sta w3
 000978 55DD 4C ED 55    ~3      jmp od6
 000979 55E0 A5 C2       ~3  od5 lda dadj
 000980 55E2 F0 09       ~2-     beq od6
 000981 55E4 20 19 55    ~6      jsr incexp
 000982 55E7 4C ED 55    ~3      jmp od6
 000983 55EA 20 27 55    ~6  od5a jsr decexp
 000984 55ED A5 C1       ~3  od6 lda tmp2    ; now copy adjusted exponent
 000985 55EF 8D 71 03    ~4      sta w3+1
 000986 55F2 A5 C0       ~3      lda tmp1
 000987 55F4 0D 70 03    ~4      ora w3
 000988 55F7 8D 70 03    ~4      sta w3
 000989 55FA 29 0F       ~2      and #$0f    ; test for condition of zero expo
 000990 55FC 0D 71 03    ~4      ora w3+1    ; ...and clear exponent sign, if 
 000991 55FF D0 03       ~2-     bne odx
 000992 5601 8D 70 03    ~4      sta w3
 000993 5604 =(22020)        odx
 000994 5604 AD 60 03    ~4      lda w1      ; finally, set +/- mantissa sign.
 000995 5607 4D 68 03    ~4      eor w2
 000996 560A 29 80       ~2      and #$80
 000997 560C 0D 70 03    ~4      ora w3
 000998 560F 8D 70 03    ~4      sta w3
 000999 5612 60          ~6      rts
 001000                      

                              page 19

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 001001 5613 A9 09       ~2  decdiv lda #9       ; compute next quotient digit
 001002 5615 85 C3       ~3      sta ctr1
 001003 5617 AD 10 03    ~4      lda rb
 001004 561A AE 11 03    ~4      ldx rb+1
 001005 561D CD 90 01    ~4      cmp mtbl+$90    ; check 9th multiple for vali
 001006 5620 90 07       ~2-     bcc @F
 001007 5622 D0 7D       ~2-     bne dsub
 001008 5624 EC 91 01    ~4      cpx mtbl+$91
 001009 5627 B0 78       ~2-     bcs dsub
 001010 5629 C6 C3       ~5  @   dec ctr1
 001011 562B CD 80 01    ~4      cmp mtbl+$80    ; check 8th multiple
 001012 562E 90 07       ~2-     bcc @F
 001013 5630 D0 6F       ~2-     bne dsub
 001014 5632 EC 81 01    ~4      cpx mtbl+$81
 001015 5635 B0 6A       ~2-     bcs dsub
 001016 5637 C6 C3       ~5  @   dec ctr1
 001017 5639 CD 70 01    ~4      cmp mtbl+$70    ; check 7th multiple
 001018 563C 90 07       ~2-     bcc @F
 001019 563E D0 61       ~2-     bne dsub
 001020 5640 EC 71 01    ~4      cpx mtbl+$71
 001021 5643 B0 5C       ~2-     bcs dsub
 001022 5645 C6 C3       ~5  @   dec ctr1
 001023 5647 CD 60 01    ~4      cmp mtbl+$60    ; check 6th multiple
 001024 564A 90 07       ~2-     bcc @F
 001025 564C D0 53       ~2-     bne dsub
 001026 564E EC 61 01    ~4      cpx mtbl+$61
 001027 5651 B0 4E       ~2-     bcs dsub
 001028 5653 C6 C3       ~5  @   dec ctr1
 001029 5655 CD 50 01    ~4      cmp mtbl+$50    ; check 5th multiple
 001030 5658 90 07       ~2-     bcc @F
 001031 565A D0 45       ~2-     bne dsub
 001032 565C EC 51 01    ~4      cpx mtbl+$51
 001033 565F B0 40       ~2-     bcs dsub
 001034 5661 C6 C3       ~5  @   dec ctr1        
 001035 5663 CD 40 01    ~4      cmp mtbl+$40    ; check 4th multiple
 001036 5666 90 07       ~2-     bcc @F
 001037 5668 D0 37       ~2-     bne dsub
 001038 566A EC 41 01    ~4      cpx mtbl+$41
 001039 566D B0 32       ~2-     bcs dsub
 001040 566F C6 C3       ~5  @   dec ctr1
 001041 5671 CD 30 01    ~4      cmp mtbl+$30    ; check 3rd multiple
 001042 5674 90 07       ~2-     bcc @F
 001043 5676 D0 29       ~2-     bne dsub
 001044 5678 EC 31 01    ~4      cpx mtbl+$31
 001045 567B B0 24       ~2-     bcs dsub
 001046 567D C6 C3       ~5  @   dec ctr1
 001047 567F CD 20 01    ~4      cmp mtbl+$20    ; check 2nd multiple
 001048 5682 90 07       ~2-     bcc @F
 001049 5684 D0 1B       ~2-     bne dsub
 001050 5686 EC 21 01    ~4      cpx mtbl+$21
 001051 5689 B0 16       ~2-     bcs dsub
 001052 568B C6 C3       ~5  @   dec ctr1
 001053 568D CD 10 01    ~4      cmp mtbl+$10    ; check 1st multiple    

                              page 20

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 001054 5690 90 07       ~2-     bcc @F
 001055 5692 D0 0D       ~2-     bne dsub
 001056 5694 EC 11 01    ~4      cpx mtbl+$11
 001057 5697 B0 08       ~2-     bcs dsub
 001058 5699 C6 C3       ~5  @   dec ctr1        ; must be zero
 001059 569B 2D 1F 03    ~4      and rb+15,$f0
 001060 569E 4C D2 56    ~3      jmp shftlft
 001061 56A1 AD 1F 03    ~4  dsub lda rb+15          ; save current digit in r
 001062 56A4 29 F0       ~2      and #$f0
 001063 56A6 05 C3       ~3      ora ctr1
 001064 56A8 8D 1F 03    ~4      sta rb+15
 001065 56AB 0A          ~2      asl
 001066 56AC 0A          ~2      asl
 001067 56AD 0A          ~2      asl
 001068 56AE 0A          ~2      asl
 001069 56AF 85 F2       ~3      sta ptr1
 001070 56B1 A0 07       ~2      ldy #7
 001071 56B3 38          ~2      sec
 001072 56B4 B9 10 03    ~4  sulp lda rb,y           ; shift remainder (and qu
 001073 56B7 F1 F2       ~5      sbc (ptr1),y
 001074 56B9 99 10 03    ~5      sta rb,y
 001075 56BC 88          ~2      dey
 001076 56BD 10 F5       ~2-     bpl sulp
 001077 56BF B0 11       ~2-     bcs shftlft     ; branch if no correction is 
 001078 56C1 CE 1F 03    ~6      dec rb+15       ; here we recover from underf
 001079 56C4 A0 07       ~2      ldy #7          ;  subtracting a too-large mu
 001080 56C6 B9 10 03    ~4  @   lda rb,y       ; correct remainder after unde
 001081 56C9 79 10 01    ~4,     adc mtbl+$10,y  ;  by adding 1st multiple bac
 001082 56CC 99 10 03    ~5      sta rb,y
 001083 56CF 88          ~2      dey
 001084 56D0 10 F4       ~2-     bpl @B
 001085 56D2 A2 0F       ~2  shftlft ldx #15      ; shift remainder register i
 001086 56D4 A9 00       ~2      lda #0
 001087 56D6 BC 10 03    ~4, @   ldy rb,x
 001088 56D9 19 54 69    ~4,     ora tlh,y
 001089 56DC 9D 10 03    ~5      sta rb,x
 001090 56DF B9 F4 69    ~4      lda thl,y
 001091 56E2 CA          ~2      dex
 001092 56E3 10 F1       ~2-     bpl @B
 001093 56E5 60          ~6      rts                         
 001094                      ;
 001095                      ;   square root routines
 001096                      ;
 001097                      ;   (C) 1999, C. Bond. Finds square root of BCD n
 001098                      ;       non-restoring pseudo-division.
 001099                      ;
 001100 56E6 F8          ~2  sqrt sed
 001101 56E7 AD 62 03    ~4      lda w1+2
 001102 56EA D0 0B       ~2-     bne sq0     ; check for zero
 001103 56EC A2 07       ~2      ldx #7
 001104 56EE A9 00       ~2      lda #0
 001105 56F0 9D 70 03    ~5  @   sta w3,x   ; square root of zero, clear resul
 001106 56F3 CA          ~2      dex

                              page 21

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 001107 56F4 10 FA       ~2-     bpl @B
 001108 56F6 60          ~6      rts
 001109 56F7 2C 60 03    ~4  sq0 bit w1      ; check for negative number...
 001110 56FA 10 03       ~2-     bpl sq0b    ; ...and return with domain error
 001111 56FC 4C 23 69    ~3      jmp domnerr
 001112 56FF A2 0F       ~2  sq0b ldx #15
 001113 5701 A9 00       ~2      lda #0
 001114 5703 9D 00 03    ~5  @   sta ra,x        ; clear working register
 001115 5706 CA          ~2      dex
 001116 5707 10 FA       ~2-     bpl @B
 001117 5709 A2 07       ~2      ldx #7
 001118 570B BD 62 03    ~4, @   lda w1+2,x
 001119 570E 9D 02 03    ~5      sta ra+2,x      ; now copy mantissa to ra
 001120 5711 CA          ~2      dex
 001121 5712 10 F7       ~2-     bpl @B
 001122 5714 AD 61 03    ~4      lda w1+1        ; check for odd exponent to f
 001123 5717 29 01       ~2      and #1
 001124 5719 D0 13       ~2-     bne sq2
 001125 571B A2 07       ~2      ldx #7          ; even exponent, shift right 
 001126 571D A9 00       ~2      lda #0
 001127 571F BC 00 03    ~4  @   ldy ra,x
 001128 5722 19 54 69    ~4,     ora tlh,y
 001129 5725 9D 01 03    ~5      sta ra+1,x
 001130 5728 B9 F4 69    ~4      lda thl,y
 001131 572B CA          ~2      dex
 001132 572C 10 F1       ~2-     bpl @B
 001133 572E A2 07       ~2  sq2 ldx #7          ; multiply mantissa by 5
 001134 5730 18          ~2      clc
 001135 5731 BD 01 03    ~4, @   lda ra+1,x
 001136 5734 7D 01 03    ~4,     adc ra+1,x
 001137 5737 9D 11 03    ~5      sta rb+1,x
 001138 573A CA          ~2      dex
 001139 573B 10 F4       ~2-     bpl @B
 001140 573D A2 07       ~2      ldx #7          ; rb = 2 * ra
 001141 573F 18          ~2      clc
 001142 5740 BD 11 03    ~4, @   lda rb+1,x
 001143 5743 7D 11 03    ~4,     adc rb+1,x
 001144 5746 9D 11 03    ~5      sta rb+1,x
 001145 5749 CA          ~2      dex
 001146 574A 10 F4       ~2-     bpl @B
 001147 574C A2 07       ~2      ldx #7
 001148 574E 18          ~2      clc
 001149 574F BD 01 03    ~4, @   lda ra+1,x
 001150 5752 7D 11 03    ~4,     adc rb+1,x
 001151 5755 9D 01 03    ~5      sta ra+1,x
 001152 5758 CA          ~2      dex
 001153 5759 10 F4       ~2-     bpl @B
 001154                                          ; ra = 5 * ra
 001155 575B A9 01       ~2      lda #1
 001156 575D 85 F2       ~3      sta ptr1        ; index used by pseudo-diviso
 001157 575F A9 00       ~2      lda #$0
 001158 5761 8D 10 03    ~4      sta rb
 001159 5764 A9 06       ~2      lda #6          ; number of digits counter (x

                              page 22

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 001160 5766 85 C3       ~3      sta ctr1
 001161                          
 001162 5768 A6 F2       ~3  sq2d ldx ptr1
 001163 576A A9 05       ~2      lda #$05
 001164 576C 9D 10 03    ~5      sta rb,x
 001165 576F 20 E4 57    ~6      jsr sq3
 001166 5772 C6 C3       ~5      dec ctr1
 001167 5774 30 06       ~2-     bmi sqx
 001168 5776 20 31 58    ~6      jsr sarlft
 001169 5779 4C 68 57    ~3      jmp sq2d
 001170 577C =(22396)        sqx
 001171 577C A2 07       ~2      ldx #7
 001172 577E A9 00       ~2      lda #0
 001173 5780 BC 11 03    ~4, @   ldy rb+1,x    ;shift rb left one digit
 001174 5783 19 54 69    ~4,     ora tlh,y
 001175 5786 9D 11 03    ~5      sta rb+1,x
 001176 5789 B9 F4 69    ~4      lda thl,y
 001177 578C CA          ~2      dex
 001178 578D 10 F1       ~2-     bpl @B
 001179                      
 001180 578F A2 05       ~2      ldx #5
 001181 5791 BD 11 03    ~4, sqx1b lda rb+1,x    ; move mantissa to result reg
 001182 5794 9D 72 03    ~5      sta w3+2,x
 001183 5797 CA          ~2      dex
 001184 5798 10 F7       ~2-     bpl sqx1b
 001185 579A AD 61 03    ~4      lda w1+1        ; calculate exponent (divide 
 001186 579D 8D 71 03    ~4      sta w3+1
 001187 57A0 AD 60 03    ~4      lda w1
 001188 57A3 29 0F       ~2      and #$0f
 001189 57A5 8D 70 03    ~4      sta w3
 001190 57A8 4E 70 03    ~6      lsr w3
 001191 57AB 6E 71 03    ~6      ror w3+1        ; shift exponent right one bi
 001192 57AE AC 70 03    ~4      ldy w3
 001193 57B1 B9 98 6B    ~4      lda srtbl,y     ; ...and translate to perform
 001194 57B4 8D 70 03    ~4      sta w3
 001195 57B7 AC 71 03    ~4      ldy w3+1
 001196 57BA B9 98 6B    ~4      lda srtbl,y
 001197 57BD 8D 71 03    ~4      sta w3+1
 001198 57C0 2C 60 03    ~4      bit w1          ; is exponent negative?
 001199 57C3 50 1E       ~2-     bvc sqxx
 001200 57C5 AD 61 03    ~4      lda w1+1        ; if so, adjust the exponent.
 001201 57C8 29 01       ~2      and #$1
 001202 57CA F0 0F       ~2-     beq sqxc
 001203 57CC 18          ~2      clc
 001204 57CD 6D 71 03    ~4      adc w3+1
 001205 57D0 8D 71 03    ~4      sta w3+1
 001206 57D3 AD 70 03    ~4      lda w3
 001207 57D6 69 00       ~2      adc #0
 001208 57D8 8D 70 03    ~4      sta w3
 001209 57DB A9 40       ~2  sqxc lda #$40       ; ...and correct the result s
 001210 57DD 0D 70 03    ~4      ora w3
 001211 57E0 8D 70 03    ~4      sta w3
 001212 57E3 =(22499)        sqxx

                              page 23

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 001213 57E3 60          ~6      rts
 001214                      
 001215 57E4 A6 F2       ~3  sq3 ldx ptr1
 001216 57E6 38          ~2      sec
 001217 57E7 BD 00 03    ~4  @   lda ra,x
 001218 57EA FD 10 03    ~4,     sbc rb,x
 001219 57ED 9D 00 03    ~5      sta ra,x
 001220 57F0 CA          ~2      dex
 001221 57F1 10 F4       ~2-     bpl @B
 001222 57F3 90 0D       ~2=     bcc sq4
 001223 57F5 A6 F2       ~3      ldx ptr1
 001224 57F7 18          ~2      clc
 001225 57F8 BD 10 03    ~4,     lda rb,x
 001226 57FB 69 10       ~2      adc #$10
 001227 57FD 9D 10 03    ~5      sta rb,x
 001228 5800 90 E2       ~2=     bcc sq3
 001229 5802 =(22530)        sq4
 001230 5802 A6 F2       ~3      ldx ptr1
 001231 5804 BD 10 03    ~4,     lda rb,x
 001232 5807 29 F0       ~2      and #$f0
 001233 5809 09 09       ~3      ora #$9
 001234 580B 9D 10 03    ~5      sta rb,x
 001235 580E A9 50       ~2      lda #$50
 001236 5810 9D 11 03    ~5      sta rb+1,x
 001237 5813 20 31 58    ~6      jsr sarlft
 001238 5816 E6 F2       ~5      inc ptr1
 001239 5818 A6 F2       ~3  sq5 ldx ptr1
 001240 581A 18          ~2      clc
 001241 581B BD 00 03    ~4  @   lda ra,x
 001242 581E 7D 10 03    ~4,     adc rb,x
 001243 5821 9D 00 03    ~5      sta ra,x
 001244 5824 CA          ~2      dex
 001245 5825 10 F4       ~2-     bpl @B
 001246 5827 B0 07       ~2-     bcs sq6
 001247 5829 A6 F2       ~3      ldx ptr1
 001248 582B DE 0F 03    ~6      dec rb-1,x
 001249 582E 90 E8       ~2-     bcc sq5
 001250 5830 =(22576)        sq6
 001251 5830 60          ~6      rts
 001252 5831 A2 0F       ~2  sarlft ldx #15
 001253 5833 A9 00       ~2      lda #0
 001254 5835 BC 00 03    ~4  @   ldy ra,x
 001255 5838 19 54 69    ~4,     ora tlh,y
 001256 583B 9D 00 03    ~5      sta ra,x
 001257 583E B9 F4 69    ~4      lda thl,y
 001258 5841 CA          ~2      dex
 001259 5842 10 F1       ~2-     bpl @B
 001260 5844 60          ~6      rts
 001261                      ;
 001262                      ;   poly routines
 001263                      ;
 001264                      ;   Evaluate a polynomial given a list of polynom
 001265                      ;    and argument.

                              page 24

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 001266                      ;   On entry, the argument must be in register 'a
 001267                      ;    pointer to the coefficient list must be in '
 001268                      ;    number of coefficients is in 'ctr1'.
 001269                      ;
 001270                      ;   Coefficients are in high-to-low order.
 001271                      ;
 001272                      ;   This implementation evaluates a polynomial in
 001273                      ;    squared.
 001274                      ;    
 001275 5845 F8          ~2  poly sed
 001276 5846 C6 C6       ~5      dec pctr
 001277                      ;
 001278                      ;   pre-loop initialization
 001279                      ;
 001280                          
 001281 5848 A2 07       ~2      ldx #7
 001282 584A BD 88 03    ~4' pl00 lda arg,x      ; get the argument, as given.
 001283 584D 9D 60 03    ~5      sta w1,x
 001284 5850 9D 68 03    ~5      sta w2,x
 001285 5853 CA          ~2      dex
 001286 5854 10 F4       ~2-     bpl pl00
 001287 5856 20 78 53    ~6      jsr mul         ; ...and square it for this r
 001288 5859 A2 07       ~2      ldx #7
 001289 585B BD 70 03    ~4, pl00a lda w3,x      ; (replace original argument 
 001290 585E 9D 88 03    ~5      sta arg,x
 001291 5861 CA          ~2      dex
 001292 5862 10 F7       ~2-     bpl pl00a
 001293 5864 A0 07       ~2      ldy #7
 001294 5866 B1 F8       ~5  pl0 lda (pptr),y    ; move 1st coefficient to w3
 001295 5868 99 70 03    ~5      sta w3,y
 001296 586B 88          ~2      dey
 001297 586C 10 F8       ~2-     bpl pl0
 001298                      ;
 001299                      ;   now enter main loop
 001300                      ;
 001301 586E 20 9D 58    ~6  pl1 jsr argtow1       ; get argument ...
 001302 5871 20 A9 58    ~6      jsr w3tow2      ; ... and current result
 001303 5874 20 78 53    ~6      jsr mul         ; w3 <- product
 001304 5877 D8          ~2      cld
 001305 5878 18          ~2      clc
 001306 5879 A5 F8       ~3      lda pptr        ; bump coefficient pointer to
 001307 587B 69 08       ~2      adc #8
 001308 587D 85 F8       ~3      sta pptr
 001309 587F 90 02       ~2-     bcc pl1a
 001310 5881 E6 F9       ~5      inc pptr+1
 001311 5883 F8          ~2  pl1a sed
 001312 5884 20 92 58    ~6      jsr ctow1      ; get next coefficient...
 001313 5887 20 A9 58    ~6      jsr w3tow2      ; ... and add to current resu
 001314 588A 20 B6 50    ~6      jsr add
 001315 588D C6 C6       ~5      dec pctr
 001316 588F D0 DD       ~2-     bne pl1
 001317 5891 60          ~6      rts
 001318                      

                              page 25

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 001319 5892 A0 07       ~2  ctow1 ldy #7
 001320 5894 B1 F8       ~5  cwa lda (pptr),y
 001321 5896 99 60 03    ~5      sta w1,y
 001322 5899 88          ~2      dey
 001323 589A 10 F8       ~2-     bpl cwa
 001324 589C 60          ~6      rts
 001325 589D A2 07       ~2  argtow1 ldx #7
 001326 589F BD 88 03    ~4' awa lda arg,x
 001327 58A2 9D 60 03    ~5      sta w1,x
 001328 58A5 CA          ~2      dex
 001329 58A6 10 F7       ~2-     bpl awa
 001330 58A8 60          ~6      rts
 001331 58A9 A2 07       ~2  w3tow2 ldx #7
 001332 58AB BD 70 03    ~4, w32a lda w3,x
 001333 58AE 9D 68 03    ~5      sta w2,x
 001334 58B1 CA          ~2      dex
 001335 58B2 10 F7       ~2-     bpl w32a
 001336 58B4 60          ~6      rts
 001337                      ;
 001338                      ;   secant -- calculates secant function: sec(x) 
 001339                      ;
 001340                      ;   w3 = secant(w1)
 001341                      ;
 001342 58B5 20 4C 59    ~6  sec jsr tan
 001343 58B8 A9 70       ~2      lda <w3
 001344 58BA A0 03       ~2      ldy >w3
 001345 58BC A2 78       ~2      ldx #w4
 001346 58BE 20 30 52    ~6      jsr copy2w      ; save tangent for (possible)
 001347 58C1 A9 70       ~2      lda <w3
 001348 58C3 A0 03       ~2      ldy >w3
 001349 58C5 A2 60       ~2      ldx #w1
 001350 58C7 20 30 52    ~6      jsr copy2w
 001351 58CA A9 70       ~2      lda <w3
 001352 58CC A0 03       ~2      ldy >w3
 001353 58CE A2 68       ~2      ldx #w2
 001354 58D0 20 30 52    ~6      jsr copy2w
 001355 58D3 20 78 53    ~6      jsr mul         ; w3 contains tan^2
 001356 58D6 A9 70       ~2      lda <w3
 001357 58D8 A0 03       ~2      ldy >w3
 001358 58DA A2 68       ~2      ldx #w2
 001359 58DC 20 30 52    ~6      jsr copy2w
 001360 58DF A9 A0       ~2      lda <unit
 001361 58E1 A0 6D       ~2      ldy >unit
 001362 58E3 A2 60       ~2      ldx #w1
 001363 58E5 20 30 52    ~6      jsr copy2w     ; w3 = 1 + tan^2
 001364 58E8 20 B6 50    ~6      jsr add
 001365 58EB A9 70       ~2      lda <w3
 001366 58ED A0 03       ~2      ldy >w3
 001367 58EF A2 60       ~2      ldx #w1
 001368 58F1 20 30 52    ~6      jsr copy2w
 001369 58F4 20 E6 56    ~6      jsr sqrt        ; w3 = sqrt(1 + tan^2), w4 = 
 001370 58F7 A5 C9       ~3      lda qdrnt
 001371 58F9 C9 01       ~2      cmp #1

                              page 26

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 001372 58FB F0 0C       ~2=     beq @F
 001373 58FD C9 04       ~2      cmp #4
 001374 58FF F0 08       ~2-     beq @f
 001375 5901 AD 70 03    ~4      lda w3
 001376 5904 09 80       ~3      ora #$80
 001377 5906 8D 70 03    ~4      sta w3
 001378 5909 60          ~6  @   rts
 001379                      ;
 001380                      ;   sin -- calculates sine function:  sin(x) = ta
 001381                      ;
 001382 590A 20 B5 58    ~6  sin jsr sec
 001383 590D A9 70       ~2      lda <w3
 001384 590F A0 03       ~2      ldy >w3
 001385 5911 A2 68       ~2      ldx #w2
 001386 5913 20 30 52    ~6      jsr copy2w
 001387 5916 A9 78       ~2      lda <w4
 001388 5918 A0 03       ~2      ldy >w4
 001389 591A A2 60       ~2      ldx #w1
 001390 591C 20 30 52    ~6      jsr copy2w
 001391 591F 20 35 55    ~6      jsr div
 001392 5922 AD 70 03    ~4      lda w3
 001393 5925 29 7F       ~2      and #$7f
 001394 5927 A6 C9       ~3      ldx qdrnt
 001395 5929 E0 03       ~2      cpx #3
 001396 592B 90 02       ~2-     bcc @F
 001397 592D 09 80       ~3      ora #$80
 001398 592F 8D 70 03    ~4  @   sta w3
 001399 5932 60          ~6      rts
 001400                      ;
 001401                      ;   cos -- cos(x) = 1/sec(x)
 001402                      ;
 001403 5933 20 B5 58    ~6  cos jsr sec
 001404 5936 A9 70       ~2      lda <w3
 001405 5938 A0 03       ~2      ldy >w3
 001406 593A A2 68       ~2      ldx #w2
 001407 593C 20 30 52    ~6      jsr copy2w
 001408 593F A9 A0       ~2      lda <unit
 001409 5941 A0 6D       ~2      ldy >unit
 001410 5943 A2 60       ~2      ldx #w1
 001411 5945 20 30 52    ~6      jsr copy2w
 001412 5948 20 35 55    ~6      jsr div
 001413 594B 60          ~6      rts
 001414                      
 001415                      ;
 001416                      ;   CORDIC routine to calculate tangent of given 
 001417                      ;
 001418                      ;   On entry, 'w1' contains the angle, on exit 'w
 001419                      ;
 001420                      ;   'ra' is used for resolving the angle, where '
 001421                      ;   pseudo-quotient. After this 'ra', 'rb', 'rc' 
 001422                      ;   working registers for pseudo-multiplication.
 001423                      ;
 001424                      ;   The computation strategy is as follows:

                              page 27

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 001425                      ;
 001426                      ;   1. Scale the given argument.
 001427                      ;      . divide the argument by 2pi,
 001428                      ;      . discard the integer part of the result,
 001429                      ;      . multiply the fractional part by 2pi.
 001430                      ;   2. If the result < 0 add 2pi so reference ang
 001431                      ;   3. Find and set quadrant and tnsgn, quadrant 
 001432                      ;   4. If arg > pi subtract pi
 001433                      ;   5. if arg > pi/2 subtract pi
 001434                      ;   6. The scaled argument has the same tangent a
 001435                      ;      It is now in quadrant I or IV.
 001436                      ;      . take the absolute value of the argument.
 001437                      ;   7. The argument is now in the range 0 <= arg 
 001438                      ;      . set 'cotflg' = 0
 001439                      ;   8. If the argument exceeds pi/4,
 001440                      ;      . subtract argument from pi
 001441                      ;      . toggle 'cotflg' = 1
 001442                      ;   9. Calculate tangent (see CORDIC description)
 001443                      ;  10. Correct sign of result using 'tnsgn'.
 001444                      ;  11. If 'cotflg' = 1 take reciprocal of result.
 001445                      ;  12. Return F.P. value in w3.
 001446                      ;
 001447                      ;
 001448 594C A9 00       ~2  tan lda #0
 001449 594E 85 CA       ~3  tan0 sta cotflg
 001450 5950 F8          ~2      sed
 001451 5951 A9 00       ~2      lda #0
 001452 5953 85 C8       ~3      sta tnsgn
 001453 5955 20 57 67    ~6      jsr tanscale    ; reduce argument to range: 0
 001454 5958 A9 70       ~2      lda <w3         ; move scaled argument to w1
 001455 595A A0 03       ~2      ldy >w3
 001456 595C A2 60       ~2      ldx #w1
 001457 595E 20 30 52    ~6      jsr copy2w
 001458 5961 AD 72 03    ~4      lda w3+2
 001459 5964 D0 01       ~2-     bne @F
 001460 5966 60          ~6      rts
 001461 5967 20 A9 59    ~6  @   jsr tanx        ; get tangent
 001462 596A AD 70 03    ~4      lda w3
 001463 596D 05 C8       ~3      ora tnsgn       ; correct sign
 001464 596F 8D 70 03    ~4      sta w3
 001465 5972 A5 CA       ~3      lda cotflg
 001466 5974 F0 15       ~2-     beq @F
 001467 5976 A9 A0       ~2      lda <unit       ; take reciprocal if cotangen
 001468 5978 A0 6D       ~2      ldy >unit
 001469 597A A2 60       ~2      ldx #w1
 001470 597C 20 30 52    ~6      jsr copy2w
 001471 597F A9 70       ~2      lda <w3
 001472 5981 A0 03       ~2      ldy >w3
 001473 5983 A2 68       ~2      ldx #w2
 001474 5985 20 30 52    ~6      jsr copy2w
 001475 5988 20 35 55    ~6      jsr div
 001476 598B 60          ~6  @   rts
 001477                      

                              page 28

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 001478 598C A9 01       ~2  cot lda #1
 001479 598E 4C 4E 59    ~3      jmp tan0
 001480 5991 20 0A 59    ~6  csc jsr sin
 001481 5994 A9 70       ~2      lda <w3
 001482 5996 A0 03       ~2      ldy > w3
 001483 5998 A2 68       ~2      ldx #w2
 001484 599A 20 30 52    ~6      jsr copy2w
 001485 599D A9 A0       ~2      lda <unit
 001486 599F A0 6D       ~2      ldy >unit
 001487 59A1 A2 60       ~2      ldx #w1
 001488 59A3 20 30 52    ~6      jsr copy2w
 001489 59A6 4C 35 55    ~3      jmp div
 001490                      
 001491 59A9 =(22953)        tanx                ; main tangent routine
 001492 59A9 AD 62 03    ~4      lda w1+2
 001493 59AC D0 0B       ~2-     bne tn0
 001494 59AE A9 00       ~2  tn0x lda #0
 001495 59B0 A2 07       ~2      ldx #7
 001496 59B2 9D 70 03    ~5  @   sta w3,x        ; argument is zero, clear 'w3
 001497 59B5 CA          ~2      dex
 001498 59B6 10 FA       ~2-     bpl @B
 001499 59B8 60          ~6      rts
 001500 59B9 2C 60 03    ~4  tn0 bit w1
 001501 59BC 50 1A       ~2-     bvc tn0x1
 001502 59BE AD 60 03    ~4      lda w1          ; exponent is negative, check
 001503 59C1 29 0F       ~2      and #$0f
 001504 59C3 D0 07       ~2-     bne tn0x1a      ; large exponent -- return ar
 001505 59C5 AD 61 03    ~4      lda w1+1
 001506 59C8 C9 08       ~2      cmp #8
 001507 59CA 90 0C       ~2-     bcc tn0x1
 001508 59CC A2 07       ~2  tn0x1a ldx #7
 001509 59CE BD 60 03    ~4, @   lda w1,x        ; large neg exponent -- retur
 001510 59D1 9D 70 03    ~5      sta w3,x
 001511 59D4 CA          ~2      dex
 001512 59D5 10 F7       ~2-     bpl @B
 001513 59D7 60          ~6      rts
 001514 59D8 =(23000)        tn0x1
 001515 59D8 A2 2F       ~2      ldx #3*wreglen-1
 001516 59DA A9 00       ~2      lda #0          ; clear working registers
 001517 59DC 9D 00 03    ~5  tn0xb    sta ra,x   
 001518 59DF CA          ~2      dex
 001519 59E0 10 FA       ~2-     bpl tn0xb
 001520 59E2 A9 48       ~2      lda <kxatn      ; initialize arctangent table
 001521 59E4 85 F2       ~3      sta ptr1
 001522 59E6 A9 6E       ~2      lda >kxatn
 001523 59E8 85 F3       ~3      sta ptr1+1
 001524                      ;
 001525 59EA AD 61 03    ~4      lda w1+1
 001526 59ED 4A          ~2      lsr
 001527 59EE D8          ~2      cld
 001528 59EF 69 05       ~2      adc #5
 001529 59F1 F8          ~2      sed
 001530 59F2 AA          ~2      tax

                              page 29

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 001531 59F3 A0 05       ~2      ldy #5
 001532 59F5 B9 62 03    ~4  tn00b lda w1+2,y    ; move angle to 'ra' with dec
 001533 59F8 9D 02 03    ~5      sta ra+2,x
 001534 59FB CA          ~2      dex
 001535 59FC 88          ~2      dey
 001536 59FD 10 F6       ~2-     bpl tn00b
 001537 59FF AD 61 03    ~4      lda w1+1
 001538 5A02 29 01       ~2      and #1
 001539 5A04 F0 13       ~2-     beq tn00a
 001540 5A06 A2 0C       ~2      ldx #12
 001541 5A08 A9 00       ~2      lda #0
 001542 5A0A BC 02 03    ~4, tn00c ldy ra+2,x
 001543 5A0D 19 54 69    ~4,     ora tlh,y
 001544 5A10 9D 02 03    ~5      sta ra+2,x
 001545 5A13 B9 F4 69    ~4      lda thl,y
 001546 5A16 CA          ~2      dex
 001547 5A17 10 F1       ~2-     bpl tn00c
 001548 5A19 =(23065)        tn00a
 001549 5A19 20 24 5B    ~6      jsr tnpdiv      ; call tangent pseudo-divide 
 001550                      ;
 001551                      ;   're' contains pseudo-quotient in extended for
 001552                      ;       (00 0D 0D 0D 0D 0D ...)
 001553                      ;
 001554                      ;   Note that the first digit is zero because the
 001555                      ;   scaling reduces the argument below pi/4 < 1.0
 001556                      ;   now call routine to create fixed point tangen
 001557                      ;
 001558 5A1C 20 C2 5A    ~6      jsr tnpmul
 001559                          
 001560                      ;   On return, 'ra' contains a quantity proportio
 001561                      ;   contains a quantity proportional to 'x'. Firs
 001562                      ;   from the fixed point form to floating point i
 001563                      ;
 001564 5A1F A9 00       ~2      lda #0      ; clear exponent and sign field o
 001565 5A21 8D 60 03    ~4      sta w1
 001566 5A24 8D 61 03    ~4      sta w1+1
 001567 5A27 A9 08       ~2      lda #8      
 001568 5A29 85 C7       ~3      sta bctr    ; limit iterations
 001569 5A2B AD 02 03    ~4  t0a1 lda ra+2
 001570 5A2E 29 F0       ~2      and #$f0    ; is the decimal point OK?
 001571 5A30 D0 2A       ~2-     bne t0b
 001572 5A32 A9 40       ~2      lda #$40
 001573 5A34 8D 60 03    ~4      sta w1      ; exponent is negative
 001574 5A37 EE 61 03    ~6      inc w1+1
 001575 5A3A A9 00       ~2      lda #0
 001576 5A3C A2 0C       ~2      ldx #12
 001577 5A3E BC 02 03    ~4, t0a2 ldy ra+2,x ; shift 'ra' left and adjust expo
 001578 5A41 19 54 69    ~4,     ora tlh,y
 001579 5A44 9D 02 03    ~5      sta ra+2,x
 001580 5A47 B9 F4 69    ~4      lda thl,y
 001581 5A4A CA          ~2      dex
 001582 5A4B 10 F1       ~2-     bpl t0a2
 001583 5A4D C6 C7       ~5      dec bctr

                              page 30

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 001584 5A4F D0 DA       ~2-     bne t0a1
 001585 5A51 A9 00       ~2      lda #0
 001586 5A53 A2 07       ~2      ldx #7
 001587 5A55 9D 70 03    ~5  t0a3 sta w3,x       ; clear 'w3' to zero
 001588 5A58 CA          ~2      dex
 001589 5A59 10 FA       ~2-     bpl t0a3
 001590 5A5B 60          ~6      rts
 001591 5A5C A2 05       ~2  t0b ldx #5
 001592 5A5E BD 02 03    ~4, t0b1 lda ra+2,x     ; move mantissa to 'w1'
 001593 5A61 9D 62 03    ~5      sta w1+2,x
 001594 5A64 CA          ~2      dex
 001595 5A65 10 F7       ~2-     bpl t0b1
 001596                      ;
 001597                      ;   check 'rb' position
 001598                      ;
 001599 5A67 AD 11 03    ~4      lda rb+1
 001600 5A6A F0 0C       ~2-     beq t0b2
 001601 5A6C A2 07       ~2      ldx #7
 001602 5A6E BD 60 03    ~4, t0b1a lda w1,x      ; 'w1' contains result
 001603 5A71 9D 70 03    ~5      sta w3,x
 001604 5A74 CA          ~2      dex
 001605 5A75 10 F7       ~2-     bpl t0b1a
 001606 5A77 60          ~6      rts
 001607 5A78 A9 08       ~2  t0b2 lda #8
 001608 5A7A 85 C7       ~3      sta bctr
 001609 5A7C A9 40       ~2      lda #$40
 001610 5A7E 8D 68 03    ~4      sta w2
 001611 5A81 A9 00       ~2      lda #0
 001612 5A83 8D 69 03    ~4      sta w2+1        ; 'rb' has negative exponent
 001613 5A86 AD 12 03    ~4  t0b2a lda rb+2      ; shift left until aligned
 001614 5A89 29 F0       ~2      and #$f0
 001615 5A8B D0 26       ~2-     bne t0c
 001616 5A8D EE 69 03    ~6      inc w2+1
 001617 5A90 A9 00       ~2      lda #0
 001618 5A92 A2 0A       ~2      ldx #10
 001619 5A94 BC 12 03    ~4, t0b3 ldy rb+2,x
 001620 5A97 19 54 69    ~4,     ora tlh,y
 001621 5A9A 9D 12 03    ~5      sta rb+2,x
 001622 5A9D B9 F4 69    ~4      lda thl,y
 001623 5AA0 CA          ~2      dex
 001624 5AA1 10 F1       ~2-     bpl t0b3
 001625 5AA3 C6 C7       ~5      dec bctr
 001626 5AA5 D0 DF       ~2-     bne t0b2a
 001627 5AA7 A2 07       ~2      ldx #7
 001628 5AA9 BD 80 6D    ~4' t0b4 lda pio2,x     ; angle is pi/2  ('rb' is zer
 001629 5AAC 9D 70 03    ~5      sta w3,x
 001630 5AAF CA          ~2      dex
 001631 5AB0 10 F7       ~2-     bpl t0b4
 001632 5AB2 60          ~6      rts
 001633 5AB3 =(23219)        t0c
 001634 5AB3 A2 05       ~2      ldx #5
 001635 5AB5 BD 12 03    ~4, t0c1 lda rb+2,x     ; move mantissa to 'w2'
 001636 5AB8 9D 6A 03    ~5      sta w2+2,x

                              page 31

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 001637 5ABB CA          ~2      dex
 001638 5ABC 10 F7       ~2-     bpl t0c1
 001639 5ABE 20 35 55    ~6      jsr div
 001640 5AC1 60          ~6      rts
 001641                      ;
 001642                      ; tangent pseudo-multiply routine
 001643                      ; enter with 'ra' = residual = y
 001644                      ; set 'rb' = 1.0             = x
 001645                      ; copy 'ra' and 'rb' to 'rc' and 'rd'
 001646                      ;
 001647 5AC2 =(23234)        tnpmul
 001648 5AC2 A2 10       ~2      ldx #$10
 001649 5AC4 8E 12 03    ~4      stx rb+2
 001650 5AC7 A2 0A       ~2      ldx #10
 001651 5AC9 BD 02 03    ~4, @   lda ra+2,x
 001652 5ACC 9D 22 03    ~5      sta rc+2,x
 001653 5ACF BD 12 03    ~4,     lda rb+2,x
 001654 5AD2 9D 32 03    ~5      sta rd+2,x
 001655 5AD5 CA          ~2      dex
 001656 5AD6 10 F1       ~2-     bpl @B
 001657 5AD8 A9 00       ~2      lda #0
 001658 5ADA 85 C5       ~3      sta ctr3    ; pseudo-digit index
 001659                      ;
 001660                      ; repeat algorithm for each digit of pseudo-quoti
 001661                      ;
 001662                      ;   ra = y2
 001663                      ;   rb = x2
 001664                      ;   rc = y1
 001665                      ;   rd = x1
 001666                      ;
 001667 5ADC A6 C5       ~3  tnpm1 ldx ctr3
 001668 5ADE DE 40 03    ~6      dec re,x
 001669 5AE1 30 38       ~2=     bmi tnpm2
 001670 5AE3 F8          ~2      sed
 001671                      ;
 001672                      ;   copy 'ra', 'rb' to 'rc','rd'
 001673                      ;
 001674 5AE4 A2 0A       ~2      ldx #10
 001675 5AE6 BD 02 03    ~4, @   lda ra+2,x
 001676 5AE9 9D 22 03    ~5      sta rc+2,x
 001677 5AEC BD 12 03    ~4,     lda rb+2,x
 001678 5AEF 9D 32 03    ~5      sta rd+2,x
 001679 5AF2 CA          ~2      dex
 001680 5AF3 10 F1       ~2-     bpl @B
 001681                      
 001682                      ;   now shift 'rc' and 'rd' right 
 001683                      ;
 001684 5AF5 A5 C5       ~3      lda ctr3
 001685 5AF7 20 87 66    ~6      jsr scdnrt
 001686                      ;
 001687                      ;   now perform pseudo-multiplication
 001688                      ;
 001689 5AFA A2 0A       ~2      ldx #10

                              page 32

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 001690 5AFC 38          ~2      sec
 001691 5AFD BD 12 03    ~4, @   lda rb+2,x      ; x2 = x1 - y1*10^j
 001692 5B00 FD 22 03    ~4,     sbc rc+2,x
 001693 5B03 9D 12 03    ~5      sta rb+2,x
 001694 5B06 CA          ~2      dex
 001695 5B07 10 F4       ~2=     bpl @B
 001696 5B09 A2 0A       ~2      ldx #10
 001697 5B0B 18          ~2      clc 
 001698 5B0C BD 02 03    ~4, @   lda ra+2,x      ; y2 = y1 + x1*10^j
 001699 5B0F 7D 32 03    ~4,     adc rd+2,x
 001700 5B12 9D 02 03    ~5      sta ra+2,x
 001701 5B15 CA          ~2      dex
 001702 5B16 10 F4       ~2-     bpl @B
 001703 5B18 4C DC 5A    ~3      jmp tnpm1
 001704 5B1B =(23323)        tnpm2
 001705 5B1B E6 C5       ~5      inc ctr3
 001706 5B1D A9 05       ~2      lda #5
 001707 5B1F C5 C5       ~3      cmp ctr3
 001708 5B21 B0 B9       ~2=     bcs tnpm1
 001709 5B23 =(23331)        tnpmx
 001710 5B23 60          ~6      rts
 001711                      ;
 001712                      ;   tangent pseudo-divide routine: calculates COR
 001713                      ;   for tangent function.
 001714                      ;
 001715 5B24 A9 05       ~2  tnpdiv lda #5       ; number of table entries in 
 001716 5B26 85 C5       ~3      sta ctr3
 001717 5B28 A2 00       ~2      ldx #0          ; index into result register 
 001718 5B2A 8E 40 03    ~4      stx re
 001719 5B2D A0 07       ~2  tpd0 ldy #7         ; (subtract until underflow, 
 001720 5B2F 38          ~2      sec
 001721 5B30 B9 02 03    ~4  tpd1 lda ra+2,y     ; subtract 1 instance of curr
 001722 5B33 F1 F2       ~5      sbc (ptr1),y
 001723 5B35 99 02 03    ~5      sta ra+2,y
 001724 5B38 88          ~2      dey
 001725 5B39 10 F5       ~2-     bpl tpd1
 001726 5B3B 90 06       ~2-     bcc tpd2a       ; underflow? no, do another l
 001727 5B3D FE 40 03    ~7,     inc re,x
 001728 5B40 4C 2D 5B    ~3      jmp tpd0
 001729 5B43 =(23363)        tpd2a
 001730 5B43 A0 07       ~2      ldy #7          ; restore
 001731 5B45 18          ~2      clc
 001732 5B46 B9 02 03    ~4  tpd2 lda ra+2,y
 001733 5B49 71 F2       ~5      adc (ptr1),y
 001734 5B4B 99 02 03    ~5      sta ra+2,y
 001735 5B4E 88          ~2      dey
 001736 5B4F 10 F5       ~2-     bpl tpd2
 001737 5B51 E8          ~2      inx
 001738 5B52 A9 00       ~2      lda #0
 001739 5B54 9D 40 03    ~5      sta re,x
 001740 5B57 D8          ~2      cld             ; ...bump tangent table point
 001741 5B58 18          ~2      clc
 001742 5B59 A5 F2       ~3      lda ptr1

                              page 33

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 001743 5B5B 69 08       ~2      adc #8
 001744 5B5D 85 F2       ~3      sta ptr1
 001745 5B5F 90 02       ~2-     bcc tpd3
 001746 5B61 E6 F3       ~5      inc ptr1+1
 001747 5B63 F8          ~2  tpd3 sed            
 001748 5B64 C6 C5       ~5      dec ctr3
 001749 5B66 10 C5       ~2-     bpl tpd0        ; loop until each digit of ps
 001750 5B68 60          ~6      rts
 001751                      ;
 001752                      ;   x2z: transfer 'x' to 'z' with existing offset
 001753                      ;
 001754 5B69 A2 09       ~2  x2z ldx #9
 001755 5B6B A9 00       ~2      lda #0
 001756 5B6D 9D 30 03    ~5  x2z0 sta rd,x       ; clear 'z'
 001757 5B70 CA          ~2      dex
 001758 5B71 10 FA       ~2-     bpl x2z0
 001759 5B73 A0 07       ~2      ldy #7
 001760 5B75 B1 F4       ~5  x2z1 lda (ptr2),y
 001761 5B77 91 F6       ~6      sta (ptr3),y
 001762 5B79 88          ~2      dey
 001763 5B7A 10 F9       ~2-     bpl x2z1
 001764 5B7C 60          ~6      rts
 001765                      ;
 001766                      ;   arccos -- calculates arcosine(x): acos(x) = p
 001767                      ;
 001768 5B7D 20 96 5B    ~6  acos jsr asin
 001769 5B80 A9 70       ~2      lda <w3
 001770 5B82 A0 03       ~2      ldy >w3
 001771 5B84 A2 68       ~2      ldx #w2
 001772 5B86 20 30 52    ~6      jsr copy2w
 001773 5B89 A9 80       ~2      lda <pio2
 001774 5B8B A0 6D       ~2      ldy >pio2
 001775 5B8D A2 60       ~2      ldx #w1
 001776 5B8F 20 30 52    ~6      jsr copy2w
 001777 5B92 20 AE 50    ~6      jsr sub
 001778 5B95 60          ~6      rts
 001779                      ;                                  x
 001780                      ;   arcsine --  asin(x) = atan( ---------)
 001781                      ;                                1 - x^2
 001782 5B96 AD 62 03    ~4  asin lda w1+2
 001783 5B99 D0 03       ~2-     bne @F
 001784 5B9B 4C 19 69    ~3      jmp retzr
 001785                      @    
 001786 5B9E AD 60 03    ~4      lda w1
 001787 5BA1 29 80       ~2      and #$80        ; save argument sign (append 
 001788 5BA3 85 CC       ~3      sta sinflg
 001789 5BA5 A9 60       ~2      lda <w1          ; make argument positive
 001790 5BA7 29 7F       ~2      and #$7f
 001791 5BA9 8D 60 03    ~4      sta w1
 001792 5BAC A9 60       ~2      lda <w1        ; save to temporary register
 001793 5BAE 85 F2       ~3      sta ptr1
 001794 5BB0 A9 03       ~2      lda >w1
 001795 5BB2 85 F3       ~3      sta ptr1+1

                              page 34

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 001796 5BB4 A9 90       ~2      lda <reg1
 001797 5BB6 85 F4       ~3      sta ptr2
 001798 5BB8 A9 03       ~2      lda >reg1
 001799 5BBA 85 F5       ~3      sta ptr2+1
 001800 5BBC 20 04 69    ~6      jsr copyreg
 001801 5BBF A9 60       ~2      lda <w1        
 001802 5BC1 A0 03       ~2      ldy >w1
 001803 5BC3 A2 68       ~2      ldx #w2
 001804 5BC5 20 30 52    ~6      jsr copy2w
 001805 5BC8 20 78 53    ~6      jsr mul         ; form arg^2
 001806 5BCB A9 A0       ~2      lda <unit
 001807 5BCD A0 6D       ~2      ldy >unit
 001808 5BCF A2 60       ~2      ldx #w1
 001809 5BD1 20 30 52    ~6      jsr copy2w
 001810 5BD4 A9 70       ~2      lda <w3
 001811 5BD6 A0 03       ~2      ldy >w3
 001812 5BD8 A2 68       ~2      ldx #w2
 001813 5BDA 20 30 52    ~6      jsr copy2w
 001814 5BDD 20 AE 50    ~6      jsr sub         ; form 1 - arg^2
 001815                      ;
 001816                      ;   test result of 1 - arg^2
 001817                      ;
 001818                      ;   if zero, argument is +-1.0 and angle is +-pi/
 001819                      ;   if negative, argument is invalid.
 001820                      ;
 001821 5BE0 AD 72 03    ~4      lda w3+2
 001822 5BE3 F0 08       ~2-     beq argzr
 001823 5BE5 AD 70 03    ~4      lda w3
 001824 5BE8 10 0F       ~2-     bpl argpls
 001825 5BEA 4C 2F 69    ~3      jmp rangerr     ; argument > 1.0, return with
 001826 5BED =(23533)        argzr
 001827 5BED A9 80       ~2      lda <pio2
 001828 5BEF A0 6D       ~2      ldy >pio2
 001829 5BF1 A2 70       ~2      ldx #w3
 001830 5BF3 20 30 52    ~6      jsr copy2w
 001831 5BF6 4C 26 5C    ~3      jmp fxsgn
 001832 5BF9 =(23545)        argpls
 001833 5BF9 A9 70       ~2      lda <w3
 001834 5BFB A0 03       ~2      ldy >w3
 001835 5BFD A2 60       ~2      ldx #w1
 001836 5BFF 20 30 52    ~6      jsr copy2w
 001837 5C02 20 E6 56    ~6      jsr sqrt        ; form  1 - arg^2
 001838 5C05 A9 90       ~2      lda <reg1
 001839 5C07 A0 03       ~2      ldy >reg1
 001840 5C09 A2 60       ~2      ldx #w1
 001841 5C0B 20 30 52    ~6      jsr copy2w
 001842 5C0E A9 70       ~2      lda <w3
 001843 5C10 A0 03       ~2      ldy >w3
 001844 5C12 A2 68       ~2      ldx #w2
 001845 5C14 20 30 52    ~6      jsr copy2w
 001846 5C17 20 35 55    ~6      jsr div         ; form arg /  1 - arg^2 
 001847 5C1A A9 70       ~2      lda <w3
 001848 5C1C A0 03       ~2      ldy >w3

                              page 35

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 001849 5C1E A2 60       ~2      ldx #w1
 001850 5C20 20 30 52    ~6      jsr copy2w
 001851 5C23 20 2F 5C    ~6      jsr atan
 001852                      
 001853 5C26 AD 70 03    ~4  fxsgn lda w3
 001854 5C29 05 CC       ~3      ora sinflg
 001855 5C2B 8D 70 03    ~4      sta w3
 001856 5C2E 60          ~6      rts
 001857                      ;
 001858                      ;   arctangent 
 001859                      ;
 001860                      ;   1. Test argument sign,
 001861                      ;       . save sign, make argument positive.
 001862                      ;   2. Test size of argument,
 001863                      ;       . if argument < 1e-6 correct sign and ret
 001864                      ;         argument in w3.
 001865                      ;       . if argument > 1.0, set cotflg replace a
 001866                      ;         with its reciprocal.
 001867                      ;       . else clear cotflg.
 001868                      ;   3. Compute arctangent of argument. (0 <= angl
 001869                      ;   4. If cotflg, subtract from pi/2.
 001870                      ;   5. Correct sign.
 001871                      ;   6. Return result in w3.
 001872                      ;
 001873 5C2F F8          ~2  atan sed
 001874 5C30 A9 00       ~2      lda #0
 001875 5C32 85 CA       ~3      sta cotflg
 001876 5C34 85 C8       ~3      sta tnsgn
 001877 5C36 2C 60 03    ~4      bit w1
 001878 5C39 10 0C       ~2-     bpl @F      ; is argument negative ?
 001879 5C3B A9 80       ~2      lda #$80    ; yes, set 'tnsgn' flag
 001880 5C3D 85 C8       ~3      sta tnsgn   ; and make arg +
 001881 5C3F A9 4F       ~2      lda #$4f
 001882 5C41 2D 60 03    ~4      and w1
 001883 5C44 8D 60 03    ~4      sta w1
 001884 5C47 70 0E       ~2- @   bvs argchk
 001885 5C49 20 3E 66    ~6      jsr inv
 001886 5C4C A9 70       ~2      lda #w3
 001887 5C4E A0 03       ~2      ldy #>w3
 001888 5C50 A2 60       ~2      ldx #w1
 001889 5C52 20 30 52    ~6      jsr copy2w
 001890 5C55 E6 CA       ~5      inc cotflg  ; argument is inverted and cotflg
 001891 5C57 =(23639)        argchk          ; here, 0 <= arg <= 1.0
 001892 5C57 AD 60 03    ~4      lda w1
 001893 5C5A 29 0F       ~2      and #$0f
 001894 5C5C D0 07       ~2-     bne toosml
 001895 5C5E AD 61 03    ~4      lda w1+1
 001896 5C61 C9 07       ~2      cmp #7
 001897 5C63 90 24       ~2-     bcc argok
 001898 5C65 A9 00       ~2  toosml lda #0   ; argument is too small to need c
 001899 5C67 C5 CA       ~3      cmp cotflg
 001900 5C69 F0 0C       ~2-     beq tsx
 001901 5C6B A9 80       ~2      lda #pio2

                              page 36

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 001902 5C6D A0 6D       ~2      ldy #>pio2
 001903 5C6F A2 68       ~2      ldx #w2
 001904 5C71 20 30 52    ~6      jsr copy2w
 001905 5C74 20 35 55    ~6      jsr div
 001906 5C77 A5 C8       ~3  tsx lda tnsgn
 001907 5C79 0D 60 03    ~4      ora w1
 001908 5C7C 8D 60 03    ~4      sta w1
 001909 5C7F A9 60       ~2      lda #w1
 001910 5C81 A0 03       ~2      ldy #>w1
 001911 5C83 A2 70       ~2      ldx #w3
 001912 5C85 20 30 52    ~6      jsr copy2w
 001913 5C88 60          ~6      rts
 001914 5C89 =(23689)        argok
 001915 5C89 A2 4F       ~2      ldx #5*wreglen-1
 001916 5C8B A9 00       ~2      lda #0
 001917 5C8D 9D 00 03    ~5  atn00a sta ra,x         ; clear working storage: 
 001918 5C90 CA          ~2      dex
 001919 5C91 10 FA       ~2-     bpl atn00a
 001920                      ;
 001921                      ;   move argument to ra with decimal point alignm
 001922                      ;
 001923 5C93 AD 61 03    ~4      lda w1+1
 001924 5C96 4A          ~2      lsr
 001925 5C97 D8          ~2      cld
 001926 5C98 18          ~2      clc
 001927 5C99 69 05       ~2      adc #5
 001928 5C9B F8          ~2      sed
 001929 5C9C AA          ~2      tax
 001930 5C9D A0 05       ~2      ldy #5
 001931 5C9F B9 62 03    ~4  @   lda w1+2,y
 001932 5CA2 9D 02 03    ~5      sta ra+2,x
 001933 5CA5 CA          ~2      dex
 001934 5CA6 88          ~2      dey
 001935 5CA7 10 F6       ~2-     bpl @B
 001936                      
 001937 5CA9 AD 61 03    ~4      lda w1+1
 001938 5CAC 29 01       ~2      and #1
 001939 5CAE F0 16       ~2-     beq @F
 001940 5CB0 A2 07       ~2      ldx #7          ; even exponent, shift right 
 001941 5CB2 A9 00       ~2      lda #0
 001942 5CB4 BC 02 03    ~4, atn1 ldy ra+2,x
 001943 5CB7 19 54 69    ~4,     ora tlh,y
 001944 5CBA 9D 03 03    ~5      sta ra+3,x
 001945 5CBD B9 F4 69    ~4      lda thl,y
 001946 5CC0 CA          ~2      dex
 001947 5CC1 10 F1       ~2-     bpl atn1
 001948 5CC3 8D 02 03    ~4      sta ra+2
 001949 5CC6 A2 00       ~2  @   ldx #0
 001950 5CC8 86 C5       ~3      stx ctr3        ; storage for pseudo-quotient
 001951 5CCA A9 10       ~2      lda #$10        ; 'ra' and 'rb' are now initi
 001952 5CCC 8D 12 03    ~4      sta rb+2
 001953                      ;
 001954                      ;   ra = y2 = arg (0 < arg < pi/4)

                              page 37

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 001955                      ;   rb = x2 = 1.0
 001956                      ;
 001957                      ;   1. initialize pseudo-quotient digit counter a
 001958                      ;       ctr3 <- index = 0, re used for pq
 001959                      ;   2. outer loop
 001960                      ;      (A) inner loop
 001961                      ;        y2 -> y1   (rc)
 001962                      ;        x2 -> x1   (rd)
 001963                      ;        y2 shr index (10^j)  (1st pass, j=0, no 
 001964                      ;        x2 shr index (10^j)    "   "     "      
 001965                      ;        y2 = y2 - x1
 001966                      ;        if y2 < 0 goto (B)
 001967                      ;        x2 = x2 + y1
 001968                      ;        re[index]++
 001969                      ;        goto (A)
 001970                      ;     (B) y2 = y2 + x1  (restore after subtractio
 001971                      ;        index++
 001972                      ;        if index is LT 7 goto 2.
 001973                      ;
 001974 5CCF A9 00       ~2      lda #0
 001975 5CD1 85 C5       ~3      sta ctr3
 001976 5CD3 =(23763)        atnlp1
 001977 5CD3 A2 06       ~2      ldx #6
 001978 5CD5 BD 02 03    ~4, @   lda ra+2,x    ; y2,x2 -> y1,x1
 001979 5CD8 9D 22 03    ~5      sta rc+2,x
 001980 5CDB BD 12 03    ~4,     lda rb+2,x
 001981 5CDE 9D 32 03    ~5      sta rd+2,x
 001982 5CE1 CA          ~2      dex
 001983 5CE2 10 F1       ~2-     bpl @B
 001984 5CE4 A5 C5       ~3      lda ctr3
 001985 5CE6 F0 03       ~2-     beq @F
 001986 5CE8 20 87 66    ~6      jsr scdnrt  ; shift y1,x1 to correct postion
 001987 5CEB F8          ~2  @   sed
 001988 5CEC 38          ~2      sec
 001989 5CED A2 06       ~2      ldx #6
 001990 5CEF BD 02 03    ~4, @   lda ra+2,x
 001991 5CF2 FD 32 03    ~4,     sbc rd+2,x
 001992 5CF5 9D 02 03    ~5      sta ra+2,x
 001993 5CF8 CA          ~2      dex
 001994 5CF9 10 F4       ~2-     bpl @B
 001995 5CFB 90 17       ~2=     bcc rstr        ; underflow: do restore
 001996 5CFD 18          ~2      clc
 001997 5CFE A2 06       ~2      ldx #6
 001998 5D00 BD 12 03    ~4, @   lda rb+2,x
 001999 5D03 7D 22 03    ~4,     adc rc+2,x
 002000 5D06 9D 12 03    ~5      sta rb+2,x
 002001 5D09 CA          ~2      dex
 002002 5D0A 10 F4       ~2-     bpl @B
 002003 5D0C A6 C5       ~3      ldx ctr3
 002004 5D0E FE 40 03    ~7,     inc re,x        ; update current pseudo-quoti
 002005 5D11 4C D3 5C    ~3      jmp atnlp1
 002006 5D14 A2 06       ~2  rstr ldx #6
 002007 5D16 18          ~2      clc

                              page 38

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 002008 5D17 BD 02 03    ~4, @   lda ra+2,x
 002009 5D1A 7D 32 03    ~4,     adc rd+2,x
 002010 5D1D 9D 02 03    ~5      sta ra+2,x
 002011 5D20 CA          ~2      dex
 002012 5D21 10 F4       ~2-     bpl @B
 002013 5D23 E6 C5       ~5      inc ctr3
 002014 5D25 A9 06       ~2      lda #6          ; number of desired pseudo-qu
 002015 5D27 C5 C5       ~3      cmp ctr3
 002016 5D29 B0 A8       ~2=     bcs atnlp1
 002017                      ;
 002018                      ;   pseudo-quotient digits are now in 're' (6 dig
 002019                      ;   1. Convert 'ra' to F.P. in w1
 002020                      ;   2. Convert 'rb' to F.P. in w2
 002021                      ;   3. jsr divide, result in w3 is residual start
 002022                      ;   4. move w3 to 'ra' with decimal point alignme
 002023                      ;   5. pseudo-multiply. set 'i' to 0.
 002024                      ;       A. for each digit[i] in pseudo-quotient, 
 002025                      ;       B. decrement digit
 002026                      ;       C. digit = 0?
 002027                      ;           no? goto A.
 002028                      ;           yes? increment 'i'
 002029                      ;       D. convert 'ra' to F.P. in w3, return
 002030                      ;
 002031 5D2B A9 0A       ~2      lda #10
 002032 5D2D 85 C7       ~3      sta bctr        ; guard counter
 002033 5D2F A9 00       ~2      lda #0
 002034 5D31 8D 61 03    ~4      sta w1+1
 002035 5D34 A9 40       ~2      lda #$40
 002036 5D36 8D 60 03    ~4      sta w1
 002037 5D39 A9 00       ~2      lda #0
 002038 5D3B 8D 61 03    ~4      sta w1+1        ; 'rs' has negative exponent
 002039 5D3E AD 02 03    ~4  @  lda ra+2         ; shift left until aligned
 002040 5D41 29 F0       ~2      and #$f0
 002041 5D43 D0 1A       ~2-     bne atnres
 002042 5D45 EE 61 03    ~6      inc w1+1
 002043 5D48 A9 00       ~2      lda #0
 002044 5D4A A2 0A       ~2      ldx #10
 002045 5D4C BC 02 03    ~4, @ ldy ra+2,x
 002046 5D4F 19 54 69    ~4,     ora tlh,y
 002047 5D52 9D 02 03    ~5      sta ra+2,x
 002048 5D55 B9 F4 69    ~4      lda thl,y
 002049 5D58 CA          ~2      dex
 002050 5D59 10 F1       ~2-     bpl @B
 002051 5D5B C6 C7       ~5      dec bctr
 002052 5D5D D0 DF       ~2-     bne @B1
 002053 5D5F A2 05       ~2  atnres ldx #5
 002054 5D61 BD 02 03    ~4, @   lda ra+2,x
 002055 5D64 9D 62 03    ~5      sta w1+2,x
 002056 5D67 CA          ~2      dex
 002057 5D68 10 F7       ~2-     bpl @B
 002058 5D6A A2 07       ~2      ldx #7
 002059 5D6C BD 10 03    ~4, @   lda rb,x
 002060 5D6F 9D 68 03    ~5      sta w2,x

                              page 39

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 002061 5D72 CA          ~2      dex
 002062 5D73 10 F7       ~2-     bpl @B
 002063 5D75 20 35 55    ~6      jsr div
 002064                      ;
 002065                      ;   pseudo-multiply for arctangent
 002066                      ;
 002067                      ;   1. copy w3 to 'ra' with decimal point aligned
 002068                      ;   2. initialize kxatn table pointer in 'ptr1'
 002069                      ;   3. initialize pseudo-quotient index in 'ctr3'
 002070                      ;   4. pseudo-multiply by repeated addition:
 002071                      ;       A. for count given by each digit of pseud
 002072                      ;           add current table entry to running su
 002073                      ;       B. increment index (ctr3) and bump table 
 002074                      ;           to next entry.
 002075                      ;       C. if index < 7, goto A.
 002076                      ;
 002077 5D78 A2 0F       ~2      ldx #15
 002078 5D7A A9 00       ~2      lda #0
 002079 5D7C 9D 00 03    ~5  @   sta ra,x    ; clear 'ra'
 002080 5D7F CA          ~2      dex
 002081 5D80 10 FA       ~2-     bpl @B
 002082 5D82 AD 70 03    ~4      lda w3
 002083 5D85 29 0F       ~2      and #$0f
 002084 5D87 D0 35       ~2-     bne atnpm
 002085 5D89 AD 71 03    ~4      lda w3+1
 002086 5D8C C9 09       ~2      cmp #9
 002087 5D8E B0 2E       ~2-     bcs atnpm
 002088 5D90 4A          ~2      lsr
 002089 5D91 18          ~2      clc
 002090 5D92 D8          ~2      cld
 002091 5D93 69 05       ~2      adc #5
 002092 5D95 AA          ~2      tax
 002093 5D96 A0 05       ~2      ldy #5
 002094 5D98 B9 72 03    ~4  @   lda w3+2,y
 002095 5D9B 9D 02 03    ~5      sta ra+2,x
 002096 5D9E CA          ~2      dex
 002097 5D9F 88          ~2      dey
 002098 5DA0 10 F6       ~2-     bpl @b
 002099 5DA2 A9 61       ~2      lda #w1+1
 002100 5DA4 29 01       ~2      and #1
 002101 5DA6 F0 16       ~2-     beq atnpm
 002102 5DA8 A2 07       ~2      ldx #7          ; shift right one digit
 002103 5DAA A9 00       ~2      lda #0
 002104 5DAC BC 02 03    ~4, @   ldy ra+2,x
 002105 5DAF 19 54 69    ~4,     ora tlh,y
 002106 5DB2 9D 03 03    ~5      sta ra+3,x
 002107 5DB5 B9 F4 69    ~4      lda thl,y
 002108 5DB8 CA          ~2      dex
 002109 5DB9 10 F1       ~2-     bpl @B
 002110 5DBB 8D 02 03    ~4      sta ra+2
 002111 5DBE A9 48       ~2  atnpm lda <kxatn ; setup table point
 002112 5DC0 85 F2       ~3      sta ptr1
 002113 5DC2 A9 6E       ~2      lda >kxatn

                              page 40

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 002114 5DC4 85 F3       ~3      sta ptr1+1
 002115 5DC6 A2 00       ~2      ldx #0      ; initialize pseudo-quotient inde
 002116 5DC8 86 C5       ~3      stx ctr3
 002117 5DCA =(24010)        apmlp
 002118 5DCA DE 40 03    ~6      dec re,x
 002119 5DCD 30 11       ~2-     bmi atnxtd
 002120 5DCF A0 07       ~2      ldy #7
 002121 5DD1 F8          ~2      sed
 002122 5DD2 18          ~2      clc
 002123 5DD3 B9 02 03    ~4  @   lda ra+2,y
 002124 5DD6 71 F2       ~5      adc (ptr1),y
 002125 5DD8 99 02 03    ~5      sta ra+2,y
 002126 5DDB 88          ~2      dey
 002127 5DDC 10 F5       ~2-     bpl @b
 002128 5DDE 30 EA       ~2-     bmi apmlp
 002129 5DE0 E6 C5       ~5  atnxtd inc ctr3
 002130 5DE2 D8          ~2      cld
 002131 5DE3 18          ~2      clc
 002132 5DE4 A5 F2       ~3      lda ptr1
 002133 5DE6 69 08       ~2      adc #8
 002134 5DE8 85 F2       ~3      sta ptr1
 002135 5DEA 90 02       ~2-     bcc @F
 002136 5DEC E6 F3       ~5      inc ptr1+1
 002137 5DEE A6 C5       ~3  @   ldx ctr3
 002138 5DF0 E0 07       ~2      cpx #7      ; number of pseudo-quotient digit
 002139 5DF2 90 D6       ~2-     bcc apmlp
 002140 5DF4 A9 00       ~2      lda #0
 002141 5DF6 8D 70 03    ~4      sta w3
 002142 5DF9 8D 71 03    ~4      sta w3+1        ; clear result exponent field
 002143 5DFC AD 02 03    ~4  atn02a lda ra+2
 002144 5DFF 29 F0       ~2      and #$f0
 002145 5E01 D0 1E       ~2-     bne atn03
 002146 5E03 A9 40       ~2      lda #$40        ; negative exponent
 002147 5E05 8D 70 03    ~4      sta w3
 002148 5E08 A2 0F       ~2      ldx #15
 002149 5E0A A9 00       ~2      lda #0
 002150 5E0C BC 02 03    ~4, atn02b ldy ra+2,x   ;shift 'ra' left until normal
 002151 5E0F 19 54 69    ~4,     ora tlh,y
 002152 5E12 9D 02 03    ~5      sta ra+2,x
 002153 5E15 B9 F4 69    ~4      lda thl,y
 002154 5E18 CA          ~2      dex
 002155 5E19 10 F1       ~2-     bpl atn02b
 002156 5E1B EE 71 03    ~6      inc w3+1
 002157 5E1E 4C FC 5D    ~3      jmp atn02a
 002158 5E21 A2 05       ~2  atn03 ldx #5
 002159 5E23 BD 02 03    ~4, @   lda ra+2,x
 002160 5E26 9D 72 03    ~5      sta w3+2,x
 002161 5E29 CA          ~2      dex
 002162 5E2A 10 F7       ~2-     bpl @B
 002163 5E2C A5 CA       ~3      lda cotflg
 002164 5E2E F0 15       ~2-     beq  atnx
 002165 5E30 A9 80       ~2      lda <pio2
 002166 5E32 A0 6D       ~2      ldy >pio2

                              page 41

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 002167 5E34 A2 60       ~2      ldx #w1
 002168 5E36 20 30 52    ~6      jsr copy2w
 002169 5E39 A9 70       ~2      lda <w3
 002170 5E3B A0 03       ~2      ldy >w3
 002171 5E3D A2 68       ~2      ldx #w2
 002172 5E3F 20 30 52    ~6      jsr copy2w
 002173 5E42 20 AE 50    ~6      jsr sub
 002174 5E45 =(24133)        atnx
 002175 5E45 AD 70 03    ~4      lda w3
 002176 5E48 05 C8       ~3      ora tnsgn
 002177 5E4A 8D 70 03    ~4      sta w3
 002178 5E4D 60          ~6      rts
 002179                      ;
 002180                      ;   arc cosecant -- acsc(x) = asin(1/x)
 002181                      ;
 002182                      ;   w3 = acsc(w1)
 002183                      ;
 002184 5E4E A9 60       ~2  acsc lda <w1
 002185 5E50 A0 03       ~2      ldy >w1
 002186 5E52 A2 68       ~2      ldx #w2
 002187 5E54 20 30 52    ~6      jsr copy2w
 002188 5E57 A9 A0       ~2      lda <unit
 002189 5E59 A0 6D       ~2      ldy >unit
 002190 5E5B A2 60       ~2      ldx #w1
 002191 5E5D 20 30 52    ~6      jsr copy2w
 002192 5E60 20 35 55    ~6      jsr div
 002193 5E63 4C 96 5B    ~3      jmp asin
 002194                      ;
 002195                      ;   arc secant -- asec(x) = acos(1/x)
 002196                      ;
 002197                      ;   w3 = asec(w1)
 002198                      ;
 002199 5E66 A9 60       ~2  asec lda <w1
 002200 5E68 A0 03       ~2      ldy >w1
 002201 5E6A A2 68       ~2      ldx #w2
 002202 5E6C 20 30 52    ~6      jsr copy2w
 002203 5E6F A9 A0       ~2      lda <unit
 002204 5E71 A0 6D       ~2      ldy >unit
 002205 5E73 A2 60       ~2      ldx #w1
 002206 5E75 20 30 52    ~6      jsr copy2w
 002207 5E78 20 35 55    ~6      jsr div
 002208 5E7B 4C 7D 5B    ~3      jmp acos
 002209                      ;
 002210                      ;   arc cotangent -- acot(x) = atan(1/x)
 002211                      ;
 002212                      ;   w3 = acot(w1)
 002213                      ;
 002214 5E7E A9 60       ~2  acot lda <w1
 002215 5E80 A0 03       ~2      ldy >w1
 002216 5E82 A2 68       ~2      ldx #w2
 002217 5E84 20 30 52    ~6      jsr copy2w
 002218 5E87 A9 A0       ~2      lda <unit
 002219 5E89 A0 6D       ~2      ldy >unit

                              page 42

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 002220 5E8B A2 60       ~2      ldx #w1
 002221 5E8D 20 30 52    ~6      jsr copy2w
 002222 5E90 20 35 55    ~6      jsr div
 002223 5E93 4C 2F 5C    ~3      jmp atan
 002224                      ;
 002225                      ;   loge
 002226                      ;
 002227                      ;   calculate the natural logarithm (ln) of the a
 002228                      ;
 002229                      ;   w3 = ln(w1)
 002230                      ;   
 002231 5E96 AD 60 03    ~4  loge lda w1
 002232 5E99 10 03       ~2-     bpl @F          ; test for negative number
 002233 5E9B 4C 23 69    ~3      jmp domnerr
 002234 5E9E AD 62 03    ~4  @   lda w1+2
 002235 5EA1 D0 03       ~2-     bne @F          ; test for zero argument
 002236 5EA3 4C 2F 69    ~3      jmp rangerr
 002237 5EA6 A2 07       ~2  @   ldx #7
 002238 5EA8 BD 60 03    ~4, @   lda w1,x        ; save argument
 002239 5EAB 9D 90 03    ~5      sta reg1,x
 002240 5EAE CA          ~2      dex
 002241 5EAF 10 F7       ~2-     bpl @B
 002242 5EB1 AD 60 03    ~4      lda w1          ; if argument is near unity, 
 002243 5EB4 D0 3A       ~2-     bne @F1          ;  9.9 e-1 < arg < 1.01 e0
 002244 5EB6 AD 61 03    ~4      lda w1+1
 002245 5EB9 D0 35       ~2-     bne @F1
 002246 5EBB AD 62 03    ~4      lda w1+2
 002247 5EBE C9 10       ~2      cmp #$10
 002248 5EC0 D0 2E       ~2-     bne @F1
 002249                      ;
 002250                      ;   argument is near unity. test for series solut
 002251                      ;
 002252 5EC2 A9 A0       ~2      lda <unit
 002253 5EC4 A0 6D       ~2      ldy >unit
 002254 5EC6 A2 68       ~2      ldx #w2
 002255 5EC8 20 30 52    ~6      jsr copy2w
 002256 5ECB 20 AE 50    ~6      jsr sub
 002257 5ECE AD 72 03    ~4      lda w3+2
 002258 5ED1 D0 03       ~2-     bne @F          ; check for arg = 0.0
 002259 5ED3 4C 19 69    ~3      jmp retzr
 002260 5ED6 AD 70 03    ~4  @   lda w3
 002261 5ED9 C9 40       ~2      cmp #$40
 002262 5EDB D0 0A       ~2-     bne lnargrst
 002263 5EDD AD 71 03    ~4      lda w3+1
 002264 5EE0 C9 03       ~2      cmp #$3
 002265 5EE2 90 03       ~2-     bcc lnargrst
 002266 5EE4 4C D8 60    ~3      jmp lnser
 002267 5EE7 A9 90       ~2  lnargrst lda <reg1
 002268 5EE9 A0 03       ~2      ldy >reg1
 002269 5EEB A2 60       ~2      ldx #w1
 002270 5EED 20 30 52    ~6      jsr copy2w
 002271 5EF0 20 0E 69    ~6  @   jsr clr_r       ; clear all workspace regs
 002272 5EF3 A2 05       ~2      ldx #5          ; copy mantissa to 'ra'

                              page 43

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 002273 5EF5 BD 62 03    ~4, @   lda w1+2,x
 002274 5EF8 9D 02 03    ~5      sta ra+2,x
 002275 5EFB CA          ~2      dex
 002276 5EFC 10 F7       ~2-     bpl @B
 002277 5EFE A9 00       ~2      lda #0
 002278 5F00 85 C3       ~3      sta ctr1        ; 'j' index for pseudo-divide
 002279 5F02 A9 06       ~2      lda #6
 002280 5F04 85 C5       ~3      sta ctr3
 002281                      ;
 002282                      ;   main loop
 002283                      ;
 002284 5F06 20 58 60    ~6  lnlp0 jsr cpyra2rc      ; compute each pseudo-quo
 002285 5F09 A5 C3       ~3      lda ctr1
 002286 5F0B 20 9C 60    ~6      jsr shfrcn
 002287 5F0E 20 64 60    ~6      jsr addrc2ra
 002288 5F11 B0 08       ~2-     bcs @F
 002289 5F13 A6 C3       ~3      ldx ctr1
 002290 5F15 FE 30 03    ~7,     inc rd,x
 002291 5F18 4C 06 5F    ~3      jmp lnlp0
 002292                      
 002293 5F1B 20 76 60    ~6  @   jsr subrc2ra        ; restore remainder after
 002294 5F1E E6 C3       ~5      inc ctr1           
 002295 5F20 C6 C5       ~5      dec ctr3
 002296 5F22 D0 E2       ~2-     bne lnlp0           ; another iteration?
 002297                      
 002298 5F24 A2 06       ~2      ldx #6
 002299 5F26 38          ~2      sec
 002300 5F27 A9 00       ~2  @   lda #0              ; compute residual to sta
 002301 5F29 FD 02 03    ~4,     sbc ra+2,x
 002302 5F2C 9D 02 03    ~5      sta ra+2,x
 002303 5F2F CA          ~2      dex
 002304 5F30 10 F5       ~2-     bpl @B
 002305                      
 002306 5F32 A2 07       ~2      ldx #7          ; shift right one digit
 002307 5F34 A9 00       ~2      lda #0
 002308 5F36 BC 02 03    ~4, @   ldy ra+2,x
 002309 5F39 19 54 69    ~4,     ora tlh,y
 002310 5F3C 9D 03 03    ~5      sta ra+3,x
 002311 5F3F B9 F4 69    ~4      lda thl,y
 002312 5F42 CA          ~2      dex
 002313 5F43 10 F1       ~2-     bpl @B
 002314 5F45 8D 02 03    ~4      sta ra+2
 002315                      ;
 002316                      ;   pseudo-multiply
 002317                      ;
 002318 5F48 A9 00       ~2      lda <kxlog     ; set pointer to table of logs
 002319 5F4A 85 F2       ~3      sta ptr1
 002320 5F4C A9 6F       ~2      lda >kxlog
 002321 5F4E 85 F3       ~3      sta ptr1+1
 002322 5F50 A9 00       ~2      lda #0          ; initialize counters
 002323 5F52 85 C3       ~3      sta ctr1
 002324 5F54 A9 06       ~2      lda #6
 002325 5F56 85 C4       ~3      sta ctr2

                              page 44

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 002326 5F58 A6 C3       ~3  lnlp1 ldx ctr1      ; perform pseudo-multiply for
 002327 5F5A DE 30 03    ~6      dec rd,x
 002328 5F5D 30 10       ~2-     bmi npsm
 002329 5F5F A0 06       ~2      ldy #6
 002330 5F61 18          ~2      clc
 002331 5F62 B9 02 03    ~4  @   lda ra+2,y
 002332 5F65 71 F2       ~5      adc (ptr1),y
 002333 5F67 99 02 03    ~5      sta ra+2,y
 002334 5F6A 88          ~2      dey
 002335 5F6B 10 F5       ~2-     bpl @B
 002336 5F6D 30 E9       ~2-     bmi lnlp1
 002337 5F6F D8          ~2  npsm cld            ; bump table pointer to next 
 002338 5F70 18          ~2      clc
 002339 5F71 A5 F2       ~3      lda ptr1
 002340 5F73 69 08       ~2      adc #8
 002341 5F75 85 F2       ~3      sta ptr1
 002342 5F77 90 02       ~2-     bcc @F
 002343 5F79 E6 F3       ~5      inc ptr1+1
 002344 5F7B F8          ~2  @   sed
 002345 5F7C E6 C3       ~5      inc ctr1
 002346 5F7E C6 C4       ~5      dec ctr2
 002347 5F80 D0 D6       ~2-     bne lnlp1
 002348                      ;
 002349                      ;   'ra' contains ln(mantissa). adjust exponent i
 002350                      ;
 002351 5F82 AD 02 03    ~4  @   lda ra+2        ; (ctr2 is now 0)
 002352 5F85 29 F0       ~2      and #$f0
 002353 5F87 D0 07       ~2-     bne ln2fp
 002354 5F89 20 88 60    ~6      jsr shflfta
 002355 5F8C E6 C4       ~5      inc ctr2
 002356 5F8E D0 F2       ~2-     bne @B
 002357 5F90 A2 05       ~2  ln2fp ldx #5        ; save current logarithm as F
 002358 5F92 BD 02 03    ~4, @    lda ra+2,x
 002359 5F95 9D 9A 03    ~5      sta reg2+2,x
 002360 5F98 CA          ~2      dex
 002361 5F99 10 F7       ~2-     bpl @B
 002362 5F9B A9 80       ~2      lda #$80        ; sign of mantissa?
 002363 5F9D 8D 98 03    ~4      sta reg2
 002364 5FA0 A5 C4       ~3      lda ctr2
 002365 5FA2 8D 99 03    ~4      sta reg2+1
 002366 5FA5 F0 08       ~2-     beq @F
 002367 5FA7 A9 40       ~2      lda #$40        ; sign of exponent
 002368 5FA9 0D 98 03    ~4      ora reg2
 002369 5FAC 8D 98 03    ~4      sta reg2
 002370                      @
 002371 5FAF 20 EB 5F    ~6      jsr exp2fp
 002372 5FB2 A9 A0       ~2      lda <unit
 002373 5FB4 A0 6D       ~2      ldy >unit
 002374 5FB6 A2 68       ~2      ldx #w2
 002375 5FB8 20 30 52    ~6      jsr copy2w
 002376 5FBB 20 B6 50    ~6      jsr add
 002377 5FBE A9 70       ~2      lda <w3
 002378 5FC0 A0 03       ~2      ldy >w3

                              page 45

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 002379 5FC2 A2 60       ~2      ldx #w1
 002380 5FC4 20 30 52    ~6      jsr copy2w
 002381 5FC7 A9 38       ~2      lda <ln10
 002382 5FC9 A0 6D       ~2      ldy >ln10
 002383 5FCB A2 68       ~2      ldx #w2
 002384 5FCD 20 30 52    ~6      jsr copy2w
 002385 5FD0 20 78 53    ~6      jsr mul
 002386 5FD3 A2 07       ~2      ldx #7
 002387 5FD5 BD 98 03    ~4' @   lda reg2,x
 002388 5FD8 9D 60 03    ~5      sta w1,x
 002389 5FDB CA          ~2      dex
 002390 5FDC 10 F7       ~2-     bpl @B
 002391 5FDE A9 70       ~2      lda <w3
 002392 5FE0 A0 03       ~2      ldy >w3
 002393 5FE2 A2 68       ~2      ldx #w2
 002394 5FE4 20 30 52    ~6      jsr copy2w
 002395 5FE7 20 B6 50    ~6      jsr add
 002396 5FEA 60          ~6      rts
 002397                      ;
 002398                      ;   exp2fp -- convert exponent in 'w1' to signed 
 002399                      ;
 002400 5FEB A2 05       ~2  exp2fp ldx #5
 002401 5FED A9 00       ~2      lda #0
 002402 5FEF 9D 62 03    ~5  @   sta w1+2,x  ; clear mantissa space
 002403 5FF2 CA          ~2      dex
 002404 5FF3 10 FA       ~2-     bpl @B
 002405 5FF5 AD 60 03    ~4      lda w1
 002406 5FF8 29 7F       ~2      and #$7f
 002407 5FFA 8D 60 03    ~4      sta w1
 002408 5FFD 29 40       ~2      and #$40
 002409 5FFF 0A          ~2      asl
 002410 6000 AA          ~2      tax         ; save sign bit
 002411 6001 AD 60 03    ~4      lda w1
 002412 6004 29 0F       ~2      and #$f
 002413 6006 D0 29       ~2-     bne bigexp
 002414 6008 8E 60 03    ~4      stx w1
 002415 600B AD 61 03    ~4      lda w1+1
 002416 600E 29 F0       ~2      and #$f0
 002417 6010 D0 13       ~2-     bne medexp
 002418 6012 AD 61 03    ~4      lda w1+1
 002419 6015 0A          ~2      asl
 002420 6016 0A          ~2      asl
 002421 6017 0A          ~2      asl
 002422 6018 0A          ~2      asl
 002423 6019 8D 62 03    ~4      sta w1+2
 002424 601C A9 00       ~2      lda #0
 002425 601E 8D 61 03    ~4      sta w1+1
 002426 6021 8E 60 03    ~4      stx w1
 002427 6024 60          ~6      rts
 002428                      
 002429 6025 8D 62 03    ~4  medexp sta w1+2
 002430 6028 A9 01       ~2      lda #1
 002431 602A 8D 61 03    ~4      sta w1+1

                              page 46

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 002432 602D 8E 60 03    ~4      stx w1
 002433 6030 60          ~6      rts
 002434                      
 002435 6031 0A          ~2  bigexp asl
 002436 6032 0A          ~2      asl
 002437 6033 0A          ~2      asl
 002438 6034 0A          ~2      asl
 002439 6035 8D 62 03    ~4      sta w1+2
 002440 6038 AD 61 03    ~4      lda w1+1
 002441 603B 4A          ~2      lsr
 002442 603C 4A          ~2      lsr
 002443 603D 4A          ~2      lsr
 002444 603E 4A          ~2      lsr
 002445 603F 0D 62 03    ~4      ora w1+2
 002446 6042 8D 62 03    ~4      sta w1+2
 002447 6045 AD 61 03    ~4      lda w1+1
 002448 6048 0A          ~2      asl
 002449 6049 0A          ~2      asl
 002450 604A 0A          ~2      asl
 002451 604B 0A          ~2      asl
 002452 604C 8D 63 03    ~4      sta w1+3
 002453 604F A9 02       ~2      lda #2
 002454 6051 8D 61 03    ~4      sta w1+1
 002455 6054 8E 60 03    ~4      stx w1
 002456 6057 60          ~6      rts
 002457                      
 002458 6058 A0 06       ~2  cpyra2rc ldy #6
 002459 605A B9 02 03    ~4  @   lda ra+2,y
 002460 605D 99 22 03    ~5      sta rc+2,y
 002461 6060 88          ~2      dey
 002462 6061 10 F7       ~2-     bpl @B
 002463 6063 60          ~6      rts
 002464                      ;
 002465                      ;   add 'rc' to 'ra'. 'rc' is shifted right by ct
 002466                      ;
 002467 6064 D8          ~2  addrc2ra cld
 002468 6065 18          ~2      clc
 002469 6066 A2 07       ~2      ldx #7
 002470 6068 F8          ~2      sed
 002471 6069 BD 02 03    ~4, @   lda ra+2,x
 002472 606C 7D 22 03    ~4,     adc rc+2,x
 002473 606F 9D 02 03    ~5      sta ra+2,x
 002474 6072 CA          ~2      dex
 002475 6073 10 F4       ~2-     bpl @B
 002476 6075 60          ~6      rts
 002477                      ;
 002478                      ;   subtract 'rc' from 'ra'. 'rc' is shifted righ
 002479                      ;
 002480 6076 D8          ~2  subrc2ra cld
 002481 6077 38          ~2      sec
 002482 6078 F8          ~2      sed
 002483 6079 A2 07       ~2      ldx #7
 002484 607B BD 02 03    ~4, @   lda ra+2,x

                              page 47

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 002485 607E FD 22 03    ~4,     sbc rc+2,x
 002486 6081 9D 02 03    ~5      sta ra+2,x
 002487 6084 CA          ~2      dex
 002488 6085 10 F4       ~2-     bpl @B
 002489 6087 60          ~6      rts
 002490                      ;
 002491                      ;   shift 'ra' left one digit
 002492                      ;
 002493 6088 A2 08       ~2  shflfta ldx #8
 002494 608A A9 00       ~2      lda #0
 002495 608C BC 02 03    ~4, @   ldy ra+2,x
 002496 608F 19 54 69    ~4,     ora tlh,y
 002497 6092 9D 02 03    ~5      sta ra+2,x
 002498 6095 B9 F4 69    ~4      lda thl,y
 002499 6098 CA          ~2      dex
 002500 6099 10 F1       ~2-     bpl @B
 002501 609B 60          ~6      rts
 002502                      
 002503 609C 85 C4       ~3  shfrcn sta ctr2 ; shift rc right n digits ('n' in
 002504 609E 29 01       ~2      and #1      ; is it an odd number?
 002505 60A0 F0 16       ~2-     beq src0    ; no, only do byte shifts
 002506 60A2 A9 00       ~2      lda #0      ; yes, do single digit shift
 002507 60A4 A2 07       ~2      ldx #7
 002508 60A6 BC 22 03    ~4, @   ldy rc+2,x
 002509 60A9 19 54 69    ~4,     ora tlh,y
 002510 60AC 9D 23 03    ~5      sta rc+3,x
 002511 60AF B9 F4 69    ~4      lda thl,y
 002512 60B2 CA          ~2      dex
 002513 60B3 10 F1       ~2-     bpl @B
 002514 60B5 8D 22 03    ~4      sta rc+2
 002515 60B8 A5 C4       ~3  src0 lda ctr2
 002516 60BA 4A          ~2      lsr         ; convert to bytes
 002517 60BB F0 1A       ~2-     beq srcx    ; exit if no further shift requir
 002518 60BD D8          ~2      cld
 002519 60BE 18          ~2      clc
 002520 60BF 69 07       ~2      adc #7
 002521 60C1 F8          ~2      sed
 002522 60C2 A8          ~2      tay
 002523 60C3 A2 07       ~2      ldx #7
 002524 60C5 BD 22 03    ~4, @   lda rc+2,x
 002525 60C8 99 22 03    ~5      sta rc+2,y
 002526 60CB 88          ~2      dey
 002527 60CC CA          ~2      dex
 002528 60CD 10 F6       ~2-     bpl @B
 002529 60CF A9 00       ~2      lda #0
 002530 60D1 99 22 03    ~5  @   sta rc+2,y
 002531 60D4 88          ~2      dey
 002532 60D5 10 FA       ~2-     bpl @B
 002533 60D7 60          ~6  srcx rts
 002534                      ;                                          
 002535                      ;   lnser -- return logarithm of number near unit
 002536                      ;            enter with (arg - 1) in 'w3'.
 002537                      ;

                              page 48

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 002538 60D8 A9 80       ~2  lnser lda <kln
 002539 60DA 85 F6       ~3      sta ptr3
 002540 60DC A9 6F       ~2      lda >kln
 002541 60DE 85 F7       ~3      sta ptr3+1
 002542 60E0 A9 03       ~2      lda #3
 002543 60E2 85 C3       ~3      sta ctr1
 002544 60E4 A2 07       ~2      ldx #7
 002545 60E6 BD 70 03    ~4, @   lda w3,x    ; save argument (x) to 'reg2'
 002546 60E9 9D 98 03    ~5      sta reg2,x
 002547 60EC CA          ~2      dex
 002548 60ED 10 F7       ~2-     bpl @B
 002549 60EF A0 07       ~2      ldy #7
 002550 60F1 B1 F6       ~5  @   lda (ptr3),y    ; preload 'w3' with 1st coeff
 002551 60F3 99 70 03    ~5      sta w3,y
 002552 60F6 88          ~2      dey
 002553 60F7 10 F8       ~2-     bpl @B
 002554                      ; main loop
 002555 60F9 A0 07       ~2  lnslp ldy #7
 002556 60FB B9 70 03    ~4  @   lda w3,y
 002557 60FE 99 60 03    ~5      sta w1,y
 002558 6101 B9 98 03    ~4      lda reg2,y
 002559 6104 99 68 03    ~5      sta w2,y
 002560 6107 88          ~2      dey
 002561 6108 10 F1       ~2=     bpl @B
 002562 610A 20 78 53    ~6      jsr mul     ; multiply  
 002563 610D C6 C3       ~5      dec ctr1
 002564 610F 30 23       ~2-     bmi lnsrx
 002565 6111 D8          ~2      cld
 002566 6112 18          ~2      clc
 002567 6113 A5 F6       ~3      lda ptr3
 002568 6115 69 08       ~2      adc #8
 002569 6117 85 F6       ~3      sta ptr3
 002570 6119 90 02       ~2-     bcc @F
 002571 611B E6 F7       ~5      inc ptr3+1
 002572 611D F8          ~2  @   sed
 002573 611E A0 07       ~2      ldy #7
 002574 6120 B1 F6       ~5  @   lda (ptr3),y
 002575 6122 99 60 03    ~5      sta w1,y
 002576 6125 B9 70 03    ~4      lda w3,y
 002577 6128 99 68 03    ~5      sta w2,y
 002578 612B 88          ~2      dey
 002579 612C 10 F2       ~2-     bpl @B
 002580 612E 20 B6 50    ~6      jsr add     ; add next coefficient
 002581 6131 4C F9 60    ~3      jmp lnslp
 002582 6134 60          ~6  lnsrx rts
 002583                      
 002584                      ;
 002585                      ;   exp
 002586                      ;
 002587                      ;   calculate exp(arg) where the argument is in '
 002588                      ;
 002589                      ;   First, the argument is checked for sign. If t
 002590                      ;   argument is negative, the absolute value of t

                              page 49

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 002591                      ;   is sent to the 'exp' routine and the reciproc
 002592                      ;   is returned to the caller.
 002593                      ;
 002594                      ;   Next, the integer part of the argument is tak
 002595                      ;   calculate a power-of-ten multiplier (number o
 002596                      ;   is found. A residual decimal fraction from th
 002597                      ;   added to the fractional value of the given ar
 002598                      ;   'exp' routine is called with this sum as its 
 002599                      ;
 002600                      ;   The result is combined with the previously ca
 002601                      ;   point adjustment and a test for taking the re
 002602                      ;   After all operations are complete, the result
 002603                      ;   the caller.
 002604                      ;
 002605                      ;   This implementation takes the mantissa and tr
 002606                      ;   it were in the range: 0.1 <= m <= 0.99999....
 002607                      ;   1.0 <= m <= 9.99999......
 002608                      ;
 002609                      ;   The algorithm works by finding a pseudo-quoti
 002610                      ;   mantissa using a table of natural logs of 2, 
 002611                      ;   1.0001, etc. The digits of the pseudo-quotien
 002612                      ;   number of subtractions of the appropriate log
 002613                      ;
 002614                      ;   After 6-8 pseudo-quotient digits have been fo
 002615                      ;   to the residual and the pseudo-multiply algor
 002616                      ;
 002617                      ;   q = arg/ln10
 002618                      ;   f = floor(q)
 002619                      ;   r = q - f
 002620                      ; 
 002621                      ;
 002622 6135 A9 00       ~2  exp lda #0
 002623 6137 85 CD       ~3      sta expflg
 002624 6139 AD 60 03    ~4      lda w1
 002625 613C 29 0F       ~2      and #$0f
 002626 613E F0 03       ~2-     beq @F
 002627 6140 4C 2F 69    ~3  xpre jmp rangerr
 002628 6143 AD 62 03    ~4  @   lda w1+2
 002629 6146 D0 09       ~2-     bne @F
 002630 6148 A9 A0       ~2  xrt1 lda <unit
 002631 614A A0 6D       ~2      ldy >unit
 002632 614C A2 70       ~2      ldx #w3
 002633 614E 4C 30 52    ~3      jmp copy2w
 002634 6151 2C 60 03    ~4  @   bit w1
 002635 6154 10 0A       ~2-     bpl @F
 002636 6156 A9 80       ~2      lda #$80
 002637 6158 85 CD       ~3      sta expflg
 002638 615A 4D 60 03    ~4      eor w1
 002639 615D 8D 60 03    ~4      sta w1
 002640 6160 2C 60 03    ~4  @   bit w1
 002641 6163 50 10       ~2-     bvc @F
 002642 6165 AD 60 03    ~4      lda w1      ; check for range problem with ex
 002643 6168 29 0F       ~2      and #$0f

                              page 50

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 002644 616A D0 DC       ~2-     bne xrt1    ; large negative exponent returns
 002645 616C AD 61 03    ~4      lda w1+1
 002646 616F C9 12       ~2      cmp #$12
 002647 6171 B0 D5       ~2-     bcs xrt1
 002648 6173 90 12       ~2-     bcc @F1
 002649 6175 AD 61 03    ~4  @   lda w1+1  
 002650 6178 C9 04       ~2      cmp #4
 002651 617A B0 C4       ~2-     bcs xpre
 002652 617C C9 03       ~2      cmp #3
 002653 617E D0 07       ~2-     bne @F
 002654 6180 AD 62 03    ~4      lda w1+2
 002655 6183 C9 23       ~2      cmp #$23
 002656 6185 B0 B9       ~2-     bcs xpre
 002657 6187 A9 40       ~2  @   lda <iln10      ; form arg/ln10
 002658 6189 A0 6D       ~2      ldy >iln10
 002659 618B A2 68       ~2      ldx #w2
 002660 618D 20 30 52    ~6      jsr copy2w
 002661 6190 20 78 53    ~6      jsr mul
 002662 6193 A9 70       ~2      lda <w3
 002663 6195 A0 03       ~2      ldy >w3
 002664 6197 A2 90       ~2      ldx #reg1
 002665 6199 20 30 52    ~6      jsr copy2w      ; save backup copy of arg/ln1
 002666 619C A9 70       ~2      lda <w3
 002667 619E A0 03       ~2      ldy >w3
 002668 61A0 A2 60       ~2      ldx #w1
 002669 61A2 20 30 52    ~6      jsr copy2w
 002670 61A5 20 E2 66    ~6      jsr int
 002671 61A8 A9 70       ~2      lda <w3
 002672 61AA A0 03       ~2      ldy >w3
 002673 61AC A2 68       ~2      ldx #w2
 002674 61AE 20 30 52    ~6      jsr copy2w
 002675 61B1 A9 70       ~2      lda <w3
 002676 61B3 A0 03       ~2      ldy >w3
 002677 61B5 A2 98       ~2      ldx #reg2       ; save power of 10 (exponent)
 002678 61B7 20 30 52    ~6      jsr copy2w
 002679 61BA 20 AE 50    ~6      jsr sub
 002680 61BD A9 70       ~2      lda <w3
 002681 61BF A0 03       ~2      ldy >w3
 002682 61C1 A2 60       ~2      ldx #w1
 002683 61C3 20 30 52    ~6      jsr copy2w
 002684 61C6 A9 38       ~2      lda <ln10
 002685 61C8 A0 6D       ~2      ldy >ln10
 002686 61CA A2 68       ~2      ldx #w2  
 002687 61CC 20 30 52    ~6      jsr copy2w
 002688 61CF 20 78 53    ~6      jsr mul
 002689 61D2 A9 00       ~2      lda #0
 002690 61D4 85 C0       ~3      sta tmp1        ; clear shift count register
 002691 61D6 2C 70 03    ~4      bit w3
 002692 61D9 50 10       ~2-     bvc xshft
 002693 61DB AD 71 03    ~4      lda w3+1
 002694 61DE C9 12       ~2      cmp #$12
 002695 61E0 90 03       ~2-     bcc @F
 002696 61E2 4C 48 61    ~3      jmp xrt1

                              page 51

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 002697 61E5 AA          ~2  @   tax
 002698 61E6 BD 94 6A    ~4'     lda dec2bin,x
 002699 61E9 85 C0       ~3      sta tmp1
 002700 61EB 20 30 62    ~6  xshft jsr xexp
 002701                      ;
 002702                      ;   mantissa of exponential is in 'w1'. get expon
 002703                      ;
 002704 61EE AC 99 03    ~4      ldy reg2+1
 002705 61F1 A9 00       ~2      lda #0
 002706 61F3 8D 99 03    ~4      sta reg2+1
 002707 61F6 A2 03       ~2  xxp ldx #3       ; move exponent value from manti
 002708 61F8 0E 9B 03    ~6  @   asl reg2+3
 002709 61FB 2E 9A 03    ~6      rol reg2+2
 002710 61FE 2E 99 03    ~6      rol reg2+1
 002711 6201 2E 98 03    ~6      rol reg2
 002712 6204 CA          ~2      dex
 002713 6205 10 F1       ~2=     bpl @B
 002714 6207 88          ~2      dey
 002715 6208 10 EC       ~2=     bpl xxp
 002716 620A AD 98 03    ~4      lda reg2     ; copy exponent to w1
 002717 620D 8D 70 03    ~4      sta w3
 002718 6210 AD 99 03    ~4      lda reg2+1
 002719 6213 8D 71 03    ~4      sta w3+1
 002720 6216 24 CD       ~3      bit expflg
 002721 6218 10 15       ~2-     bpl @F
 002722 621A A9 70       ~2      lda <w3
 002723 621C A0 03       ~2      ldy >w3
 002724 621E A2 68       ~2      ldx #w2
 002725 6220 20 30 52    ~6      jsr copy2w
 002726 6223 A9 A0       ~2      lda <unit
 002727 6225 A0 6D       ~2      ldy >unit
 002728 6227 A2 60       ~2      ldx #w1
 002729 6229 20 30 52    ~6      jsr copy2w
 002730 622C 20 35 55    ~6      jsr div
 002731                      @
 002732 622F 60          ~6      rts
 002733                      ;
 002734                      ;   xexp -- main exponential computation routine
 002735                      ;
 002736 6230 20 0E 69    ~6  xexp jsr clr_r
 002737 6233 A2 05       ~2      ldx #5
 002738 6235 A5 C0       ~3      lda tmp1
 002739 6237 4A          ~2      lsr         ; ignore odd bit for now
 002740 6238 D8          ~2      cld
 002741 6239 18          ~2      clc
 002742 623A 69 05       ~2      adc #5
 002743 623C A8          ~2      tay
 002744 623D BD 72 03    ~4, @   lda w3+2,x
 002745 6240 99 02 03    ~5      sta ra+2,y
 002746 6243 9D 12 03    ~5      sta rb+2,x
 002747 6246 88          ~2      dey
 002748 6247 CA          ~2      dex
 002749 6248 10 F3       ~2-     bpl @B

                              page 52

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 002750 624A A5 C0       ~3      lda tmp1
 002751 624C 8D 40 03    ~4      sta re
 002752 624F 4A          ~2      lsr         ; do odd bit shift (if any)
 002753 6250 90 16       ~2-     bcc @F1
 002754                      
 002755 6252 A2 08       ~2      ldx #8
 002756 6254 A9 00       ~2      lda #0
 002757 6256 BC 01 03    ~4, @   ldy ra+1,x   ;   12 34 00
 002758 6259 19 54 69    ~4,     ora tlh,y    ;   01 23 40
 002759 625C 9D 02 03    ~5      sta ra+2,x
 002760 625F B9 F4 69    ~4      lda thl,y
 002761 6262 CA          ~2      dex
 002762 6263 10 F1       ~2-     bpl @B
 002763 6265 9D 02 03    ~5      sta ra+2,x
 002764                      @
 002765                      ;
 002766                      ;   this is the routine which computes the natura
 002767                      ;   the number in 'ra'.
 002768                      ;
 002769 6268 A9 00       ~2  xnl lda <kxlog
 002770 626A A0 6F       ~2      ldy >kxlog
 002771 626C 85 F2       ~3      sta ptr1
 002772 626E 84 F3       ~3      sty ptr1+1
 002773 6270 A9 07       ~2      lda #7
 002774 6272 85 C1       ~3      sta tmp2        ; 'tmp2' is outer loop counte
 002775 6274 A9 00       ~2      lda #0
 002776 6276 85 C3       ~3      sta ctr1
 002777                      ;
 002778                      ;   subtract 'klog' entry from 'ra' until underfl
 002779                      ;
 002780 6278 A9 00       ~2  mxlp0 lda #0
 002781 627A AA          ~2      tax
 002782 627B F8          ~2  mxlp sed
 002783 627C 38          ~2      sec
 002784 627D A0 07       ~2      ldy #7
 002785 627F B9 02 03    ~4  @   lda ra+2,y
 002786 6282 F1 F2       ~5      sbc (ptr1),y
 002787 6284 99 02 03    ~5      sta ra+2,y
 002788 6287 99 22 03    ~5      sta rc+2,y
 002789 628A 88          ~2      dey
 002790 628B 10 F2       ~2-     bpl @B
 002791 628D E8          ~2      inx
 002792 628E B0 EB       ~2-     bcs mxlp
 002793 6290 CA          ~2      dex
 002794 6291 8A          ~2      txa              ; 'x' has current pseudo-quo
 002795 6292 A6 C3       ~3      ldx ctr1
 002796 6294 9D 30 03    ~5      sta rd,x
 002797 6297 E6 C3       ~5      inc ctr1
 002798 6299 18          ~2      clc
 002799 629A A0 07       ~2      ldy #7
 002800 629C B9 02 03    ~4  @   lda ra+2,y         ; restore 'ra' after under
 002801 629F 71 F2       ~5      adc (ptr1),y
 002802 62A1 99 02 03    ~5      sta ra+2,y

                              page 53

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 002803 62A4 88          ~2      dey
 002804 62A5 10 F5       ~2-     bpl @B
 002805 62A7 D8          ~2      cld
 002806 62A8 18          ~2      clc
 002807 62A9 A5 F2       ~3      lda ptr1
 002808 62AB 69 08       ~2      adc #8
 002809 62AD 85 F2       ~3      sta ptr1
 002810 62AF 90 02       ~2-     bcc @F
 002811 62B1 E6 F3       ~5      inc ptr1+1
 002812 62B3 C6 C1       ~5  @   dec tmp2
 002813 62B5 10 C1       ~2-     bpl mxlp0
 002814                      ;
 002815                      ;   pseudo-quotients are found, now perform pseud
 002816                      ;
 002817 62B7 A9 00       ~2      lda #0      ; 'ctr1' is offset to pseudo-quot
 002818 62B9 85 C3       ~3      sta ctr1
 002819 62BB A9 10       ~2      lda #$10    ; add '1' to residual in 'ra'    
 002820 62BD 8D 02 03    ~4      sta ra+2
 002821 62C0 A2 07       ~2      ldx #7
 002822 62C2 86 C5       ~3      stx ctr3    ; 'ctr3' is outer loop counter (n
 002823 62C4 A2 07       ~2      ldx #7
 002824 62C6 BD 02 03    ~4, @   lda ra+2,x  ; copy 'ra' to 'rc'
 002825 62C9 9D 22 03    ~5      sta rc+2,x
 002826 62CC CA          ~2      dex
 002827 62CD 10 F7       ~2-     bpl @B
 002828                      ;
 002829                      ;  multiply 'ra' by 2.0, 1.1, 1.01, etc. iterate 
 002830                      ;   as controlled by pseudo-digit in 'rd'
 002831                      ;
 002832 62CF A6 C3       ~3  xml ldx ctr1
 002833 62D1 DE 30 03    ~6      dec rd,x
 002834 62D4 30 23       ~2-     bmi xbd
 002835                      ;
 002836                      ;   copy 'ra' to 'rc' shifted right
 002837                      ;
 002838 62D6 A2 07       ~2      ldx #7
 002839 62D8 BD 00 03    ~4  @   lda ra,x
 002840 62DB 9D 20 03    ~5      sta rc,x
 002841 62DE CA          ~2      dex
 002842 62DF 10 F7       ~2-     bpl @B
 002843 62E1 A5 C3       ~3      lda ctr1
 002844 62E3 20 9C 60    ~6      jsr shfrcn
 002845 62E6 F8          ~2      sed
 002846 62E7 A2 05       ~2      ldx #5
 002847 62E9 18          ~2      clc
 002848 62EA BD 02 03    ~4, @   lda ra+2,x 
 002849 62ED 7D 22 03    ~4,     adc rc+2,x
 002850 62F0 9D 02 03    ~5      sta ra+2,x
 002851 62F3 CA          ~2      dex
 002852 62F4 10 F4       ~2-     bpl @B
 002853 62F6 4C CF 62    ~3      jmp xml
 002854 62F9 =(25337)        xbd
 002855 62F9 E6 C3       ~5      inc ctr1

                              page 54

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 002856 62FB C6 C5       ~5      dec ctr3
 002857 62FD 10 D0       ~2-     bpl xml
 002858 62FF A2 05       ~2      ldx #5
 002859 6301 BD 02 03    ~4, @   lda ra+2,x
 002860 6304 9D 72 03    ~5      sta w3+2,x
 002861 6307 CA          ~2      dex
 002862 6308 10 F7       ~2-     bpl @B
 002863 630A A9 00       ~2      lda #0
 002864 630C 8D 70 03    ~4      sta w3
 002865 630F 8D 71 03    ~4      sta w3+1
 002866 6312 60          ~6      rts
 002867                      ;
 002868                      ;   hyberbolic sine -- calculates sinh(x) = (exp(
 002869                      ;
 002870                      ;   w3 = sinh(w1)
 002871                      ;
 002872 6313 20 35 61    ~6  sinh jsr exp
 002873 6316 A9 70       ~2      lda <w3
 002874 6318 A0 03       ~2      ldy >w3
 002875 631A A2 68       ~2      ldx #w2
 002876 631C 20 30 52    ~6      jsr copy2w
 002877 631F A9 A0       ~2      lda <unit
 002878 6321 A0 6D       ~2      ldy >unit
 002879 6323 A2 60       ~2      ldx #w1
 002880 6325 20 30 52    ~6      jsr copy2w
 002881 6328 20 35 55    ~6      jsr div
 002882 632B A9 70       ~2      lda <w3
 002883 632D A0 03       ~2      ldy >w3
 002884 632F A2 60       ~2      ldx #w1
 002885 6331 20 30 52    ~6      jsr copy2w
 002886 6334 AD 60 03    ~4      lda w1
 002887 6337 09 80       ~3      ora #$80
 002888 6339 8D 60 03    ~4      sta w1
 002889 633C 20 B6 50    ~6      jsr add
 002890 633F A9 70       ~2      lda <w3
 002891 6341 A0 03       ~2      ldy >w3
 002892 6343 A2 60       ~2      ldx #w1
 002893 6345 20 30 52    ~6      jsr copy2w
 002894 6348 A9 A8       ~2      lda <half
 002895 634A A0 6D       ~2      ldy >half
 002896 634C A2 68       ~2      ldx #w2
 002897 634E 20 30 52    ~6      jsr copy2w
 002898 6351 4C 78 53    ~3      jmp mul
 002899                      ;
 002900                      ;   hyperbolic cosine -- calculates cosh(x) = (ex
 002901                      ;
 002902                      ;   w3 = cosh(w1)
 002903                      ;
 002904 6354 20 35 61    ~6  cosh jsr exp
 002905 6357 A9 70       ~2      lda <w3
 002906 6359 A0 03       ~2      ldy >w3
 002907 635B A2 68       ~2      ldx #w2
 002908 635D 20 30 52    ~6      jsr copy2w

                              page 55

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 002909 6360 A9 A0       ~2      lda <unit
 002910 6362 A0 6D       ~2      ldy >unit
 002911 6364 A2 60       ~2      ldx #w1
 002912 6366 20 30 52    ~6      jsr copy2w
 002913 6369 20 35 55    ~6      jsr div
 002914 636C A9 70       ~2      lda <w3
 002915 636E A0 03       ~2      ldy >w3
 002916 6370 A2 60       ~2      ldx #w1
 002917 6372 20 30 52    ~6      jsr copy2w
 002918 6375 20 B6 50    ~6      jsr add
 002919 6378 A9 70       ~2      lda <w3
 002920 637A A0 03       ~2      ldy >w3
 002921 637C A2 60       ~2      ldx #w1
 002922 637E 20 30 52    ~6      jsr copy2w
 002923 6381 A9 A8       ~2      lda <half
 002924 6383 A0 6D       ~2      ldy >half
 002925 6385 A2 68       ~2      ldx #w2
 002926 6387 20 30 52    ~6      jsr copy2w
 002927 638A 4C 78 53    ~3      jmp mul
 002928                      ;
 002929                      ;   tanh -- compute (exp(x) - exp(-x))/(exp(x) + 
 002930                      ;
 002931                      ;   w3 = tanh(w1)
 002932                      ;
 002933 638D 20 35 61    ~6  tanh jsr exp
 002934 6390 A9 70       ~2      lda <w3         ; w3 = exp(x)
 002935 6392 A0 03       ~2      ldy >w3
 002936 6394 A2 68       ~2      ldx #w2
 002937 6396 20 30 52    ~6      jsr copy2w      ; w2 = exp(x)
 002938 6399 A2 07       ~2      ldx #7
 002939 639B BD 70 03    ~4, @   lda w3,x        ; save exp(x) in reg2
 002940 639E 9D 98 03    ~5      sta reg2,x
 002941 63A1 CA          ~2      dex
 002942 63A2 10 F7       ~2-     bpl @B
 002943                      
 002944 63A4 A9 A0       ~2      lda <unit
 002945 63A6 A0 6D       ~2      ldy >unit
 002946 63A8 A2 60       ~2      ldx #w1
 002947 63AA 20 30 52    ~6      jsr copy2w
 002948 63AD 20 35 55    ~6      jsr div         ; w3 = exp(-x)
 002949 63B0 A9 70       ~2      lda <w3
 002950 63B2 A0 03       ~2      ldy >w3
 002951 63B4 A2 68       ~2      ldx #w2
 002952 63B6 20 30 52    ~6      jsr copy2w      ; w2 = exp(-x)
 002953 63B9 A2 07       ~2      ldx #7
 002954 63BB BD 70 03    ~4, @   lda w3,x        ; save exp(-x) in reg3
 002955 63BE 9D A0 03    ~5      sta reg3,x
 002956 63C1 CA          ~2      dex
 002957 63C2 10 F7       ~2-     bpl @B
 002958 63C4 A9 98       ~2      lda <reg2
 002959 63C6 A0 03       ~2      ldy >reg2
 002960 63C8 A2 60       ~2      ldx #w1
 002961 63CA 20 30 52    ~6      jsr copy2w

                              page 56

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 002962 63CD 20 AE 50    ~6      jsr sub         ; w3 = exp(x) - exp(-x)
 002963 63D0 A2 07       ~2      ldx #7
 002964 63D2 BD 98 03    ~4' @   lda reg2,x      ; w1 = exp(x)
 002965 63D5 9D 60 03    ~5      sta w1,x
 002966 63D8 CA          ~2      dex
 002967 63D9 10 F7       ~2-     bpl @B
 002968 63DB A2 07       ~2      ldx #7
 002969 63DD BD A0 03    ~4' @   lda reg3,x      ; w2 = exp(-x)
 002970 63E0 9D 68 03    ~5      sta w2,x
 002971 63E3 CA          ~2      dex
 002972 63E4 10 F7       ~2-     bpl @B
 002973 63E6 A2 07       ~2      ldx #7
 002974 63E8 BD 70 03    ~4, @   lda w3,x        ; reg2 = exp(x) - exp(-x)
 002975 63EB 9D 98 03    ~5      sta reg2,x
 002976 63EE CA          ~2      dex
 002977 63EF 10 F7       ~2-     bpl @B
 002978 63F1 20 B6 50    ~6      jsr add         ; w3 = exp(x) + exp(-x)
 002979 63F4 A2 07       ~2      ldx #7
 002980 63F6 BD 70 03    ~4, @   lda w3,x        ; w1 = exp(x) + exp(-x)
 002981 63F9 9D 68 03    ~5      sta w2,x
 002982 63FC CA          ~2      dex
 002983 63FD 10 F7       ~2-     bpl @B
 002984 63FF A2 07       ~2      ldx #7
 002985 6401 BD 98 03    ~4' @   lda reg2,x      ; w2 = exp(x) - exp(-x)
 002986 6404 9D 60 03    ~5      sta w1,x
 002987 6407 CA          ~2      dex
 002988 6408 10 F7       ~2-     bpl @B
 002989 640A 4C 35 55    ~3      jmp div
 002990                      ;
 002991                      ;   hyperbolic cosecant -- csch(x) = 1/sinh(x)
 002992                      ;
 002993                      ;   w3 = csch(w1)
 002994                      ;
 002995 640D 20 13 63    ~6  csch jsr sinh
 002996 6410 A9 70       ~2      lda <w3
 002997 6412 A0 03       ~2      ldy >w3
 002998 6414 A2 68       ~2      ldx #w2
 002999 6416 20 30 52    ~6      jsr copy2w
 003000 6419 A9 A0       ~2      lda <unit
 003001 641B A0 6D       ~2      ldy >unit
 003002 641D A2 60       ~2      ldx #w1
 003003 641F 20 30 52    ~6      jsr copy2w
 003004 6422 4C 35 55    ~3      jmp div
 003005                      ;
 003006                      ;   hyperbolic secant -- sech(x) = 1/cosh(x)
 003007                      ;
 003008                      ;   w3 = cosh(w1)
 003009                      ;
 003010 6425 20 54 63    ~6  sech jsr cosh
 003011 6428 A9 70       ~2      lda <w3
 003012 642A A0 03       ~2      ldy >w3
 003013 642C A2 68       ~2      ldx #w2
 003014 642E 20 30 52    ~6      jsr copy2w

                              page 57

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 003015 6431 A9 A0       ~2      lda <unit
 003016 6433 A0 6D       ~2      ldy >unit
 003017 6435 A2 60       ~2      ldx #w1
 003018 6437 20 30 52    ~6      jsr copy2w
 003019 643A 4C 35 55    ~3      jmp div
 003020                      ;
 003021                      ;   hyperbolic cotangent -- coth(x) = 1/tanh(x)
 003022                      ;
 003023                      ;   w3 = coth(w1)
 003024                      ;
 003025 643D 20 8D 63    ~6  coth jsr tanh
 003026 6440 A9 70       ~2      lda <w3
 003027 6442 A0 03       ~2      ldy >w3
 003028 6444 A2 68       ~2      ldx #w2
 003029 6446 20 30 52    ~6      jsr copy2w
 003030 6449 A9 A0       ~2      lda <unit
 003031 644B A0 6D       ~2      ldy >unit
 003032 644D A2 60       ~2      ldx #w1
 003033 644F 20 30 52    ~6      jsr copy2w
 003034 6452 4C 35 55    ~3      jmp div
 003035                      ;
 003036                      ;   hyperbolic arc sine -- asinh(x) = ln(x + sqrt
 003037                      ;
 003038                      ;   w3 = asinh(w1)
 003039                      ;
 003040 6455 A2 07       ~2  asinh ldx #7
 003041 6457 BD 60 03    ~4, @   lda w1,x        ; save argument 'x' in reg1
 003042 645A 9D 90 03    ~5      sta reg1,x
 003043 645D CA          ~2      dex
 003044 645E 10 F7       ~2-     bpl @B
 003045 6460 A9 60       ~2      lda <w1
 003046 6462 A0 03       ~2      ldy >w1
 003047 6464 A2 68       ~2      ldx #w2
 003048 6466 20 30 52    ~6      jsr copy2w
 003049 6469 20 78 53    ~6      jsr mul          ; form x^2
 003050 646C A9 70       ~2      lda <w3
 003051 646E A0 03       ~2      ldy >w3
 003052 6470 A2 68       ~2      ldx #w2
 003053 6472 20 30 52    ~6      jsr copy2w
 003054 6475 A9 A0       ~2      lda <unit
 003055 6477 A0 6D       ~2      ldy >unit
 003056 6479 A2 60       ~2      ldx #w1
 003057 647B 20 30 52    ~6      jsr copy2w
 003058 647E 20 B6 50    ~6      jsr add         ; form 1 + x^2
 003059 6481 A9 70       ~2      lda <w3
 003060 6483 A0 03       ~2      ldy >w3
 003061 6485 A2 60       ~2      ldx #w1
 003062 6487 20 30 52    ~6      jsr copy2w
 003063 648A 20 E6 56    ~6      jsr sqrt        ; w3 = sqrt(1 + x^2)
 003064 648D A9 70       ~2      lda <w3
 003065 648F A0 03       ~2      ldy >w3
 003066 6491 A2 68       ~2      ldx #w2
 003067 6493 20 30 52    ~6      jsr copy2w

                              page 58

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 003068 6496 A9 90       ~2      lda <reg1
 003069 6498 A0 03       ~2      ldy >reg1
 003070 649A A2 60       ~2      ldx #w1
 003071 649C 20 30 52    ~6      jsr copy2w
 003072 649F 20 B6 50    ~6      jsr add         ; w3 = x + sqrt(1 + x^2)
 003073 64A2 A9 70       ~2      lda <w3
 003074 64A4 A0 03       ~2      ldy >w3
 003075 64A6 A2 60       ~2      ldx #w1
 003076 64A8 20 30 52    ~6      jsr copy2w
 003077 64AB 4C 96 5E    ~3      jmp loge
 003078                      ;
 003079                      ;   hypberbolic arc cosine: acosh(x) = ln(x + sqr
 003080                      ;
 003081 64AE A2 07       ~2  acosh ldx #7
 003082 64B0 BD 60 03    ~4, @   lda w1,x        ; save argument 'x' in reg1
 003083 64B3 9D 90 03    ~5      sta reg1,x
 003084 64B6 CA          ~2      dex
 003085 64B7 10 F7       ~2-     bpl @B
 003086 64B9 A9 60       ~2      lda <w1
 003087 64BB A0 03       ~2      ldy >w1
 003088 64BD A2 68       ~2      ldx #w2
 003089 64BF 20 30 52    ~6      jsr copy2w
 003090 64C2 20 78 53    ~6      jsr mul          ; form x^2
 003091 64C5 A9 70       ~2      lda <w3
 003092 64C7 A0 03       ~2      ldy >w3
 003093 64C9 A2 60       ~2      ldx #w1
 003094 64CB 20 30 52    ~6      jsr copy2w
 003095 64CE A9 A0       ~2      lda <unit
 003096 64D0 A0 6D       ~2      ldy >unit
 003097 64D2 A2 68       ~2      ldx #w2
 003098 64D4 20 30 52    ~6      jsr copy2w
 003099 64D7 20 AE 50    ~6      jsr sub         ; form x^2 - 1
 003100 64DA A9 70       ~2      lda <w3
 003101 64DC A0 03       ~2      ldy >w3
 003102 64DE A2 60       ~2      ldx #w1
 003103 64E0 20 30 52    ~6      jsr copy2w
 003104 64E3 20 E6 56    ~6      jsr sqrt        ; w3 = sqrt(x^2 - 1)
 003105 64E6 A9 70       ~2      lda <w3
 003106 64E8 A0 03       ~2      ldy >w3
 003107 64EA A2 68       ~2      ldx #w2
 003108 64EC 20 30 52    ~6      jsr copy2w
 003109 64EF A9 90       ~2      lda <reg1
 003110 64F1 A0 03       ~2      ldy >reg1
 003111 64F3 A2 60       ~2      ldx #w1
 003112 64F5 20 30 52    ~6      jsr copy2w
 003113 64F8 20 B6 50    ~6      jsr add         ; w3 = x + sqrt(x^2 - 1)
 003114 64FB A9 70       ~2      lda <w3
 003115 64FD A0 03       ~2      ldy >w3
 003116 64FF A2 60       ~2      ldx #w1
 003117 6501 20 30 52    ~6      jsr copy2w
 003118 6504 4C 96 5E    ~3      jmp loge
 003119                      ;                                           1 + x
 003120                      ;   hyperbolic arc tangent:  atanh(x) = ln( -----

                              page 59

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 003121                      ;                                           1 - x
 003122 6507 A2 07       ~2  atanh ldx #7
 003123 6509 BD 60 03    ~4, @   lda w1,x        ; save 'x' in reg1
 003124 650C 9D 90 03    ~5      sta reg1,x
 003125 650F CA          ~2      dex
 003126 6510 10 F7       ~2-     bpl @B
 003127 6512 A9 A0       ~2      lda <unit
 003128 6514 A0 6D       ~2      ldy >unit
 003129 6516 A2 68       ~2      ldx #w2
 003130 6518 20 30 52    ~6      jsr copy2w
 003131 651B 20 B6 50    ~6      jsr add         ; w3 = 1 + x
 003132 651E A9 A0       ~2      lda <unit
 003133 6520 A0 6D       ~2      ldy >unit
 003134 6522 A2 60       ~2      ldx #w1
 003135 6524 20 30 52    ~6      jsr copy2w
 003136 6527 A9 90       ~2      lda <reg1
 003137 6529 A0 03       ~2      ldy >reg1
 003138 652B A2 68       ~2      ldx #w2
 003139 652D 20 30 52    ~6      jsr copy2w
 003140 6530 A2 07       ~2      ldx #7
 003141 6532 BD 70 03    ~4, @   lda w3,x        ; save (1 + x) in reg1
 003142 6535 9D 90 03    ~5      sta reg1,x
 003143 6538 CA          ~2      dex
 003144 6539 10 F7       ~2-     bpl @B
 003145 653B 20 AE 50    ~6      jsr sub         ; w3 = 1 - x
 003146 653E A9 70       ~2      lda <w3
 003147 6540 A0 03       ~2      ldy >w3
 003148 6542 A2 68       ~2      ldx #w2
 003149 6544 20 30 52    ~6      jsr copy2w
 003150 6547 A9 90       ~2      lda <reg1
 003151 6549 A0 03       ~2      ldy >reg1
 003152 654B A2 60       ~2      ldx #w1
 003153 654D 20 30 52    ~6      jsr copy2w
 003154 6550 20 35 55    ~6      jsr div         ; w3 = (1 + x)/(1 - x)
 003155 6553 A9 70       ~2      lda <w3
 003156 6555 A0 03       ~2      ldy >w3
 003157 6557 A2 60       ~2      ldx #w1
 003158 6559 20 30 52    ~6      jsr copy2w
 003159 655C 20 96 5E    ~6      jsr loge
 003160 655F A9 70       ~2      lda <w3
 003161 6561 A0 03       ~2      ldy >w3
 003162 6563 A2 60       ~2      ldx #w1
 003163 6565 20 30 52    ~6      jsr copy2w
 003164 6568 A9 A8       ~2      lda <half
 003165 656A A0 6D       ~2      ldy >half
 003166 656C A2 68       ~2      ldx #w2
 003167 656E 20 30 52    ~6      jsr copy2w
 003168 6571 4C 78 53    ~3      jmp mul
 003169                      ;
 003170                      ;   hyperbolic arc cosecant: acsch(x) =  asinh(1/
 003171                      ;
 003172 6574 A9 60       ~2  acsch lda <w1
 003173 6576 A0 03       ~2      ldy >w1

                              page 60

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 003174 6578 A2 68       ~2      ldx #w2
 003175 657A 20 30 52    ~6      jsr copy2w
 003176 657D A9 A0       ~2      lda <unit
 003177 657F A0 6D       ~2      ldy >unit
 003178 6581 A2 60       ~2      ldx #w1
 003179 6583 20 30 52    ~6      jsr copy2w
 003180 6586 20 35 55    ~6      jsr div
 003181 6589 A9 70       ~2      lda <w3
 003182 658B A0 03       ~2      ldy >w3
 003183 658D A2 60       ~2      ldx #w1
 003184 658F 20 30 52    ~6      jsr copy2w
 003185 6592 4C 55 64    ~3      jmp asinh
 003186                      ;
 003187                      ;   hyperbolic arc secant: asech(x) = acosh(1/x)
 003188                      ;
 003189 6595 A9 60       ~2  asech lda <w1
 003190 6597 A0 03       ~2      ldy >w1
 003191 6599 A2 68       ~2      ldx #w2
 003192 659B 20 30 52    ~6      jsr copy2w
 003193 659E A9 A0       ~2      lda <unit
 003194 65A0 A0 6D       ~2      ldy >unit
 003195 65A2 A2 60       ~2      ldx #w1
 003196 65A4 20 30 52    ~6      jsr copy2w
 003197 65A7 20 35 55    ~6      jsr div
 003198 65AA A9 70       ~2      lda <w3
 003199 65AC A0 03       ~2      ldy >w3
 003200 65AE A2 60       ~2      ldx #w1
 003201 65B0 20 30 52    ~6      jsr copy2w
 003202 65B3 4C AE 64    ~3      jmp acosh
 003203                      ;
 003204                      ;   hyperbolic arc cotangent: acoth(x) = atanh(1/
 003205                      ;
 003206 65B6 A9 60       ~2  acoth lda <w1
 003207 65B8 A0 03       ~2      ldy >w1
 003208 65BA A2 68       ~2      ldx #w2
 003209 65BC 20 30 52    ~6      jsr copy2w
 003210 65BF A9 A0       ~2      lda <unit
 003211 65C1 A0 6D       ~2      ldy >unit
 003212 65C3 A2 60       ~2      ldx #w1
 003213 65C5 20 30 52    ~6      jsr copy2w
 003214 65C8 20 35 55    ~6      jsr div
 003215 65CB A9 70       ~2      lda <w3
 003216 65CD A0 03       ~2      ldy >w3
 003217 65CF A2 60       ~2      ldx #w1
 003218 65D1 20 30 52    ~6      jsr copy2w
 003219 65D4 4C 07 65    ~3      jmp atanh
 003220                      ;
 003221                      ;   log2(x) = loge(x)/loge(2)
 003222                      ;     
 003223 65D7 20 96 5E    ~6  log2 jsr loge
 003224 65DA A9 70       ~2      lda <w3
 003225 65DC A0 03       ~2      ldy >w3
 003226 65DE A2 60       ~2      ldx #w1

                              page 61

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 003227 65E0 20 30 52    ~6      jsr copy2w
 003228 65E3 A9 30       ~2      lda <ln2
 003229 65E5 A0 6D       ~2      ldy >ln2
 003230 65E7 A2 68       ~2      ldx #w2
 003231 65E9 20 30 52    ~6      jsr copy2w
 003232 65EC 4C 35 55    ~3      jmp div
 003233                      ;
 003234                      ;   log10(x) = loge(x)/loge(10)
 003235                      ;
 003236 65EF 20 96 5E    ~6  log10 jsr loge
 003237 65F2 A9 70       ~2      lda <w3
 003238 65F4 A0 03       ~2      ldy >w3
 003239 65F6 A2 60       ~2      ldx #w1
 003240 65F8 20 30 52    ~6      jsr copy2w
 003241 65FB A9 38       ~2      lda <ln10
 003242 65FD A0 6D       ~2      ldy >ln10
 003243 65FF A2 68       ~2      ldx #w2
 003244 6601 20 30 52    ~6      jsr copy2w
 003245 6604 4C 35 55    ~3      jmp div
 003246                      
 003247                      ;
 003248                      ;   power(x,y) = x^y = exp(y.loge(x)) = w1^w2
 003249 6607 A9 68       ~2  pow lda <w2
 003250 6609 85 F2       ~3      sta ptr1
 003251 660B A9 03       ~2      lda >w2
 003252 660D 85 F3       ~3      sta ptr1+1
 003253 660F A9 A0       ~2      lda <reg3
 003254 6611 85 F4       ~3      sta ptr2
 003255 6613 A9 03       ~2      lda >reg3
 003256 6615 85 F5       ~3      sta ptr2+1
 003257 6617 20 04 69    ~6      jsr copyreg
 003258 661A 20 96 5E    ~6      jsr loge
 003259 661D A9 70       ~2      lda <w3
 003260 661F A0 03       ~2      ldy >w3
 003261 6621 A2 60       ~2      ldx #w1
 003262 6623 20 30 52    ~6      jsr copy2w
 003263 6626 A9 A0       ~2      lda <reg3
 003264 6628 A0 03       ~2      ldy >reg3
 003265 662A A2 68       ~2      ldx #w2
 003266 662C 20 30 52    ~6      jsr copy2w
 003267 662F 20 78 53    ~6      jsr mul
 003268 6632 A9 70       ~2      lda <w3
 003269 6634 A0 03       ~2      ldy >w3
 003270 6636 A2 60       ~2      ldx #w1
 003271 6638 20 30 52    ~6      jsr copy2w
 003272 663B 4C 35 61    ~3      jmp exp
 003273                      
 003274                      
 003275                      ;
 003276                      ;   inv -- reciprocal of x = 1/x
 003277                      ;
 003278                      ;   w3 = 1/w1
 003279                      ;

                              page 62

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 003280 663E A9 60       ~2  inv lda <w1
 003281 6640 A0 03       ~2      ldy >w1
 003282 6642 A2 68       ~2      ldx #w2
 003283 6644 20 30 52    ~6      jsr copy2w
 003284 6647 A9 A0       ~2      lda <unit
 003285 6649 A0 6D       ~2      ldy >unit
 003286 664B A2 60       ~2      ldx #w1
 003287 664D 20 30 52    ~6      jsr copy2w
 003288 6650 20 35 55    ~6      jsr div
 003289 6653 60          ~6      rts
 003290                      ;
 003291                      ;   abs -- w3 = abs(w1)
 003292                      ;
 003293 6654 A9 60       ~2  abs lda <w1
 003294 6656 A0 03       ~2      ldy >w1
 003295 6658 A2 70       ~2      ldx #w3
 003296 665A 20 30 52    ~6      jsr copy2w
 003297 665D AD 70 03    ~4      lda w3
 003298 6660 29 7F       ~2      and #$7f
 003299 6662 8D 70 03    ~4      sta w3
 003300 6665 60          ~6      rts
 003301                      ;
 003302                      ;   chs -- w3 = -w1
 003303                      ;
 003304 6666 A9 60       ~2  chs lda <w1
 003305 6668 A0 03       ~2      ldy >w1
 003306 666A A2 70       ~2      ldx #w3
 003307 666C 20 30 52    ~6      jsr copy2w
 003308 666F AD 70 03    ~4      lda w3
 003309 6672 49 80       ~2      eor #$80
 003310 6674 8D 70 03    ~4      sta w3
 003311 6677 60          ~6      rts
 003312                      
 003313 6678 A0 07       ~2  upang ldy #7
 003314 667A 18          ~2      clc
 003315 667B B9 02 03    ~4  @   lda ra+2,y
 003316 667E 71 F2       ~5      adc (ptr1),y
 003317 6680 99 02 03    ~5      sta ra+2,y
 003318 6683 88          ~2      dey
 003319 6684 10 F5       ~2-     bpl @B
 003320 6686 60          ~6      rts
 003321                      ;
 003322                      ;   shift 'rc' and 'rd' right 'n' digits. Enter w
 003323                      ;
 003324 6687 85 C4       ~3  scdnrt sta ctr2
 003325 6689 29 01       ~2      and #1      ; is it an odd number?
 003326 668B F0 2C       ~2-     beq scd0    ; no, only do byte shifts
 003327 668D A9 00       ~2      lda #0      ; yes, do single digit shift
 003328 668F A2 07       ~2      ldx #7
 003329 6691 BC 22 03    ~4, @   ldy rc+2,x
 003330 6694 19 54 69    ~4,     ora tlh,y
 003331 6697 9D 23 03    ~5      sta rc+3,x
 003332 669A B9 F4 69    ~4      lda thl,y

                              page 63

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 003333 669D CA          ~2      dex
 003334 669E 10 F1       ~2-     bpl @B
 003335 66A0 8D 22 03    ~4      sta rc+2
 003336 66A3 A9 00       ~2      lda #0
 003337 66A5 A2 07       ~2      ldx #7
 003338 66A7 BC 32 03    ~4, @   ldy rd+2,x
 003339 66AA 19 54 69    ~4,     ora tlh,y
 003340 66AD 9D 33 03    ~5      sta rd+3,x
 003341 66B0 B9 F4 69    ~4      lda thl,y
 003342 66B3 CA          ~2      dex
 003343 66B4 10 F1       ~2-     bpl @B
 003344 66B6 8D 32 03    ~4      sta rd+2
 003345 66B9 A5 C4       ~3  scd0 lda ctr2
 003346 66BB 4A          ~2      lsr         ; convert to bytes
 003347 66BC F0 23       ~2-     beq scdx    ; exit if no further shift requir
 003348 66BE D8          ~2      cld
 003349 66BF 18          ~2      clc
 003350 66C0 69 07       ~2      adc #7
 003351 66C2 F8          ~2      sed
 003352 66C3 A8          ~2      tay
 003353 66C4 A2 07       ~2      ldx #7
 003354 66C6 BD 22 03    ~4, @   lda rc+2,x
 003355 66C9 99 22 03    ~5      sta rc+2,y
 003356 66CC BD 32 03    ~4,     lda rd+2,x
 003357 66CF 99 32 03    ~5      sta rd+2,y
 003358 66D2 88          ~2      dey
 003359 66D3 CA          ~2      dex
 003360 66D4 10 F0       ~2-     bpl @B
 003361 66D6 A9 00       ~2      lda #0
 003362 66D8 99 22 03    ~5  @   sta rc+2,y
 003363 66DB 99 32 03    ~5      sta rd+2,y
 003364 66DE 88          ~2      dey
 003365 66DF 10 F7       ~2-     bpl @B
 003366 66E1 60          ~6  scdx rts
 003367                      ;
 003368                      ;   int -- returns the integer part of a floating
 003369                      ;
 003370                      ;   enter with F.P. number in w1, return with res
 003371                      ;
 003372 66E2 A9 0F       ~2  int lda #$0f
 003373 66E4 2C 60 03    ~4      bit w1      ; test for sign of exponent and h
 003374 66E7 70 2E       ~2=     bvs int0    ; negative exponent means integer
 003375 66E9 D0 36       ~2=     bne int1    ; large, positive exponent means 
 003376 66EB 20 21 67    ~6      jsr int1    ; copy to result register (w3)
 003377 66EE AE 61 03    ~4      ldx w1+1
 003378 66F1 E0 12       ~2      cpx #$12
 003379 66F3 B0 21       ~2=     bcs intx
 003380 66F5 D8          ~2      cld
 003381 66F6 A9 0B       ~2      lda #$b
 003382 66F8 38          ~2      sec
 003383 66F9 FD 94 6A    ~4'     sbc dec2bin,x   ; number of zeros after decim
 003384 66FC F8          ~2      sed
 003385 66FD 4A          ~2      lsr

                              page 64

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 003386 66FE F0 0C       ~2-     beq inta
 003387 6700 AA          ~2      tax
 003388 6701 A0 05       ~2      ldy #5
 003389 6703 A9 00       ~2      lda #0
 003390 6705 99 72 03    ~5  @   sta w3+2,y
 003391 6708 88          ~2      dey
 003392 6709 CA          ~2      dex
 003393 670A D0 F9       ~2-     bne @B
 003394 670C 90 08       ~2- inta bcc intx
 003395 670E A9 F0       ~2      lda #$f0
 003396 6710 39 72 03    ~4,     and w3+2,y
 003397 6713 99 72 03    ~5      sta w3+2,y
 003398 6716 =(26390)        intx
 003399 6716 60          ~6      rts
 003400 6717 A9 28       ~2  int0 lda <zero
 003401 6719 A0 6D       ~2      ldy >zero    
 003402 671B A2 70       ~2      ldx #w3
 003403 671D 20 30 52    ~6      jsr copy2w
 003404 6720 60          ~6      rts
 003405 6721 A9 60       ~2  int1 lda <w1
 003406 6723 A0 03       ~2      ldy >w1
 003407 6725 A2 70       ~2      ldx #w3
 003408 6727 20 30 52    ~6      jsr copy2w
 003409 672A 60          ~6      rts
 003410                      ;
 003411                      ;   frac -- returns with fractional part of float
 003412                      ;
 003413 672B A2 07       ~2  frac ldx #7
 003414 672D BD 60 03    ~4, @   lda w1,x    ; save 'x' in reg3
 003415 6730 9D A0 03    ~5      sta reg3,x
 003416 6733 CA          ~2      dex
 003417 6734 10 F7       ~2-     bpl @B
 003418 6736 20 E2 66    ~6      jsr int     ; find integer part of argument i
 003419 6739 A9 70       ~2      lda <w3     ; move integer part to w2
 003420 673B A0 03       ~2      ldy >w3
 003421 673D A2 68       ~2      ldx #w2
 003422 673F 20 30 52    ~6      jsr copy2w
 003423 6742 A9 A0       ~2      lda <reg3
 003424 6744 A0 03       ~2      ldy >reg3
 003425 6746 A2 60       ~2      ldx #w1
 003426 6748 20 30 52    ~6      jsr copy2w
 003427 674B 20 AE 50    ~6      jsr sub     ; subtract integer part from argu
 003428 674E AD 72 03    ~4      lda w3+2
 003429 6751 D0 03       ~2-     bne @F
 003430 6753 8D 70 03    ~4      sta w3
 003431 6756 60          ~6  @   rts
 003432                      
 003433 6757 =(26455)        tanscale            ; scale argument to range: 0 
 003434 6757 A9 60       ~2      lda <twopi
 003435 6759 85 F2       ~3      sta ptr1
 003436 675B A9 6D       ~2      lda >twopi
 003437 675D 85 F3       ~3      sta ptr1+1
 003438 675F A9 80       ~2      lda <scalereg   ; put 2pi in scale register

                              page 65

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 003439 6761 85 F4       ~3      sta ptr2
 003440 6763 A9 03       ~2      lda >scalereg
 003441 6765 85 F5       ~3      sta ptr2+1
 003442 6767 20 04 69    ~6      jsr copyreg
 003443 676A 20 52 68    ~6      jsr scale       ; get   2pi*frac(arg/2pi), -2
 003444 676D AD 70 03    ~4      lda w3          ; if arg < 0 add 2pi
 003445 6770 10 15       ~2-     bpl @F
 003446 6772 A9 70       ~2      lda <w3
 003447 6774 A0 03       ~2      ldy >w3
 003448 6776 A2 60       ~2      ldx #w1
 003449 6778 20 30 52    ~6      jsr copy2w
 003450 677B A9 60       ~2      lda <twopi
 003451 677D A0 6D       ~2      ldy >twopi
 003452 677F A2 68       ~2      ldx #w2
 003453 6781 20 30 52    ~6      jsr copy2w
 003454 6784 20 B6 50    ~6      jsr add
 003455                      @                   ; now find and save quadrant
 003456 6787 A9 90       ~2      lda <tpio2
 003457 6789 85 F2       ~3      sta ptr1
 003458 678B A9 6D       ~2      lda >tpio2      ;   ptr1        ptr2        n
 003459 678D 85 F3       ~3      sta ptr1+1      ;          =                x
 003460 678F A9 70       ~2      lda <w3         ;          >                0
 003461 6791 85 F4       ~3      sta ptr2        ;          <                1
 003462 6793 A9 03       ~2      lda >w3
 003463 6795 85 F5       ~3      sta ptr2+1
 003464 6797 20 80 68    ~6      jsr cmpreg      ; 3pi/2 | w3
 003465 679A 10 07       ~2-     bpl @F
 003466 679C A9 04       ~2      lda #4          ; w3 > 3pi/2
 003467 679E 85 C9       ~3      sta qdrnt
 003468 67A0 4C CF 67    ~3      jmp tsc1
 003469 67A3 A9 58       ~2  @   lda <pi
 003470 67A5 85 F2       ~3      sta ptr1
 003471 67A7 A9 6D       ~2      lda >pi
 003472 67A9 85 F3       ~3      sta ptr1+1
 003473 67AB 20 80 68    ~6      jsr cmpreg     ; pi | w3
 003474 67AE 10 07       ~2-     bpl @F
 003475 67B0 A9 03       ~2      lda #3         ; w3 > pi
 003476 67B2 85 C9       ~3      sta qdrnt
 003477 67B4 4C CF 67    ~3      jmp tsc1
 003478 67B7 A9 80       ~2  @   lda <pio2
 003479 67B9 85 F2       ~3      sta ptr1
 003480 67BB A9 6D       ~2      lda >pio2
 003481 67BD 85 F3       ~3      sta ptr1+1
 003482 67BF 20 80 68    ~6      jsr cmpreg     ; pi/2 | w3
 003483 67C2 10 07       ~2-     bpl @F
 003484 67C4 A9 02       ~2      lda #2         ; w3 > pi/2
 003485 67C6 85 C9       ~3      sta qdrnt
 003486 67C8 4C CF 67    ~3      jmp tsc1
 003487 67CB A9 01       ~2  @   lda #1
 003488 67CD 85 C9       ~3      sta qdrnt
 003489 67CF A5 C9       ~3  tsc1 lda qdrnt
 003490 67D1 8D 00 03    ~4      sta ra
 003491 67D4 C9 03       ~2      cmp #3

                              page 66

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 003492 67D6 90 15       ~2-     bcc @F
 003493 67D8 A9 70       ~2      lda <w3         ; map quadrants III and IV to
 003494 67DA A0 03       ~2      ldy >w3
 003495 67DC A2 60       ~2      ldx #w1
 003496 67DE 20 30 52    ~6      jsr copy2w
 003497 67E1 A9 58       ~2      lda <pi
 003498 67E3 A0 6D       ~2      ldy >pi
 003499 67E5 A2 68       ~2      ldx #w2
 003500 67E7 20 30 52    ~6      jsr copy2w
 003501 67EA 20 AE 50    ~6      jsr sub
 003502 67ED A5 C9       ~3  @   lda qdrnt
 003503 67EF 29 01       ~2      and #1
 003504 67F1 D0 04       ~2-     bne @F
 003505 67F3 A9 80       ~2      lda #$80
 003506 67F5 85 C8       ~3      sta tnsgn
 003507 67F7 A9 80       ~2  @   lda <pio2
 003508 67F9 85 F2       ~3      sta ptr1
 003509 67FB A9 6D       ~2      lda >pio2
 003510 67FD 85 F3       ~3      sta ptr1+1
 003511 67FF 20 80 68    ~6      jsr cmpreg      ; pi/2 | w3
 003512 6802 10 15       ~2-     bpl @F
 003513 6804 A9 70       ~2      lda <w3         ; w3 > pi/2
 003514 6806 A0 03       ~2      ldy >w3
 003515 6808 A2 60       ~2      ldx #w1
 003516 680A 20 30 52    ~6      jsr copy2w
 003517 680D A9 58       ~2      lda <pi
 003518 680F A0 6D       ~2      ldy >pi
 003519 6811 A2 68       ~2      ldx #w2
 003520 6813 20 30 52    ~6      jsr copy2w
 003521 6816 20 AE 50    ~6      jsr sub
 003522 6819 AD 70 03    ~4  @   lda w3          ; range is: -pi/2 < arg < pi/
 003523 681C 29 7F       ~2      and #$7f        ; take abs value, tnsgn is al
 003524 681E 8D 70 03    ~4      sta w3
 003525 6821 A9 70       ~2      lda <w3         ; now range is:     0 <= arg 
 003526 6823 85 F4       ~3      sta ptr2        ; reduce range to:  0 <= arg 
 003527 6825 A9 03       ~2      lda >w3
 003528 6827 85 F5       ~3      sta ptr2+1
 003529 6829 A9 98       ~2      lda <pio4
 003530 682B 85 F2       ~3      sta ptr1
 003531 682D A9 6D       ~2      lda >pio4
 003532 682F 85 F3       ~3      sta ptr1+1
 003533 6831 20 80 68    ~6      jsr cmpreg      ; pi/4 | w3
 003534 6834 10 1B       ~2-     bpl @F          ; if upper part of range, pi/
 003535 6836 A9 80       ~2      lda <pio2       ;  mapped to lower part, 0 < 
 003536 6838 A0 6D       ~2      ldy >pio2       ;  cotangent flag (cotflg).
 003537 683A A2 60       ~2      ldx #w1
 003538 683C 20 30 52    ~6      jsr copy2w
 003539 683F A9 70       ~2      lda <w3
 003540 6841 A0 03       ~2      ldy >w3
 003541 6843 A2 68       ~2      ldx #w2
 003542 6845 20 30 52    ~6      jsr copy2w
 003543 6848 20 AE 50    ~6      jsr sub
 003544 684B A5 CA       ~3      lda cotflg

                              page 67

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 003545 684D 49 01       ~2      eor #1
 003546 684F 85 CA       ~3      sta cotflg
 003547 6851 60          ~6  @   rts             ; all scaling is complete.
 003548 6852 =(26706)        scale
 003549 6852 A9 80       ~2      lda <scalereg
 003550 6854 A0 03       ~2      ldy >scalereg
 003551 6856 A2 68       ~2      ldx #w2
 003552 6858 20 30 52    ~6      jsr copy2w  ; copy scale to w2
 003553 685B 20 35 55    ~6      jsr div     ; perform division
 003554 685E A9 70       ~2      lda <w3
 003555 6860 A0 03       ~2      ldy >w3
 003556 6862 A2 60       ~2      ldx #w1
 003557 6864 20 30 52    ~6      jsr copy2w  ; move result to w1
 003558 6867 20 2B 67    ~6      jsr frac    ; take fractional portion of resu
 003559 686A A9 70       ~2      lda <w3
 003560 686C A0 03       ~2      ldy >w3
 003561 686E A2 60       ~2      ldx #w1
 003562 6870 20 30 52    ~6      jsr copy2w
 003563 6873 A9 80       ~2      lda <scalereg
 003564 6875 A0 03       ~2      ldy >scalereg
 003565 6877 A2 68       ~2      ldx #w2
 003566 6879 20 30 52    ~6      jsr copy2w  ; copy scale to w2
 003567 687C 20 78 53    ~6      jsr mul     ; result is arg mod scale
 003568 687F 60          ~6      rts
 003569                      ;
 003570                      ; compare registers pointed to by ptr1 and ptr2.
 003571                      ; returns the following:
 003572                      ;                                       n z
 003573                      ;   zflag = 1 if numbers are the same   x 1
 003574                      ;   nflag = 0 if ptr1 > ptr2            0 0
 003575                      ;   nflag = 1 if ptr1 < ptr2            1 0
 003576                      ;
 003577 6880 =(26752)        cmpreg
 003578 6880 F8          ~2      sed
 003579 6881 A0 00       ~2      ldy #0
 003580 6883 B1 F2       ~5      lda (ptr1),y
 003581 6885 51 F4       ~5      eor (ptr2),y
 003582 6887 10 05       ~2-     bpl @F
 003583                      ;
 003584                      ;   mantissa signs differ, positive number is lar
 003585                      ;
 003586 6889 B1 F2       ~5      lda (ptr1),y    ; set nflag using ptr1
 003587 688B 09 01       ~3      ora #1          ; make sure zflag = 0
 003588 688D 60          ~6      rts
 003589                      ;
 003590                      ;   mantissa signs are the same, check exponent s
 003591                      ;
 003592 688E 0A          ~2  @   asl             ; shift exponent sign into si
 003593 688F 10 20       ~2-     bpl @F
 003594                      ;
 003595                      ;   exponent signs differ, larger number has:
 003596                      ;       mantissa sign positive, exponent sign pos
 003597                      ;       mantissa sign negative, exponent sign neg

                              page 68

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 003598                      ;
 003599 6891 B1 F2       ~5      lda (ptr1),y
 003600 6893 30 16       ~2-     bmi negm
 003601 6895 A0 02       ~2      ldy #2
 003602 6897 B1 F2       ~5      lda (ptr1),y
 003603 6899 D0 03       ~2-     bne nz1
 003604 689B A9 80       ~2      lda #$80        ; ptr1 = 0 and ptr1 = frac
 003605 689D 60          ~6      rts
 003606 689E B1 F4       ~5  nz1 lda (ptr2),y
 003607 68A0 D0 01       ~2-     bne nz2         
 003608 68A2 60          ~6      rts             ; ptr2 = 0 and ptr1 = frac
 003609 68A3 =(26787)        nz2
 003610 68A3 A0 00       ~2      ldy #0
 003611 68A5 B1 F2       ~5      lda (ptr1),y
 003612 68A7 0A          ~2      asl
 003613 68A8 09 01       ~3      ora #$1
 003614 68AA 60          ~6      rts
 003615 68AB =(26795)        negm
 003616 68AB B1 F4       ~5      lda (ptr2),y
 003617 68AD 0A          ~2      asl
 003618 68AE 09 01       ~3      ora #$1
 003619 68B0 60          ~6      rts
 003620                      ;
 003621                      ;   mantissa exponent signs are the same, check e
 003622                      ;
 003623 68B1 B1 F2       ~5  @   lda (ptr1),y
 003624 68B3 51 F4       ~5      eor (ptr2),y
 003625 68B5 D0 23       ~2-     bne @F
 003626                      ;
 003627                      ;   first exponent digit matches, check next two
 003628                      ;
 003629 68B7 C8          ~2      iny
 003630 68B8 B1 F2       ~5      lda (ptr1),y
 003631 68BA 51 F4       ~5      eor (ptr2),y
 003632 68BC D0 1C       ~2-     bne @F
 003633                      ;
 003634                      ;   all signs and exponents match, compare mantis
 003635                      ;
 003636 68BE A0 07       ~2      ldy #7
 003637 68C0 A2 05       ~2      ldx #5
 003638 68C2 A9 00       ~2      lda #0
 003639 68C4 85 C0       ~3      sta tmp1
 003640 68C6 38          ~2      sec
 003641 68C7 B1 F4       ~5  mantst lda (ptr2),y
 003642 68C9 F1 F2       ~5      sbc (ptr1),y
 003643 68CB F0 02       ~2-     beq zr
 003644 68CD E6 C0       ~5      inc tmp1
 003645 68CF =(26831)        zr
 003646 68CF 88          ~2      dey
 003647 68D0 CA          ~2      dex
 003648 68D1 10 F4       ~2-     bpl mantst
 003649 68D3 90 20       ~2-     bcc p1max
 003650 68D5 A5 C0       ~3      lda tmp1

                              page 69

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 003651 68D7 D0 19       ~2-     bne p2max
 003652 68D9 60          ~6      rts
 003653                      ;
 003654                      ;   all signs match, but exponents differ
 003655                      ;
 003656                      ;   largest number
 003657                      ;       msgn+, esgn+, exponent largest   80.0 >  
 003658                      ;       msgn+, esgn-, exponent smallest  0.33 >  
 003659                      ;       msgn-, esgn+, exponent smallest -1.23 > -
 003660                      ;       msgn-, esgn-, exponent largest  -0.02 > -
 003661                      ;
 003662 68DA A0 01       ~2  @   ldy #1
 003663 68DC 38          ~2      sec
 003664 68DD B1 F4       ~5      lda (ptr2),y
 003665 68DF F1 F2       ~5      sbc (ptr1),y
 003666 68E1 88          ~2      dey
 003667 68E2 B1 F4       ~5      lda (ptr2),y
 003668 68E4 F1 F2       ~5      sbc (ptr1),y
 003669 68E6 B0 10       ~2-     bcs e2max
 003670                      ;   ptr1 has largest exponent, all signs are the 
 003671 68E8 B1 F2       ~5      lda (ptr1),y
 003672 68EA 29 C0       ~2      and #$c0
 003673 68EC F0 07       ~2-     beq p1max
 003674 68EE C9 C0       ~2      cmp #$c0
 003675 68F0 F0 03       ~2-     beq p1max
 003676 68F2 A9 81       ~2  p2max lda #$81
 003677 68F4 60          ~6      rts
 003678 68F5 A9 01       ~2  p1max lda #1
 003679 68F7 60          ~6      rts
 003680                      ;   ptr2 has largest exponent, all signs are the 
 003681 68F8 =(26872)        e2max 
 003682 68F8 B1 F4       ~5      lda (ptr2),y
 003683 68FA 29 C0       ~2      and #$c0
 003684 68FC F0 F4       ~2-     beq p2max
 003685 68FE C9 C0       ~2      cmp #$c0
 003686 6900 F0 F0       ~2=     beq p2max
 003687 6902 D0 F1       ~2=     bne p1max
 003688                      
 003689 6904 A0 07       ~2  copyreg ldy #7
 003690 6906 B1 F2       ~5  @   lda (ptr1),y
 003691 6908 91 F4       ~6      sta (ptr2),y
 003692 690A 88          ~2      dey
 003693 690B 10 F9       ~2-     bpl @B
 003694 690D 60          ~6      rts
 003695 690E A2 5F       ~2  clr_r ldx #$5f  ; clear all 'rn' regs
 003696 6910 A9 00       ~2      lda #0
 003697 6912 9D 00 03    ~5  @   sta ra,x
 003698 6915 CA          ~2      dex
 003699 6916 10 FA       ~2-     bpl @B
 003700 6918 60          ~6      rts
 003701                      ;
 003702                      ;   return with zero
 003703                      ;

                              page 70

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 003704                      ;   utility routine to place zero in w3 and retur
 003705                      ;
 003706 6919 =(26905)        retzr
 003707 6919 A9 28       ~2      lda <zero
 003708 691B A0 6D       ~2      ldy >zero
 003709 691D A2 70       ~2      ldx #w3
 003710 691F 20 30 52    ~6      jsr copy2w
 003711 6922 60          ~6      rts
 003712                      ;
 003713                      ;   domain error handler
 003714                      ;
 003715                      ;   returns domain error string with error flags 
 003716                      ;
 003717                      ;       $30,2,0,0,0,0,0,0
 003718                      ;
 003719 6923 =(26915)        domnerr
 003720 6923 A9 D0       ~2      lda <dmnerr
 003721 6925 A0 6D       ~2      ldy >dmnerr
 003722 6927 A2 70       ~2      ldx #w3
 003723 6929 20 30 52    ~6      jsr copy2w
 003724 692C 4C 53 69    ~3      jmp errhndlr
 003725                      ;
 003726                      ;   range error handler
 003727                      ;
 003728                      ;   returns range error string with error flags s
 003729                      ;
 003730                      ;       $30,1,0,0,0,0,0,0
 003731                      ;
 003732 692F =(26927)        rangerr
 003733 692F A9 C8       ~2      lda <rngerr
 003734 6931 A0 6D       ~2      ldy >rngerr
 003735 6933 A2 70       ~2      ldx #w3
 003736 6935 20 30 52    ~6      jsr copy2w
 003737 6938 4C 53 69    ~3      jmp errhndlr
 003738                      ;
 003739                      ;   overflow error handler
 003740                      ;
 003741                      ;   returns overflow error string with error flag
 003742                      ;
 003743                      ;       $29,$99,$99,$99,$99,$99,$99,$99
 003744                      ;
 003745 693B =(26939)        ovrferr
 003746 693B A9 C0       ~2      lda <ovferr
 003747 693D A0 6D       ~2      ldy >ovferr
 003748 693F A2 70       ~2      ldx #w3
 003749 6941 20 30 52    ~6      jsr copy2w
 003750 6944 4C 53 69    ~3      jmp errhndlr
 003751                      ;
 003752                      ;   divide-by-zero error handler
 003753                      ;
 003754                      ;   returns divide-by-zero error string with erro
 003755                      ;
 003756                      ;       $30,3,0,0,0,0,0,0

                              page 71

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 003757                      ;
 003758 6947 =(26951)        dvzrerr
 003759 6947 A9 D8       ~2      lda <dvzerr
 003760 6949 A0 6D       ~2      ldy >dvzerr
 003761 694B A2 70       ~2      ldx #w3
 003762 694D 20 30 52    ~6      jsr copy2w
 003763 6950 4C 53 69    ~3      jmp errhndlr
 003764                      ;
 003765                      ;   general error handler
 003766                      ;
 003767                      ;   returns error string in w3 and executes 'brk'
 003768                      ;
 003769 6953 00          ~7  errhndlr brk
 003770                      
 003771                      ;    .org $4000
 003772                      ;
 003773                      ;   The following two tables are used in shifting
 003774                      ;   one BCD digit to the right or left. 
 003775                      ;
 003776                      ;
 003777                      ;   'tlh' maps the lower decimal digit of its BCD
 003778                      ;   the high digit.
 003779                      ;
 003780                      ;   Example:
 003781                      ;
 003782                      ;           ldy #$35
 003783                      ;           lda tlh,y
 003784                      ;
 003785                      ;   Now the 'a' register contains #$50; i.e. the 
 003786                      ;   is shifted into the high digit position and t
 003787                      ;   digit position is cleared.
 003788                      ;
 003789                      ;   This table, and the one following, support hi
 003790                      ;   shifting of multibyte BCD registers.
 003791                      ;
 003792 6954 00 10 20 30     tlh .byte 0,$10,$20,$30,$40,$50,$60,$70,$80,$90,0
        6958 40 50 60 70 
        695C 80 90 00 00 
        6960 00 00 00 00 
 003793 6964 00 10 20 30         .byte 0,$10,$20,$30,$40,$50,$60,$70,$80,$90,0
        6968 40 50 60 70 
        696C 80 90 00 00 
        6970 00 00 00 00 
 003794 6974 00 10 20 30         .byte 0,$10,$20,$30,$40,$50,$60,$70,$80,$90,0
        6978 40 50 60 70 
        697C 80 90 00 00 
        6980 00 00 00 00 
 003795 6984 00 10 20 30         .byte 0,$10,$20,$30,$40,$50,$60,$70,$80,$90,0
        6988 40 50 60 70 
        698C 80 90 00 00 
        6990 00 00 00 00 
 003796 6994 00 10 20 30         .byte 0,$10,$20,$30,$40,$50,$60,$70,$80,$90,0
        6998 40 50 60 70 
                              page 72

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014



        699C 80 90 00 00 
        69A0 00 00 00 00 
 003797 69A4 00 10 20 30         .byte 0,$10,$20,$30,$40,$50,$60,$70,$80,$90,0
        69A8 40 50 60 70 
        69AC 80 90 00 00 
        69B0 00 00 00 00 
 003798 69B4 00 10 20 30         .byte 0,$10,$20,$30,$40,$50,$60,$70,$80,$90,0
        69B8 40 50 60 70 
        69BC 80 90 00 00 
        69C0 00 00 00 00 
 003799 69C4 00 10 20 30         .byte 0,$10,$20,$30,$40,$50,$60,$70,$80,$90,0
        69C8 40 50 60 70 
        69CC 80 90 00 00 
        69D0 00 00 00 00 
 003800 69D4 00 10 20 30         .byte 0,$10,$20,$30,$40,$50,$60,$70,$80,$90,0
        69D8 40 50 60 70 
        69DC 80 90 00 00 
        69E0 00 00 00 00 
 003801 69E4 00 10 20 30         .byte 0,$10,$20,$30,$40,$50,$60,$70,$80,$90,0
        69E8 40 50 60 70 
        69EC 80 90 00 00 
        69F0 00 00 00 00 
 003802                      ;
 003803                      ;   'thl' maps the upper digit of its BCD index i
 003804                      ;   low digit.
 003805                      ;
 003806                      ;   Example:
 003807                      ;
 003808                      ;           ldy #$35
 003809                      ;           lda thl,y
 003810                      ;
 003811                      ;   Now the 'a' register contains #$03; i.e. the 
 003812                      ;   is shifted to the low digit position and the 
 003813                      ;   position is cleared.
 003814                      ;
 003815 69F4 00 00 00 00     thl .byte 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        69F8 00 00 00 00 
        69FC 00 00 00 00 
        6A00 00 00 00 00 
 003816 6A04 01 01 01 01         .byte 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
        6A08 01 01 01 01 
        6A0C 01 01 01 01 
        6A10 01 01 01 01 
 003817 6A14 02 02 02 02         .byte 2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2
        6A18 02 02 02 02 
        6A1C 02 02 02 02 
        6A20 02 02 02 02 
 003818 6A24 03 03 03 03         .byte 3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3
        6A28 03 03 03 03 
        6A2C 03 03 03 03 
        6A30 03 03 03 03 
 003819 6A34 04 04 04 04         .byte 4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4
        6A38 04 04 04 04 
                              page 73

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014



        6A3C 04 04 04 04 
        6A40 04 04 04 04 
 003820 6A44 05 05 05 05         .byte 5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5
        6A48 05 05 05 05 
        6A4C 05 05 05 05 
        6A50 05 05 05 05 
 003821 6A54 06 06 06 06         .byte 6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6
        6A58 06 06 06 06 
        6A5C 06 06 06 06 
        6A60 06 06 06 06 
 003822 6A64 07 07 07 07         .byte 7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7
        6A68 07 07 07 07 
        6A6C 07 07 07 07 
        6A70 07 07 07 07 
 003823 6A74 08 08 08 08         .byte 8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8
        6A78 08 08 08 08 
        6A7C 08 08 08 08 
        6A80 08 08 08 08 
 003824 6A84 09 09 09 09         .byte 9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9
        6A88 09 09 09 09 
        6A8C 09 09 09 09 
        6A90 09 09 09 09 
 003825                      ;
 003826                      ;   'dec2bin' maps a BCD value into its equivalen
 003827                      ;
 003828                      ;   Example:
 003829                      ;
 003830                      ;           ldy #$35            ; '35' decimal
 003831                      ;           lda dec2bin,y
 003832                      ;
 003833                      ;   The 'a' register now contains 23h = 0010 0011
 003834                      ;
 003835 6A94 =(27284)        dec2bin
 003836 6A94 00 01 02 03         .byte 0,1,2,3,4,5,6,7,8,9,0,0,0,0,0,0
        6A98 04 05 06 07 
        6A9C 08 09 00 00 
        6AA0 00 00 00 00 
 003837 6AA4 0A 0B 0C 0D         .byte $0a,$0b,$0c,$0d,$0e,$0f,$10,$11,$12,$13
        6AA8 0E 0F 10 11 
        6AAC 12 13 00 00 
        6AB0 00 00 00 00 
 003838 6AB4 14 15 16 17         .byte $14,$15,$16,$17,$18,$19,$1a,$1b,$1c,$1d
        6AB8 18 19 1A 1B 
        6ABC 1C 1D 00 00 
        6AC0 00 00 00 00 
 003839 6AC4 1E 1F 20 21         .byte $1e,$1f,$20,$21,$22,$23,$24,$25,$26,$27
        6AC8 22 23 24 25 
        6ACC 26 27 00 00 
        6AD0 00 00 00 00 
 003840 6AD4 28 29 2A 2B         .byte $28,$29,$2a,$2b,$2c,$2d,$2e,$2f,$30,$31
        6AD8 2C 2D 2E 2F 
        6ADC 30 31 00 00 
        6AE0 00 00 00 00 

                              page 74

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 003841 6AE4 32 33 34 35         .byte $32,$33,$34,$35,$36,$37,$38,$39,$3a,$3b
        6AE8 36 37 38 39 
        6AEC 3A 3B 00 00 
        6AF0 00 00 00 00 
 003842 6AF4 3C 3D 3E 3F         .byte $3c,$3d,$3e,$3f,$40,$41,$42,$43,$44,$45
        6AF8 40 41 42 43 
        6AFC 44 45 00 00 
        6B00 00 00 00 00 
 003843 6B04 46 47 48 49         .byte $46,$47,$48,$49,$4a,$4b,$4c,$4d,$4e,$4f
        6B08 4A 4B 4C 4D 
        6B0C 4E 4F 00 00 
        6B10 00 00 00 00 
 003844 6B14 50 51 52 53         .byte $50,$51,$52,$53,$54,$55,$56,$57,$58,$59
        6B18 54 55 56 57 
        6B1C 58 59 00 00 
        6B20 00 00 00 00 
 003845 6B24 5A 5B 5C 5D         .byte $5a,$5b,$5c,$5d,$5e,$5f,$60,$61,$62,$63
        6B28 5E 5F 60 61 
        6B2C 62 63 00 00 
        6B30 00 00 00 00 
 003846                      ;
 003847                      ;   'bin2dec' maps a binary value into its BCD eq
 003848                      ;
 003849                      ;   Example:
 003850                      ;
 003851                      ;           ldy #$2c            ; '2c' hex = 0010
 003852                      ;           lda bin2dec,y
 003853                      ;
 003854                      ;   The 'a' register now contains #$44.
 003855                      ;
 003856 6B34 =(27444)        bin2dec
 003857 6B34 00 01 02 03         .byte 0,1,2,3,4,5,6,7,8,9
        6B38 04 05 06 07 
        6B3C 08 09 
 003858 6B3E 10 11 12 13         .byte $10,$11,$12,$13,$14,$15,$16,$17,$18,$19
        6B42 14 15 16 17 
        6B46 18 19 
 003859 6B48 20 21 22 23         .byte $20,$21,$22,$23,$24,$25,$26,$27,$28,$29
        6B4C 24 25 26 27 
        6B50 28 29 
 003860 6B52 30 31 32 33         .byte $30,$31,$32,$33,$34,$35,$36,$37,$38,$39
        6B56 34 35 36 37 
        6B5A 38 39 
 003861 6B5C 40 41 42 43         .byte $40,$41,$42,$43,$44,$45,$46,$47,$48,$49
        6B60 44 45 46 47 
        6B64 48 49 
 003862 6B66 50 51 52 53         .byte $50,$51,$52,$53,$54,$55,$56,$57,$58,$59
        6B6A 54 55 56 57 
        6B6E 58 59 
 003863 6B70 60 61 62 63         .byte $60,$61,$62,$63,$64,$65,$66,$67,$68,$69
        6B74 64 65 66 67 
        6B78 68 69 
 003864 6B7A 70 71 72 73         .byte $70,$71,$72,$73,$74,$75,$76,$77,$78,$79

                              page 75

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


        6B7E 74 75 76 77 
        6B82 78 79 
 003865 6B84 80 81 82 83         .byte $80,$81,$82,$83,$84,$85,$86,$87,$88,$89
        6B88 84 85 86 87 
        6B8C 88 89 
 003866 6B8E 90 91 92 93         .byte $90,$91,$92,$93,$94,$95,$96,$97,$98,$99
        6B92 94 95 96 97 
        6B96 98 99 
 003867                      ;
 003868                      ;   srblt supports the division of BCD numbers by
 003869                      ;
 003870                      ;   To use, shift the BCD register right one bit 
 003871                      ;   then replace each byte with the value take fr
 003872                      ;   this lookup table using the existing byte as 
 003873                      ;   index.
 003874                      ;
 003875 6B98 =(27544)        srtbl   ; shift right table
 003876 6B98 00 01 02 03         .byte $00,$01,$02,$03,$04,$05,$06,$07,$05,$06
        6B9C 04 05 06 07 
        6BA0 05 06 07 08 
        6BA4 09 00 00 00 
 003877 6BA8 10 11 12 13         .byte  $10,$11,$12,$13,$14,$15,$16,$17,$15,$1
        6BAC 14 15 16 17 
        6BB0 15 16 17 18 
        6BB4 19 00 00 00 
 003878 6BB8 20 21 22 23         .byte  $20,$21,$22,$23,$24,$25,$26,$27,$25,$2
        6BBC 24 25 26 27 
        6BC0 25 26 27 28 
        6BC4 29 00 00 00 
 003879 6BC8 30 31 32 33         .byte  $30,$31,$32,$33,$34,$35,$36,$37,$35,$3
        6BCC 34 35 36 37 
        6BD0 35 36 37 38 
        6BD4 39 00 00 00 
 003880 6BD8 40 41 42 43         .byte  $40,$41,$42,$43,$44,$45,$46,$47,$45,$4
        6BDC 44 45 46 47 
        6BE0 45 46 47 49 
        6BE4 49 00 00 00 
 003881 6BE8 50 51 52 53         .byte  $50,$51,$52,$53,$54,$55,$56,$57,$55,$5
        6BEC 54 55 56 57 
        6BF0 55 56 57 58 
        6BF4 59 00 00 00 
 003882 6BF8 60 61 62 63         .byte  $60,$61,$62,$63,$64,$65,$66,$67,$65,$6
        6BFC 64 65 66 67 
        6C00 65 66 67 68 
        6C04 69 00 00 00 
 003883 6C08 70 71 72 73         .byte  $70,$71,$72,$73,$74,$75,$76,$77,$75,$7
        6C0C 74 75 76 77 
        6C10 75 76 77 78 
        6C14 79 00 00 00 
 003884 6C18 50 51 52 53         .byte  $50,$51,$52,$53,$54,$55,$56,$57,$55,$5
        6C1C 54 55 56 57 
        6C20 55 56 57 58 
        6C24 59 00 00 00 

                              page 76

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 003885 6C28 60 61 62 63         .byte  $60,$61,$62,$63,$64,$65,$66,$67,$65,$6
        6C2C 64 65 66 67 
        6C30 65 66 67 68 
        6C34 69 00 00 00 
 003886 6C38 70 71 72 73         .byte  $70,$71,$72,$73,$74,$75,$76,$77,$75,$7
        6C3C 74 75 76 77 
        6C40 75 76 77 78 
        6C44 79 00 00 00 
 003887 6C48 80 81 82 83         .byte  $80,$81,$82,$83,$84,$85,$86,$87,$85,$8
        6C4C 84 85 86 87 
        6C50 85 86 87 88 
        6C54 89 00 00 00 
 003888 6C58 90 91 92 93         .byte  $90,$91,$92,$93,$94,$95,$96,$97,$95,$9
        6C5C 94 95 96 97 
        6C60 95 96 97 98 
        6C64 99 00 00 00 
 003889 6C68 =(27752)        sltbl   ; shift left table
 003890 6C68 00 01 02 03         .byte $00,$01,$02,$03,$04,$08,$09,$0a,$0b,$0c
        6C6C 04 08 09 0A 
        6C70 0B 0C 00 00 
        6C74 00 00 00 00 
 003891 6C78 10 11 12 13         .byte  $10,$11,$12,$13,$14,$18,$19,$1a,$1b,$1
        6C7C 14 18 19 1A 
        6C80 1B 1C 00 00 
        6C84 00 00 00 00 
 003892 6C88 20 21 22 23         .byte  $20,$21,$22,$23,$24,$28,$29,$2a,$2b,$2
        6C8C 24 28 29 2A 
        6C90 2B 2C 00 00 
        6C94 00 00 00 00 
 003893 6C98 30 31 32 33         .byte  $30,$31,$32,$33,$34,$38,$39,$3a,$3b,$3
        6C9C 34 38 39 3A 
        6CA0 3B 3C 00 00 
        6CA4 00 00 00 00 
 003894 6CA8 40 41 42 43         .byte  $40,$41,$42,$43,$44,$48,$49,$4a,$4b,$4
        6CAC 44 48 49 4A 
        6CB0 4B 4C 00 00 
        6CB4 00 00 00 00 
 003895 6CB8 80 81 82 83         .byte  $80,$81,$82,$83,$84,$88,$89,$8a,$8b,$8
        6CBC 84 88 89 8A 
        6CC0 8B 8C 00 00 
        6CC4 00 00 00 00 
 003896 6CC8 90 91 92 93         .byte  $90,$91,$92,$93,$94,$98,$99,$9a,$9b,$9
        6CCC 94 98 99 9A 
        6CD0 9B 9C 00 00 
        6CD4 00 00 00 00 
 003897 6CD8 A0 A1 A2 A3         .byte  $a0,$a1,$a2,$a3,$a4,$a8,$a9,$aa,$ab,$a
        6CDC A4 A8 A9 AA 
        6CE0 AB AC 00 00 
        6CE4 00 00 00 00 
 003898 6CE8 B0 B1 B2 B3         .byte  $b0,$b1,$b2,$b3,$b4,$b8,$b9,$ba,$bb,$b
        6CEC B4 B8 B9 BA 
        6CF0 BB BC 00 00 
        6CF4 00 00 00 00 

                              page 77

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 003899 6CF8 C0 C1 C2 C3         .byte  $c0,$c1,$c2,$c3,$c4,$c8,$c9,$ca,$cb,$c
        6CFC C4 C8 C9 CA 
        6D00 CB CC 00 00 
        6D04 00 00 00 00 
 003900 6D08 =(27912)        hex2asc
 003901 6D08 30 31 32 33         .byte '0','1','2','3','4','5','6','7','8','9'
        6D0C 34 35 36 37 
        6D10 38 39 41 42 
        6D14 43 44 45 46 
 003902 6D18 30 31 32 33         .str "0123456789ABCDEF"
        6D1C 34 35 36 37 
        6D20 38 39 41 42 
        6D24 43 44 45 46 
 003903                      ;
 003904                      ;   miscellaneous constants in floating
 003905                      ;   point format
 003906                      ;
 003907 6D28 00 00 00 00     zero   .byte $00,$00,$00,$00,$00,$00,$00,$00
        6D2C 00 00 00 00 
 003908 6D30 40 01 69 31     ln2    .byte $40,$01,$69,$31,$47,$18,$05,$60
        6D34 47 18 05 60 
 003909 6D38 00 00 23 02     ln10   .byte $00,$00,$23,$02,$58,$50,$92,$99
        6D3C 58 50 92 99 
 003910 6D40 40 01 43 42     iln10  .byte $40,$01,$43,$42,$94,$48,$19,$03
        6D44 94 48 19 03 
 003911 6D48 00 00 27 18     exp0   .byte $00,$00,$27,$18,$28,$18,$28,$46
        6D4C 28 18 28 46 
 003912 6D50 00 00 14 14     sqt2   .byte $00,$00,$14,$14,$21,$35,$62,$37
        6D54 21 35 62 37 
 003913 6D58 00 00 31 41     pi     .byte $00,$00,$31,$41,$59,$26,$53,$59
        6D5C 59 26 53 59 
 003914 6D60 00 00 62 83     twopi  .byte $00,$00,$62,$83,$18,$53,$07,$18
        6D64 18 53 07 18 
 003915 6D68 40 01 70 71     sqp5   .byte $40,$01,$70,$71,$06,$78,$11,$87
        6D6C 06 78 11 87 
 003916 6D70 40 01 31 83     invpi  .byte $40,$01,$31,$83,$09,$88,$61,$84
        6D74 09 88 61 84 
 003917 6D78 40 01 15 91     i2pi   .byte $40,$01,$15,$91,$54,$94,$30,$92
        6D7C 54 94 30 92 
 003918 6D80 00 00 15 70     pio2   .byte $00,$00,$15,$70,$79,$63,$26,$79
        6D84 79 63 26 79 
 003919 6D88 80 00 15 70     npio2  .byte $80,$00,$15,$70,$79,$63,$26,$79
        6D8C 79 63 26 79 
 003920 6D90 00 00 47 12     tpio2  .byte $00,$00,$47,$12,$38,$89,$80,$38
        6D94 38 89 80 38 
 003921 6D98 40 01 78 53     pio4   .byte $40,$01,$78,$53,$98,$16,$33,$98
        6D9C 98 16 33 98 
 003922 6DA0 00 00 10 00     unit   .byte $00,$00,$10,$00,$00,$00,$00,$00
        6DA4 00 00 00 00 
 003923 6DA8 40 01 50 00     half   .byte $40,$01,$50,$00,$00,$00,$00,$00
        6DAC 00 00 00 00 
 003924 6DB0 00 15 70 79     nrpi2  .byte $00,$15,$70,$79,$00,$00,$00,$00
        6DB4 00 00 00 00 

                              page 78

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 003925 6DB8 40 02 10 00     hnth   .byte $40,$02,$10,$00,$00,$00,$00,$00
        6DBC 00 00 00 00 
 003926 6DC0 29 99 99 99     ovferr .byte $29,$99,$99,$99,$99,$99,$99,$99
        6DC4 99 99 99 99 
 003927 6DC8 30 01 00 00     rngerr .byte $30,1,0,0,0,0,0,0
        6DCC 00 00 00 00 
 003928 6DD0 30 02 00 00     dmnerr .byte $30,2,0,0,0,0,0,0
        6DD4 00 00 00 00 
 003929 6DD8 30 03 00 00     dvzerr .byte $30,3,0,0,0,0,0,0
        6DDC 00 00 00 00 
 003930                      ;
 003931                      ;   Coefficient table for cosine by polynomial ev
 003932                      ;
 003933 6DE0 40 05 23 15     kcos  .byte  $40,$05,$23,$15,$39,$31,$67,$00
        6DE4 39 31 67 00 
 003934 6DE8 C0 03 13 85           .byte  $c0,$03,$13,$85,$37,$04,$26,$40
        6DEC 37 04 26 40 
 003935 6DF0 40 02 41 66           .byte  $40,$02,$41,$66,$35,$84,$67,$69
        6DF4 35 84 67 69 
 003936 6DF8 C0 01 49 99           .byte  $c0,$01,$49,$99,$99,$05,$34,$55
        6DFC 99 05 34 55 
 003937 6E00 40 01 99 99           .byte $40,$01,$99,$99,$99,$95,$34,$64
        6E04 99 95 34 64 
 003938                      ;
 003939                      ;   atn(1), atn(0.1), atn(0.01), atn(0.001), ...
 003940                      ;
 003941                      ;   This table is in floating point format
 003942                      ;
 003943 6E08 40 01 78 53     katn  .byte $40,$01,$78,$53,$98,$16,$33,$97
        6E0C 98 16 33 97 
 003944 6E10 40 02 99 66           .byte $40,$02,$99,$66,$86,$52,$49,$12
        6E14 86 52 49 12 
 003945 6E18 40 03 99 99           .byte $40,$03,$99,$99,$66,$66,$86,$67
        6E1C 66 66 86 67 
 003946 6E20 40 04 99 99           .byte $40,$04,$99,$99,$99,$66,$66,$67
        6E24 99 66 66 67 
 003947 6E28 40 05 99 99           .byte $40,$05,$99,$99,$99,$99,$66,$67
        6E2C 99 99 66 67 
 003948 6E30 40 06 99 99           .byte $40,$06,$99,$99,$99,$99,$99,$67
        6E34 99 99 99 67 
 003949 6E38 40 06 10 00           .byte $40,$06,$10,0,0,0,0,0
        6E3C 00 00 00 00 
 003950 6E40 40 07 10 00           .byte $40,$07,$10,0,0,0,0,0
        6E44 00 00 00 00 
 003951                      ;
 003952                      ;   atn(1), atn(0.1), atn(0.01), atn(0.001), ...
 003953                      ;
 003954                      ;   This table is in fixed point format
 003955                      ;
 003956 6E48 07 85 39 81     kxatn .byte $07,$85,$39,$81,$63,$39,$74,$48
        6E4C 63 39 74 48 
 003957 6E50 00 99 66 86           .byte $00,$99,$66,$86,$52,$49,$11,$62
        6E54 52 49 11 62 

                              page 79

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 003958 6E58 00 09 99 96           .byte $00,$09,$99,$96,$66,$68,$66,$65
        6E5C 66 68 66 65 
 003959 6E60 00 00 99 99           .byte $00,$00,$99,$99,$99,$66,$66,$67
        6E64 99 66 66 67 
 003960 6E68 00 00 09 99           .byte $00,$00,$09,$99,$99,$99,$96,$67
        6E6C 99 99 96 67 
 003961 6E70 00 00 01 00           .byte $00,$00,$01,$00,$00,$00,$00,$00
        6E74 00 00 00 00 
 003962 6E78 00 00 00 10           .byte $00,$00,$00,$10,$00,$00,$00,$00
        6E7C 00 00 00 00 
 003963 6E80 00 00 00 01           .byte $00,$00,$00,$01,$00,$00,$00,$00
        6E84 00 00 00 00 
 003964 6E88 00 00 00 00           .byte $00,$00,$00,$00,$10,$00,$00,$00
        6E8C 10 00 00 00 
 003965 6E90 00 00 00 00           .byte $00,$00,$00,$00,$01,$00,$00,$00
        6E94 01 00 00 00 
 003966 6E98 00 00 00 00           .byte $00,$00,$00,$00,$00,$10,$00,$00
        6E9C 00 10 00 00 
 003967 6EA0 00 00 00 00           .byte $00,$00,$00,$00,$00,$01,$00,$00
        6EA4 00 01 00 00 
 003968                      ;
 003969                      ;   ln(2), ln(1.1), ln(1.01),ln(1.001),...
 003970                      ;
 003971                      ;   This table is in floating point format
 003972                      ;
 003973 6EA8 40 01 69 31     klog  .byte $40,$01,$69,$31,$47,$18,$05,$60
        6EAC 47 18 05 60 
 003974 6EB0 40 02 95 31           .byte $40,$02,$95,$31,$01,$79,$80,$43
        6EB4 01 79 80 43 
 003975 6EB8 40 03 99 50           .byte $40,$03,$99,$50,$33,$08,$53,$17
        6EBC 33 08 53 17 
 003976 6EC0 40 04 99 95           .byte $40,$04,$99,$95,$00,$33,$30,$84
        6EC4 00 33 30 84 
 003977 6EC8 40 05 99 99           .byte $40,$05,$99,$99,$50,$00,$33,$33
        6ECC 50 00 33 33 
 003978 6ED0 40 06 99 99           .byte $40,$06,$99,$99,$95,$00,$00,$33
        6ED4 95 00 00 33 
 003979 6ED8 40 07 99 99           .byte $40,$07,$99,$99,$99,$50,$00,$00
        6EDC 99 50 00 00 
 003980 6EE0 40 08 99 99           .byte $40,$08,$99,$99,$99,$95,$00,$00
        6EE4 99 95 00 00 
 003981 6EE8 40 09 99 99           .byte $40,$09,$99,$99,$99,$99,$50,$00
        6EEC 99 99 50 00 
 003982 6EF0 40 10 99 99           .byte $40,$10,$99,$99,$99,$99,$95,$00
        6EF4 99 99 95 00 
 003983 6EF8 40 11 99 99           .byte $40,$11,$99,$99,$99,$99,$99,$50
        6EFC 99 99 99 50 
 003984                      ;
 003985                      ;   ln(2), ln(1.1), ln(1.01), ln(1.001),...
 003986                      ;
 003987                      ;   This table is in fixed decimal format
 003988                      ;
 003989 6F00 06 93 14 71     kxlog .byte $06,$93,$14,$71,$80,$55,$99,$45

                              page 80

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


        6F04 80 55 99 45 
 003990 6F08 00 95 31 01           .byte $00,$95,$31,$01,$79,$80,$43,$25
        6F0C 79 80 43 25 
 003991 6F10 00 09 95 03           .byte $00,$09,$95,$03,$30,$85,$31,$68
        6F14 30 85 31 68 
 003992 6F18 00 00 99 95           .byte $00,$00,$99,$95,$00,$33,$30,$84
        6F1C 00 33 30 84 
 003993 6F20 00 00 09 99           .byte $00,$00,$09,$99,$95,$00,$03,$33
        6F24 95 00 03 33 
 003994 6F28 00 00 00 99           .byte $00,$00,$00,$99,$99,$95,$00,$00
        6F2C 99 95 00 00 
 003995 6F30 00 00 00 09           .byte $00,$00,$00,$09,$99,$99,$95,$00
        6F34 99 99 95 00 
 003996 6F38 00 00 00 00           .byte $00,$00,$00,$00,$99,$99,$99,$95
        6F3C 99 99 99 95 
 003997 6F40 00 00 00 00           .byte $00,$00,$00,$00,$10,$00,$00,$00
        6F44 10 00 00 00 
 003998 6F48 00 00 00 00           .byte $00,$00,$00,$00,$01,$00,$00,$00
        6F4C 01 00 00 00 
 003999 6F50 00 00 00 00           .byte $00,$00,$00,$00,$00,$10,$00,$00
        6F54 00 10 00 00 
 004000 6F58 00 00 00 00           .byte $00,$00,$00,$00,$00,$01,$00,$00
        6F5C 00 01 00 00 
 004001 6F60 00 00 00 00           .byte $00,$00,$00,$00,$00,$00,$10,$00
        6F64 00 00 10 00 
 004002 6F68 00 00 00 00           .byte $00,$00,$00,$00,$00,$00,$01,$00
        6F6C 00 00 01 00 
 004003 6F70 00 00 00 00           .byte $00,$00,$00,$00,$00,$00,$00,$10
        6F74 00 00 00 10 
 004004 6F78 00 00 00 00           .byte $00,$00,$00,$00,$00,$00,$00,$01
        6F7C 00 00 00 01 
 004005 6F80 C0 01 25 00     kln   .byte $C0,$01,$25,$00,$00,$00,$00,$00
        6F84 00 00 00 00 
 004006 6F88 40 01 33 33           .byte $40,$01,$33,$33,$33,$33,$33,$33
        6F8C 33 33 33 33 
 004007 6F90 C0 01 50 00           .byte $C0,$01,$50,$00,$00,$00,$00,$00
        6F94 00 00 00 00 
 004008 6F98 00 00 10 00           .byte $00,$00,$10,$00,$00,$00,$00,$00
        6F9C 00 00 00 00 
 004009 6FA0 00 01 80 00     tst1  .byte $00,$01,$80,$00,$00,$00,$00,$00
        6FA4 00 00 00 00 
 004010 6FA8 00 01 80 00     tst2  .byte $00,$01,$80,$00,$00,$00,$00,$01
        6FAC 00 00 00 01 
 004011 6FB0 80 01 80 00     tst3  .byte $80,$01,$80,$00,$00,$00,$00,$00
        6FB4 00 00 00 00 
 004012 6FB8 80 00 12 30     tst4  .byte $80,$00,$12,$30,$00,$00,$00,$00
        6FBC 00 00 00 00 
 004013 6FC0 40 01 33 00     tst5  .byte $40,$01,$33,$00,$00,$00,$00,$00
        6FC4 00 00 00 00 
 004014 6FC8 40 02 20 00     tst6  .byte $40,$02,$20,$00,$00,$00,$00,$00
        6FCC 00 00 00 00 
 004015 6FD0 C0 01 33 00     tst7  .byte $C0,$01,$33,$00,$00,$00,$00,$00
        6FD4 00 00 00 00 

                              page 81

 fs6.cba   cbA65 v.1.00a, Sep  4 2009  -- Fri Sep 19 17:15:59 2014


 004016 6FD8 C0 02 20 00     tst8  .byte $C0,$02,$20,$00,$00,$00,$00,$00
        6FDC 00 00 00 00 
 004017                            .end

NUMBER OF SYMBOLS: 345

















































                              page 82

